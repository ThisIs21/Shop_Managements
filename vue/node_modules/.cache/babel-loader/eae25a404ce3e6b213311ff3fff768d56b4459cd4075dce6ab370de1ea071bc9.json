{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport PurchasingSidebar from \"@/components/PurchasingSidebar.vue\";\nimport axios from \"axios\";\nexport default {\n  name: \"PurchasingReturn\",\n  components: {\n    PurchasingSidebar\n  },\n  data() {\n    return {\n      purchaseOrders: [],\n      selectedPO: \"\",\n      poItems: [],\n      additionalNotes: \"\"\n    };\n  },\n  mounted() {\n    this.fetchPurchaseOrders();\n  },\n  methods: {\n    async fetchPurchaseOrders() {\n      try {\n        const token = localStorage.getItem(\"token\");\n        if (!token) {\n          console.error(\"Token not found. Please log in.\");\n          return;\n        }\n        const response = await axios.get(\"http://localhost:8081/api/v1/pembelian/purchases\", {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        // Filter hanya yang sudah APPROVED\n        this.purchaseOrders = response.data.data.filter(po => po.status === \"APPROVED\");\n      } catch (error) {\n        console.error(\"Failed to fetch purchase orders:\", error);\n      }\n    },\n    async fetchPOItems() {\n      if (!this.selectedPO) {\n        this.poItems = [];\n        return;\n      }\n      try {\n        const token = localStorage.getItem(\"token\");\n        const response = await axios.get(`http://localhost:8081/api/v1/pembelian/purchases/${this.selectedPO}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        // Map item dari PO dan tambahkan properti untuk retur\n        this.poItems = response.data.data.items.map(item => ({\n          ...item,\n          returnQty: 0,\n          reason: \"\"\n        }));\n      } catch (error) {\n        console.error(\"Failed to fetch purchase order items:\", error);\n      }\n    },\n    async submitReturnRequest() {\n      const returnItemsPayload = this.poItems.filter(item => item.returnQty > 0).map(item => ({\n        purchase_item_id: item.id,\n        product_id: item.product_id,\n        qty: item.returnQty,\n        reason: item.reason\n      }));\n      if (returnItemsPayload.length === 0) {\n        alert(\"Please select at least one item to return.\");\n        return;\n      }\n      try {\n        const token = localStorage.getItem(\"token\");\n        const payload = {\n          purchase_id: this.selectedPO,\n          return_date: new Date().toISOString(),\n          notes: this.additionalNotes,\n          items: returnItemsPayload\n        };\n        const response = await axios.post(\"http://localhost:8081/api/v1/pembelian/purchase-returns\", payload, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        console.log(\"Return request submitted:\", response.data);\n        alert(\"Permintaan retur berhasil diajukan!\");\n        // Reset form\n        this.selectedPO = \"\";\n        this.poItems = [];\n        this.additionalNotes = \"\";\n      } catch (error) {\n        console.error(\"Failed to submit return request:\", error.response ? error.response.data : error.message);\n        alert(\"Gagal mengajukan permintaan retur.\");\n      }\n    }\n  }\n};","map":{"version":3,"names":["PurchasingSidebar","axios","name","components","data","purchaseOrders","selectedPO","poItems","additionalNotes","mounted","fetchPurchaseOrders","methods","token","localStorage","getItem","console","error","response","get","headers","Authorization","filter","po","status","fetchPOItems","items","map","item","returnQty","reason","submitReturnRequest","returnItemsPayload","purchase_item_id","id","product_id","qty","length","alert","payload","purchase_id","return_date","Date","toISOString","notes","post","log","message"],"sources":["C:\\Users\\Personal\\Documents\\PKL\\aplikasi\\aplikasi\\src\\views\\PurchaseReturn.vue"],"sourcesContent":["<template>\n  <div\n    class=\"relative flex size-full min-h-screen flex-col bg-white group/design-root overflow-x-hidden\"\n    style=\"\n      --select-button-svg: url('data:image/svg+xml,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2724px%27 height=%2724px%27 fill=%27rgb(96,117,138)%27 viewBox=%270 0 256 256%27%3e%3cpath d=%27M181.66,170.34a8,8,0,0,1,0,11.32l-48,48a8,8,0,0,1-11.32,0l-48-48a8,8,0,0,1,11.32-11.32L128,212.69l42.34-42.35A8,8,0,0,1,181.66,170.34Zm-96-84.68L128,43.31l42.34,42.35a8,8,0,0,0,11.32-11.32l-48-48a8,8,0,0,0-11.32,0l-48,48A8,8,0,0,0,85.66,85.66Z%27%3e%3c/path%3e%3c/svg%3e');\n      font-family: Manrope, 'Noto Sans', sans-serif;\n    \"\n  >\n    <div class=\"layout-container flex h-full grow\">\n      <PurchasingSidebar />\n\n      <div class=\"layout-content-container flex flex-col flex-1\">\n        <div class=\"flex flex-wrap justify-between gap-3 p-4\">\n          <p\n            class=\"text-[#111418] tracking-light text-[32px] font-bold leading-tight min-w-72\"\n          >\n            Create Return Request\n          </p>\n        </div>\n        <div class=\"flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3\">\n          <label class=\"flex flex-col min-w-40 flex-1\">\n            <p class=\"text-[#111418] text-base font-medium leading-normal pb-2\">\n              Purchase Order\n            </p>\n            <select\n              class=\"form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#111418] focus:outline-0 focus:ring-0 border border-[#dbe0e6] bg-white focus:border-[#dbe0e6] h-14 placeholder:text-[#60758a] p-[15px] text-base font-normal leading-normal custom-select\"\n              v-model=\"selectedPO\"\n              @change=\"fetchPOItems\"\n            >\n              <option value=\"\">Select Purchase Order</option>\n              <option v-for=\"po in purchaseOrders\" :key=\"po.id\" :value=\"po.id\">\n                PO-{{ po.id }} - {{ po.supplier.name }}\n              </option>\n            </select>\n          </label>\n        </div>\n        <h3\n          class=\"text-[#111418] text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4\"\n        >\n          Return Items\n        </h3>\n        <div class=\"px-4 py-3 @container\">\n          <div\n            class=\"flex overflow-hidden rounded-lg border border-[#dbe0e6] bg-white\"\n          >\n            <table class=\"flex-1\">\n              <thead>\n                <tr class=\"bg-white\">\n                  <th\n                    class=\"table-fdf173fd-e234-463e-aee5-60e5b04a682e-column-120 px-4 py-3 text-left text-[#111418] w-[400px] text-sm font-medium leading-normal\"\n                  >\n                    Product\n                  </th>\n                  <th\n                    class=\"table-fdf173fd-e234-463e-aee5-60e5b04a682e-column-240 px-4 py-3 text-left text-[#111414] w-[400px] text-sm font-medium leading-normal\"\n                  >\n                    Quantity\n                  </th>\n                  <th\n                    class=\"table-fdf173fd-e234-463e-aee5-60e5b04a682e-column-360 px-4 py-3 text-left text-[#111418] w-[400px] text-sm font-medium leading-normal\"\n                  >\n                    Return Quantity\n                  </th>\n                  <th\n                    class=\"table-fdf173fd-e234-463e-aee5-60e5b04a682e-column-480 px-4 py-3 text-left text-[#111418] w-[400px] text-sm font-medium leading-normal\"\n                  >\n                    Reason\n                  </th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr\n                  v-for=\"item in poItems\"\n                  :key=\"item.id\"\n                  class=\"border-t border-t-[#dbe0e6]\"\n                >\n                  <td\n                    class=\"table-fdf173fd-e234-463e-aee5-60e5b04a682e-column-120 h-[72px] px-4 py-2 w-[400px] text-[#111418] text-sm font-normal leading-normal\"\n                  >\n                    {{ item.product.name }}\n                  </td>\n                  <td\n                    class=\"table-fdf173fd-e234-463e-aee5-60e5b04a682e-column-240 h-[72px] px-4 py-2 w-[400px] text-[#60758a] text-sm font-normal leading-normal\"\n                  >\n                    {{ item.qty }}\n                  </td>\n                  <td\n                    class=\"table-fdf173fd-e234-463e-aee5-60e5b04a682e-column-360 h-[72px] px-4 py-2 w-[400px] text-[#60758a] text-sm font-normal leading-normal\"\n                  >\n                    <input\n                      type=\"number\"\n                      v-model.number=\"item.returnQty\"\n                      min=\"0\"\n                      :max=\"item.qty\"\n                      class=\"form-input rounded-lg border border-[#dbe0e6] p-2 text-sm\"\n                    />\n                  </td>\n                  <td\n                    class=\"table-fdf173fd-e234-463e-aee5-60e5b04a682e-column-480 h-[72px] px-4 py-2 w-[400px] text-[#60758a] text-sm font-normal leading-normal\"\n                  >\n                    <input\n                      type=\"text\"\n                      v-model=\"item.reason\"\n                      placeholder=\"Reason for return\"\n                      class=\"form-input rounded-lg border border-[#dbe0e6] p-2 text-sm\"\n                    />\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n        <div class=\"flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3\">\n          <label class=\"flex flex-col min-w-40 flex-1\">\n            <p class=\"text-[#111418] text-base font-medium leading-normal pb-2\">\n              Additional Notes\n            </p>\n            <textarea\n              placeholder=\"Enter any additional notes\"\n              class=\"form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#111418] focus:outline-0 focus:ring-0 border border-[#dbe0e6] bg-white focus:border-[#dbe0e6] min-h-36 placeholder:text-[#60758a] p-[15px] text-base font-normal leading-normal\"\n              v-model=\"additionalNotes\"\n            ></textarea>\n          </label>\n        </div>\n        <div class=\"flex px-4 py-3 justify-end\">\n          <button\n            class=\"flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-[#0d80f2] text-white text-sm font-bold leading-normal tracking-[0.015em]\"\n            @click=\"submitReturnRequest\"\n          >\n            <span class=\"truncate\">Submit Return Request</span>\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport PurchasingSidebar from \"@/components/PurchasingSidebar.vue\";\nimport axios from \"axios\";\n\nexport default {\n  name: \"PurchasingReturn\",\n  components: {\n    PurchasingSidebar,\n  },\n  data() {\n    return {\n      purchaseOrders: [],\n      selectedPO: \"\",\n      poItems: [],\n      additionalNotes: \"\",\n    };\n  },\n  mounted() {\n    this.fetchPurchaseOrders();\n  },\n  methods: {\n    async fetchPurchaseOrders() {\n      try {\n        const token = localStorage.getItem(\"token\");\n        if (!token) {\n          console.error(\"Token not found. Please log in.\");\n          return;\n        }\n\n        const response = await axios.get(\n          \"http://localhost:8081/api/v1/pembelian/purchases\",\n          {\n            headers: {\n              Authorization: `Bearer ${token}`,\n            },\n          }\n        );\n        // Filter hanya yang sudah APPROVED\n        this.purchaseOrders = response.data.data.filter(\n          (po) => po.status === \"APPROVED\"\n        );\n      } catch (error) {\n        console.error(\"Failed to fetch purchase orders:\", error);\n      }\n    },\n    async fetchPOItems() {\n      if (!this.selectedPO) {\n        this.poItems = [];\n        return;\n      }\n      try {\n        const token = localStorage.getItem(\"token\");\n        const response = await axios.get(\n          `http://localhost:8081/api/v1/pembelian/purchases/${this.selectedPO}`,\n          {\n            headers: {\n              Authorization: `Bearer ${token}`,\n            },\n          }\n        );\n        // Map item dari PO dan tambahkan properti untuk retur\n        this.poItems = response.data.data.items.map((item) => ({\n          ...item,\n          returnQty: 0,\n          reason: \"\",\n        }));\n      } catch (error) {\n        console.error(\"Failed to fetch purchase order items:\", error);\n      }\n    },\n    async submitReturnRequest() {\n      const returnItemsPayload = this.poItems\n        .filter((item) => item.returnQty > 0)\n        .map((item) => ({\n          purchase_item_id: item.id,\n          product_id: item.product_id,\n          qty: item.returnQty,\n          reason: item.reason,\n        }));\n\n      if (returnItemsPayload.length === 0) {\n        alert(\"Please select at least one item to return.\");\n        return;\n      }\n\n      try {\n        const token = localStorage.getItem(\"token\");\n        const payload = {\n          purchase_id: this.selectedPO,\n          return_date: new Date().toISOString(),\n          notes: this.additionalNotes,\n          items: returnItemsPayload,\n        };\n\n        const response = await axios.post(\n          \"http://localhost:8081/api/v1/pembelian/purchase-returns\",\n          payload,\n          {\n            headers: {\n              Authorization: `Bearer ${token}`,\n            },\n          }\n        );\n\n        console.log(\"Return request submitted:\", response.data);\n        alert(\"Permintaan retur berhasil diajukan!\");\n        // Reset form\n        this.selectedPO = \"\";\n        this.poItems = [];\n        this.additionalNotes = \"\";\n      } catch (error) {\n        console.error(\n          \"Failed to submit return request:\",\n          error.response ? error.response.data : error.message\n        );\n        alert(\"Gagal mengajukan permintaan retur.\");\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n@import url(\"https://fonts.googleapis.com/css2?display=swap&family=Manrope%3Awght%40400%3B500%3B700%3B800&family=Noto+Sans%3Awght%40400%3B500%3B700%3B900\");\n\n.custom-select {\n  -webkit-appearance: none;\n  -moz-appearance: none;\n  appearance: none;\n  background-image: var(--select-button-svg);\n  background-repeat: no-repeat;\n  background-position: right 1rem center;\n  background-size: 1.5em;\n  padding-right: 2.5rem;\n}\n\n@container (max-width: 120px) {\n  .table-fdf173fd-e234-463e-aee5-60e5b04a682e-column-120 {\n    display: none;\n  }\n}\n\n@container (max-width: 240px) {\n  .table-fdf173fd-e234-463e-aee5-60e5b04a682e-column-240 {\n    display: none;\n  }\n}\n\n@container (max-width: 360px) {\n  .table-fdf173fd-e234-463e-aee5-60e5b04a682e-column-360 {\n    display: none;\n  }\n}\n\n@container (max-width: 480px) {\n  .table-fdf173fd-e234-463e-aee5-60e5b04a682e-column-480 {\n    display: none;\n  }\n}\n\n.layout-content-container {\n  max-width: 960px;\n  width: 100%;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}