{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.every.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { ref, computed, onMounted } from \"vue\";\nimport GudangLayouts from \"@/components/GudangLayouts.vue\";\nimport axios from \"axios\";\nexport default {\n  __name: 'DashboardGudang',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const stockOpnames = ref([]);\n    const loading = ref(false);\n    const products = ref([]);\n    const opnameForm = ref({\n      date: new Date().toISOString().split(\"T\")[0],\n      // 2025-10-02\n      note: \"\",\n      items: [{\n        product_id: null,\n        qty_fisik: 0\n      }]\n    });\n    const submitting = ref(false);\n    const errorMessage = ref(\"\");\n    const api = axios.create({\n      baseURL: \"http://localhost:8081/api/v1\"\n    });\n    const savedToken = localStorage.getItem(\"token\");\n    if (savedToken) {\n      api.defaults.headers.common[\"Authorization\"] = `Bearer ${savedToken}`;\n    } else {\n      errorMessage.value = \"Please log in to continue.\";\n    }\n    const currentDate = computed(() => new Date().toISOString().split(\"T\")[0]);\n    const fetchStockOpnames = async () => {\n      loading.value = true;\n      errorMessage.value = \"\";\n      try {\n        const response = await api.get(\"/gudang/stock-opnames\", {\n          params: {\n            limit: 3,\n            sort: \"date_desc\"\n          }\n        });\n        stockOpnames.value = (response.data.data || []).map(op => ({\n          ID: op.ID || op.id,\n          Date: op.Date || op.date,\n          Status: op.Status || op.status || \"Pending\",\n          ProductsCount: (op.Items || op.items || []).length,\n          StaffName: op.User?.Name || op.user?.name || \"Unknown\"\n        }));\n      } catch (error) {\n        console.error(\"Gagal fetch stock opnames:\", error);\n        errorMessage.value = `Gagal memuat data: ${error.response?.status} - ${error.response?.data?.error || error.message}`;\n      } finally {\n        loading.value = false;\n      }\n    };\n    const fetchProducts = async () => {\n      try {\n        const response = await api.get(\"/products\");\n        products.value = response.data.data || [];\n      } catch (error) {\n        console.error(\"Gagal fetch products:\", error);\n        errorMessage.value = `Gagal memuat produk: ${error.response?.data?.error || error.message}`;\n      }\n    };\n    const addItem = () => {\n      opnameForm.value.items.push({\n        product_id: null,\n        qty_fisik: 0\n      });\n    };\n    const removeItem = index => {\n      opnameForm.value.items.splice(index, 1);\n    };\n    const isFormValid = computed(() => {\n      return opnameForm.value.items.every(item => item.product_id && item.qty_fisik >= 0 && item.qty_fisik !== null);\n    });\n    const submitOpname = async () => {\n      if (!isFormValid.value) {\n        errorMessage.value = \"Please fill all fields with valid data (product and physical qty required).\";\n        return;\n      }\n      submitting.value = true;\n      errorMessage.value = \"\";\n      try {\n        const payload = {\n          date: opnameForm.value.date,\n          note: opnameForm.value.note,\n          items: opnameForm.value.items.filter(item => item.product_id && item.qty_fisik >= 0)\n        };\n        const response = await api.post(\"/gudang/stock-opnames\", payload);\n        if (response.status === 201) {\n          alert(\"Stock opname berhasil dibuat!\");\n          opnameForm.value = {\n            date: new Date().toISOString().split(\"T\")[0],\n            note: \"\",\n            items: [{\n              product_id: null,\n              qty_fisik: 0\n            }]\n          };\n          fetchStockOpnames();\n        }\n      } catch (error) {\n        console.error(\"Gagal submit opname:\", error);\n        errorMessage.value = `Gagal membuat stock opname: ${error.response?.status} - ${error.response?.data?.error || error.message}`;\n      } finally {\n        submitting.value = false;\n      }\n    };\n    const formatDate = dateStr => {\n      if (!dateStr) return \"N/A\";\n      const date = new Date(dateStr);\n      return date.toLocaleDateString(\"id-ID\", {\n        day: \"2-digit\",\n        month: \"2-digit\",\n        year: \"numeric\"\n      });\n    };\n    onMounted(() => {\n      fetchStockOpnames();\n      fetchProducts();\n    });\n    const __returned__ = {\n      stockOpnames,\n      loading,\n      products,\n      opnameForm,\n      submitting,\n      errorMessage,\n      api,\n      savedToken,\n      currentDate,\n      fetchStockOpnames,\n      fetchProducts,\n      addItem,\n      removeItem,\n      isFormValid,\n      submitOpname,\n      formatDate,\n      ref,\n      computed,\n      onMounted,\n      GudangLayouts,\n      get axios() {\n        return axios;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","GudangLayouts","axios","stockOpnames","loading","products","opnameForm","date","Date","toISOString","split","note","items","product_id","qty_fisik","submitting","errorMessage","api","create","baseURL","savedToken","localStorage","getItem","defaults","headers","common","value","currentDate","fetchStockOpnames","response","get","params","limit","sort","data","map","op","ID","id","Status","status","ProductsCount","Items","length","StaffName","User","Name","user","name","error","console","message","fetchProducts","addItem","push","removeItem","index","splice","isFormValid","every","item","submitOpname","payload","filter","post","alert","formatDate","dateStr","toLocaleDateString","day","month","year"],"sources":["C:/Users/Personal/Documents/PKL/aplikasi/aplikasi/src/views/DashboardGudang.vue"],"sourcesContent":["<template>\n  <div class=\"p-4\">\n    <!-- Header -->\n    <h1 class=\"text-xl font-bold mb-4 flex items-center gap-2\">\n      ðŸ“¦ Warehouse Dashboard\n    </h1>\n\n    <!-- Tabel Stock Opname -->\n    <div class=\"mb-6 bg-gray-900 p-4 rounded-lg shadow\">\n      <h2 class=\"text-lg font-semibold mb-2\">Stock Opname</h2>\n      <table class=\"w-full text-sm text-left text-gray-400\">\n        <thead class=\"bg-gray-800 text-gray-300\">\n          <tr>\n            <th class=\"px-3 py-2\">Date</th>\n            <th class=\"px-3 py-2\">Status</th>\n            <th class=\"px-3 py-2\">Count</th>\n            <th class=\"px-3 py-2\">Staff</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr v-if=\"opnames.length === 0\">\n            <td colspan=\"4\" class=\"px-3 py-2 text-center\">No data</td>\n          </tr>\n          <tr\n            v-for=\"opname in opnames\"\n            :key=\"opname.id\"\n            class=\"hover:bg-gray-800\"\n          >\n            <td class=\"px-3 py-2\">{{ opname.date }}</td>\n            <td class=\"px-3 py-2\">{{ opname.status }}</td>\n            <td class=\"px-3 py-2\">{{ opname.count }}</td>\n            <td class=\"px-3 py-2\">{{ opname.staff }}</td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n\n    <!-- Form Opname Baru -->\n    <div class=\"bg-gray-900 p-4 rounded-lg shadow\">\n      <h2 class=\"text-lg font-semibold mb-3\">New Opname</h2>\n\n      <!-- Form Input Utama -->\n      <div class=\"flex flex-wrap gap-2 mb-3\">\n        <!-- Date -->\n        <input\n          v-model=\"opnameForm.date\"\n          type=\"date\"\n          class=\"p-2 rounded bg-gray-700 text-white text-sm border border-gray-600 w-[160px]\"\n        />\n\n        <!-- Note -->\n        <input\n          v-model=\"opnameForm.note\"\n          type=\"text\"\n          placeholder=\"Note...\"\n          class=\"p-2 rounded bg-gray-700 text-white text-sm border border-gray-600 flex-1 min-w-[120px] max-w-[200px]\"\n        />\n      </div>\n\n      <!-- Items -->\n      <div\n        v-for=\"(item, index) in opnameForm.items\"\n        :key=\"index\"\n        class=\"flex flex-wrap gap-2 mb-2\"\n      >\n        <!-- Product Select -->\n        <select\n          v-model=\"item.product_id\"\n          class=\"p-2 rounded bg-gray-700 text-white text-sm border border-gray-600 w-[180px]\"\n        >\n          <option value=\"\" disabled>Select</option>\n          <option\n            v-for=\"product in products\"\n            :key=\"product.id\"\n            :value=\"product.id\"\n          >\n            {{ product.name }}\n          </option>\n        </select>\n\n        <!-- Qty -->\n        <input\n          v-model.number=\"item.qty_fisik\"\n          type=\"number\"\n          min=\"0\"\n          placeholder=\"Qty\"\n          class=\"p-2 rounded bg-gray-700 text-white text-sm border border-gray-600 w-[80px] text-center\"\n        />\n\n        <!-- Remove -->\n        <button\n          @click.prevent=\"removeItem(index)\"\n          type=\"button\"\n          class=\"px-2 text-red-400 hover:text-red-600\"\n        >\n          âœ•\n        </button>\n      </div>\n\n      <!-- Add Item -->\n      <button\n        @click.prevent=\"addItem\"\n        type=\"button\"\n        class=\"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-sm\"\n      >\n        + Add Item\n      </button>\n\n      <!-- Submit -->\n      <div class=\"mt-3\">\n        <button\n          @click=\"submitOpname\"\n          class=\"w-full py-2 bg-blue-600 text-white rounded hover:bg-blue-700\"\n        >\n          Submit Opname\n        </button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted } from \"vue\";\nimport GudangLayouts from \"@/components/GudangLayouts.vue\";\nimport axios from \"axios\";\n\nconst stockOpnames = ref([]);\nconst loading = ref(false);\nconst products = ref([]);\nconst opnameForm = ref({\n  date: new Date().toISOString().split(\"T\")[0], // 2025-10-02\n  note: \"\",\n  items: [{ product_id: null, qty_fisik: 0 }],\n});\nconst submitting = ref(false);\nconst errorMessage = ref(\"\");\n\nconst api = axios.create({ baseURL: \"http://localhost:8081/api/v1\" });\nconst savedToken = localStorage.getItem(\"token\");\nif (savedToken) {\n  api.defaults.headers.common[\"Authorization\"] = `Bearer ${savedToken}`;\n} else {\n  errorMessage.value = \"Please log in to continue.\";\n}\n\nconst currentDate = computed(() => new Date().toISOString().split(\"T\")[0]);\n\nconst fetchStockOpnames = async () => {\n  loading.value = true;\n  errorMessage.value = \"\";\n  try {\n    const response = await api.get(\"/gudang/stock-opnames\", {\n      params: { limit: 3, sort: \"date_desc\" },\n    });\n    stockOpnames.value = (response.data.data || []).map((op) => ({\n      ID: op.ID || op.id,\n      Date: op.Date || op.date,\n      Status: op.Status || op.status || \"Pending\",\n      ProductsCount: (op.Items || op.items || []).length,\n      StaffName: op.User?.Name || op.user?.name || \"Unknown\",\n    }));\n  } catch (error) {\n    console.error(\"Gagal fetch stock opnames:\", error);\n    errorMessage.value = `Gagal memuat data: ${error.response?.status} - ${\n      error.response?.data?.error || error.message\n    }`;\n  } finally {\n    loading.value = false;\n  }\n};\n\nconst fetchProducts = async () => {\n  try {\n    const response = await api.get(\"/products\");\n    products.value = response.data.data || [];\n  } catch (error) {\n    console.error(\"Gagal fetch products:\", error);\n    errorMessage.value = `Gagal memuat produk: ${\n      error.response?.data?.error || error.message\n    }`;\n  }\n};\n\nconst addItem = () => {\n  opnameForm.value.items.push({ product_id: null, qty_fisik: 0 });\n};\n\nconst removeItem = (index) => {\n  opnameForm.value.items.splice(index, 1);\n};\n\nconst isFormValid = computed(() => {\n  return opnameForm.value.items.every(\n    (item) => item.product_id && item.qty_fisik >= 0 && item.qty_fisik !== null\n  );\n});\n\nconst submitOpname = async () => {\n  if (!isFormValid.value) {\n    errorMessage.value =\n      \"Please fill all fields with valid data (product and physical qty required).\";\n    return;\n  }\n\n  submitting.value = true;\n  errorMessage.value = \"\";\n  try {\n    const payload = {\n      date: opnameForm.value.date,\n      note: opnameForm.value.note,\n      items: opnameForm.value.items.filter(\n        (item) => item.product_id && item.qty_fisik >= 0\n      ),\n    };\n    const response = await api.post(\"/gudang/stock-opnames\", payload);\n    if (response.status === 201) {\n      alert(\"Stock opname berhasil dibuat!\");\n      opnameForm.value = {\n        date: new Date().toISOString().split(\"T\")[0],\n        note: \"\",\n        items: [{ product_id: null, qty_fisik: 0 }],\n      };\n      fetchStockOpnames();\n    }\n  } catch (error) {\n    console.error(\"Gagal submit opname:\", error);\n    errorMessage.value = `Gagal membuat stock opname: ${\n      error.response?.status\n    } - ${error.response?.data?.error || error.message}`;\n  } finally {\n    submitting.value = false;\n  }\n};\n\nconst formatDate = (dateStr) => {\n  if (!dateStr) return \"N/A\";\n  const date = new Date(dateStr);\n  return date.toLocaleDateString(\"id-ID\", {\n    day: \"2-digit\",\n    month: \"2-digit\",\n    year: \"numeric\",\n  });\n};\n\nonMounted(() => {\n  fetchStockOpnames();\n  fetchProducts();\n});\n</script>\n\n<style scoped>\n/* Gaya khusus untuk halaman ini jika ada */\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}