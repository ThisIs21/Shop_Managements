{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { ref, computed, onMounted, watch } from \"vue\";\nimport axios from \"axios\";\nimport OwnerLayout from \"../components/OwnerLayouts.vue\";\nexport default {\n  __name: 'ReportStockOpnameOwners',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const filters = ref({\n      startDate: \"\",\n      endDate: \"\"\n    });\n    const rawData = ref([]);\n    const flattenedData = ref([]);\n    const loading = ref(false);\n    const errorMessage = ref(\"\");\n    const token = localStorage.getItem(\"token\");\n    const isFilterValid = ref(false);\n\n    // Validasi filter\n    const validateFilters = () => {\n      const start = new Date(filters.value.startDate);\n      const end = new Date(filters.value.endDate);\n      isFilterValid.value = filters.value.startDate && filters.value.endDate && start <= end;\n      if (!isFilterValid.value) {\n        errorMessage.value = \"Harap masukkan kedua tanggal yang valid (Dari ≤ Sampai).\";\n      } else {\n        errorMessage.value = \"\";\n      }\n    };\n\n    // Ambil data dari backend\n    const fetchData = async () => {\n      loading.value = true;\n      errorMessage.value = \"\";\n      try {\n        if (!token) {\n          errorMessage.value = \"Token autentikasi tidak ditemukan. Silakan login kembali.\";\n          return;\n        }\n        let url = \"http://localhost:8081/api/v1/owner/reports?type=stock-opnames&detail=true\";\n        if (filters.value.startDate && filters.value.endDate) {\n          url += `&from=${filters.value.startDate}&to=${filters.value.endDate}`;\n        }\n        const res = await axios.get(url, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        rawData.value = res.data.data || [];\n        // Sort data berdasarkan tanggal secara descending (terbaru di atas)\n        flattenedData.value = rawData.value.map(item => ({\n          date: item.date || \"N/A\",\n          book_name: item.book_name || \"\",\n          product_code: item.product_code || \"\",\n          system_stock: item.system_stock,\n          physical_stock: item.physical_stock,\n          difference: item.difference\n        })).sort((a, b) => new Date(b.date) - new Date(a.date));\n        errorMessage.value = \"\"; // Reset error jika berhasil\n      } catch (err) {\n        console.error(\"Gagal ambil data laporan:\", err.response || err);\n        if (err.response) {\n          const status = err.response.status;\n          if (status === 404) {\n            errorMessage.value = \"Endpoint Owner 404. Periksa router Go atau pastikan 'type=stock-opnames' valid.\";\n          } else if (status === 401) {\n            errorMessage.value = \"Sesi Anda telah berakhir. Silakan login kembali.\";\n          } else {\n            errorMessage.value = `Gagal mengambil data laporan. Status: ${status}. Detail: ${err.response.data?.error || err.message}`;\n          }\n        } else {\n          errorMessage.value = \"Gagal terhubung ke server. Pastikan backend berjalan di port 8081.\";\n        }\n      } finally {\n        loading.value = false;\n      }\n    };\n    onMounted(fetchData);\n\n    // Logika filter\n    function applyFilter() {\n      if (!isFilterValid.value) {\n        errorMessage.value = \"Harap masukkan kedua tanggal yang valid.\";\n        return;\n      }\n      fetchData();\n    }\n    function resetFilter() {\n      filters.value.startDate = \"\";\n      filters.value.endDate = \"\";\n      isFilterValid.value = false;\n      errorMessage.value = \"\";\n      fetchData();\n    }\n    const filteredData = computed(() => flattenedData.value);\n\n    // Watch untuk validasi otomatis saat input berubah\n    watch(() => filters.value, validateFilters, {\n      immediate: true\n    });\n    const __returned__ = {\n      filters,\n      rawData,\n      flattenedData,\n      loading,\n      errorMessage,\n      token,\n      isFilterValid,\n      validateFilters,\n      fetchData,\n      applyFilter,\n      resetFilter,\n      filteredData,\n      ref,\n      computed,\n      onMounted,\n      watch,\n      get axios() {\n        return axios;\n      },\n      OwnerLayout\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","watch","axios","OwnerLayout","filters","startDate","endDate","rawData","flattenedData","loading","errorMessage","token","localStorage","getItem","isFilterValid","validateFilters","start","Date","value","end","fetchData","url","res","get","headers","Authorization","data","map","item","date","book_name","product_code","system_stock","physical_stock","difference","sort","a","b","err","console","error","response","status","message","applyFilter","resetFilter","filteredData","immediate"],"sources":["C:/Users/SPC STYLE 5/Documents/app-penjualan/aplikasi/aplikasi/src/views/ReportStockOpnameOwners.vue"],"sourcesContent":["<template>\n  <OwnerLayout>\n    <div class=\"p-4\">\n      <h1 class=\"text-2xl font-bold mb-4\">Laporan Stok Opname</h1>\n\n      <div\n        v-if=\"errorMessage\"\n        class=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4\"\n        role=\"alert\"\n      >\n        <span class=\"block sm:inline\">{{ errorMessage }}</span>\n      </div>\n\n      <div class=\"flex flex-wrap gap-4 mb-6 items-end\">\n        <label class=\"flex flex-col\">\n          <span class=\"text-sm font-medium mb-1\">Dari Tanggal</span>\n          <input\n            type=\"date\"\n            v-model=\"filters.startDate\"\n            class=\"border p-2 rounded w-40\"\n            @change=\"validateFilters\"\n          />\n        </label>\n        <label class=\"flex flex-col\">\n          <span class=\"text-sm font-medium mb-1\">Sampai Tanggal</span>\n          <input\n            type=\"date\"\n            v-model=\"filters.endDate\"\n            class=\"border p-2 rounded w-40\"\n            @change=\"validateFilters\"\n          />\n        </label>\n        <button\n          @click=\"applyFilter\"\n          class=\"h-10 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 font-semibold\"\n          :disabled=\"loading || !isFilterValid\"\n        >\n          Terapkan Filter\n        </button>\n        <button\n          @click=\"resetFilter\"\n          class=\"h-10 px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 font-semibold\"\n          :disabled=\"loading\"\n        >\n          Reset\n        </button>\n      </div>\n\n      <div v-if=\"loading\" class=\"text-center py-8\">\n        <svg\n          class=\"animate-spin h-6 w-6 text-blue-600 mx-auto\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n          fill=\"none\"\n          viewBox=\"0 0 24 24\"\n        >\n          <circle\n            class=\"opacity-25\"\n            cx=\"12\"\n            cy=\"12\"\n            r=\"10\"\n            stroke=\"currentColor\"\n            stroke-width=\"4\"\n          ></circle>\n          <path\n            class=\"opacity-75\"\n            fill=\"currentColor\"\n            d=\"M4 12a8 8 0 018-8v8H4z\"\n          ></path>\n        </svg>\n        <p class=\"mt-2 text-gray-600\">Memuat data...</p>\n      </div>\n\n      <table\n        v-else\n        class=\"w-full border-collapse border border-gray-300 shadow-md\"\n      >\n        <thead>\n          <tr class=\"bg-gray-100\">\n            <th class=\"border border-gray-300 px-4 py-3 text-left w-[150px]\">\n              Tanggal Opname\n            </th>\n            <th class=\"border border-gray-300 px-4 py-3 text-left\">\n              Nama Barang\n            </th>\n            <th class=\"border border-gray-300 px-4 py-3 text-right w-[150px]\">\n              Stok Sistem\n            </th>\n            <th class=\"border border-gray-300 px-4 py-3 text-right w-[150px]\">\n              Stok Fisik\n            </th>\n            <th class=\"border border-gray-300 px-4 py-3 text-right w-[150px]\">\n              Selisih\n            </th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr v-for=\"(item, index) in filteredData\" :key=\"index\">\n            <td class=\"border border-gray-300 px-4 py-2 text-sm\">\n              {{ item.date }}\n            </td>\n            <td class=\"border border-gray-300 px-4 py-2 text-sm\">\n              {{ item.book_name }} ({{ item.product_code }})\n            </td>\n            <td class=\"border border-gray-300 px-4 py-2 text-right text-sm\">\n              {{ item.system_stock !== undefined ? item.system_stock : \"-\" }}\n            </td>\n            <td class=\"border border-gray-300 px-4 py-2 text-right text-sm\">\n              {{\n                item.physical_stock !== undefined ? item.physical_stock : \"-\"\n              }}\n            </td>\n            <td\n              class=\"border border-gray-300 px-4 py-2 text-right text-sm font-semibold\"\n              :class=\"{\n                'text-red-600': item.difference < 0,\n                'text-green-600': item.difference > 0,\n              }\"\n            >\n              {{ item.difference !== undefined ? item.difference : \"-\" }}\n            </td>\n          </tr>\n          <tr v-if=\"filteredData.length === 0\">\n            <td colspan=\"5\" class=\"text-center py-6 text-gray-500 text-base\">\n              Tidak ada data Stok Opname dalam periode ini.\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </OwnerLayout>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted, watch } from \"vue\";\nimport axios from \"axios\";\nimport OwnerLayout from \"../components/OwnerLayouts.vue\";\n\nconst filters = ref({\n  startDate: \"\",\n  endDate: \"\",\n});\nconst rawData = ref([]);\nconst flattenedData = ref([]);\nconst loading = ref(false);\nconst errorMessage = ref(\"\");\nconst token = localStorage.getItem(\"token\");\nconst isFilterValid = ref(false);\n\n// Validasi filter\nconst validateFilters = () => {\n  const start = new Date(filters.value.startDate);\n  const end = new Date(filters.value.endDate);\n  isFilterValid.value =\n    filters.value.startDate && filters.value.endDate && start <= end;\n  if (!isFilterValid.value) {\n    errorMessage.value =\n      \"Harap masukkan kedua tanggal yang valid (Dari ≤ Sampai).\";\n  } else {\n    errorMessage.value = \"\";\n  }\n};\n\n// Ambil data dari backend\nconst fetchData = async () => {\n  loading.value = true;\n  errorMessage.value = \"\";\n  try {\n    if (!token) {\n      errorMessage.value =\n        \"Token autentikasi tidak ditemukan. Silakan login kembali.\";\n      return;\n    }\n\n    let url =\n      \"http://localhost:8081/api/v1/owner/reports?type=stock-opnames&detail=true\";\n\n    if (filters.value.startDate && filters.value.endDate) {\n      url += `&from=${filters.value.startDate}&to=${filters.value.endDate}`;\n    }\n\n    const res = await axios.get(url, {\n      headers: { Authorization: `Bearer ${token}` },\n    });\n\n    rawData.value = res.data.data || [];\n    // Sort data berdasarkan tanggal secara descending (terbaru di atas)\n    flattenedData.value = rawData.value\n      .map((item) => ({\n        date: item.date || \"N/A\",\n        book_name: item.book_name || \"\",\n        product_code: item.product_code || \"\",\n        system_stock: item.system_stock,\n        physical_stock: item.physical_stock,\n        difference: item.difference,\n      }))\n      .sort((a, b) => new Date(b.date) - new Date(a.date));\n\n    errorMessage.value = \"\"; // Reset error jika berhasil\n  } catch (err) {\n    console.error(\"Gagal ambil data laporan:\", err.response || err);\n    if (err.response) {\n      const status = err.response.status;\n      if (status === 404) {\n        errorMessage.value =\n          \"Endpoint Owner 404. Periksa router Go atau pastikan 'type=stock-opnames' valid.\";\n      } else if (status === 401) {\n        errorMessage.value = \"Sesi Anda telah berakhir. Silakan login kembali.\";\n      } else {\n        errorMessage.value = `Gagal mengambil data laporan. Status: ${status}. Detail: ${\n          err.response.data?.error || err.message\n        }`;\n      }\n    } else {\n      errorMessage.value =\n        \"Gagal terhubung ke server. Pastikan backend berjalan di port 8081.\";\n    }\n  } finally {\n    loading.value = false;\n  }\n};\n\nonMounted(fetchData);\n\n// Logika filter\nfunction applyFilter() {\n  if (!isFilterValid.value) {\n    errorMessage.value = \"Harap masukkan kedua tanggal yang valid.\";\n    return;\n  }\n  fetchData();\n}\n\nfunction resetFilter() {\n  filters.value.startDate = \"\";\n  filters.value.endDate = \"\";\n  isFilterValid.value = false;\n  errorMessage.value = \"\";\n  fetchData();\n}\n\nconst filteredData = computed(() => flattenedData.value);\n\n// Watch untuk validasi otomatis saat input berubah\nwatch(() => filters.value, validateFilters, { immediate: true });\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}