{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.flat-map.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.set.difference.v2.js\";\nimport \"core-js/modules/es.set.intersection.v2.js\";\nimport \"core-js/modules/es.set.is-disjoint-from.v2.js\";\nimport \"core-js/modules/es.set.is-subset-of.v2.js\";\nimport \"core-js/modules/es.set.is-superset-of.v2.js\";\nimport \"core-js/modules/es.set.symmetric-difference.v2.js\";\nimport \"core-js/modules/es.set.union.v2.js\";\nimport { ref, onMounted } from \"vue\";\nimport PurchasingLayouts from \"../components/PurchasingLayouts.vue\";\nimport api from \"../services/api.js\";\n\n// State untuk menyimpan data dashboard\n\nexport default {\n  __name: 'DashboardPembelian',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const dashboardData = ref({\n      purchase_orders_to_process: 0,\n      returns_to_review: 0,\n      products_in_stock: 0\n    });\n    const loading = ref(true);\n\n    // Helper untuk mengambil total dari berbagai bentuk respons API\n    function getTotalFromResponse(resp) {\n      if (!resp) return 0;\n      const d = resp.data ?? resp;\n      // Cek berbagai struktur yang mungkin dari backend\n      return d.total ?? d?.data?.total ?? d?.meta?.total ?? d?.data?.meta?.total ?? 0;\n    }\n\n    // Helper untuk mendapatkan array purchases dari respons\n    function getPurchasesArray(resp) {\n      if (!resp) return [];\n      const d = resp.data ?? resp;\n      return d?.data?.data ?? d?.data ?? d?.items ?? [];\n    }\n\n    // Fungsi untuk mengambil data dari backend (menggunakan instance `api`)\n    const fetchDashboardData = async () => {\n      try {\n        loading.value = true;\n\n        // Ambil jumlah purchase orders dengan status SUBMITTED\n        const purchaseResponse = await api.get(\"/pembelian/purchases\", {\n          params: {\n            status: \"SUBMITTED\",\n            size: 1\n          }\n        });\n        dashboardData.value.purchase_orders_to_process = getTotalFromResponse(purchaseResponse) || 0;\n\n        // Ambil jumlah purchase returns dengan status PENDING\n        const returnResponse = await api.get(\"/pembelian/purchase-returns\", {\n          params: {\n            status: \"PENDING\",\n            size: 1\n          }\n        });\n        dashboardData.value.returns_to_review = getTotalFromResponse(returnResponse);\n\n        // Ambil data pembelian (lebih banyak) untuk menghitung produk yang ada di stok\n        const allPurchasesResponse = await api.get(\"/pembelian/purchases\", {\n          params: {\n            size: 200\n          }\n        });\n        const purchases = getPurchasesArray(allPurchasesResponse);\n\n        // Flatten items dengan fallback properti yang berbeda\n        const allItems = purchases.flatMap(purchase => {\n          return purchase.Items ?? purchase.items ?? purchase.PurchaseItems ?? [];\n        });\n\n        // Hitung produk unik dimana stock > 0 dengan fallback nama properti\n        const uniqueProducts = new Set();\n        allItems.forEach(item => {\n          const product = item.Product ?? item.product ?? item.ProductDto ?? {};\n          const stock = product.stock ?? product.Stock ?? product.qty ?? 0;\n          const id = product.id ?? product.ID ?? product.product_id ?? null;\n          if (id && Number(stock) > 0) uniqueProducts.add(String(id));\n        });\n        dashboardData.value.products_in_stock = uniqueProducts.size;\n      } catch (error) {\n        console.error(\"Gagal mengambil data dashboard:\", error);\n        if (error.response) {\n          if (error.response.status === 401) {\n            console.error(\"Sesi Anda telah berakhir. Silakan login kembali.\");\n          } else if (error.response.status === 404) {\n            console.error(\"Endpoint tidak ditemukan. Periksa konfigurasi server.\");\n          } else {\n            console.error(\"Terjadi kesalahan saat memuat data:\", error.message);\n          }\n        } else {\n          console.error(\"Koneksi ke server gagal. Periksa jaringan Anda.\");\n        }\n      } finally {\n        loading.value = false;\n      }\n    };\n\n    // Panggil fungsi saat komponen dimuat\n    onMounted(fetchDashboardData);\n    const __returned__ = {\n      dashboardData,\n      loading,\n      getTotalFromResponse,\n      getPurchasesArray,\n      fetchDashboardData,\n      ref,\n      onMounted,\n      PurchasingLayouts,\n      get api() {\n        return api;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","PurchasingLayouts","api","dashboardData","purchase_orders_to_process","returns_to_review","products_in_stock","loading","getTotalFromResponse","resp","d","data","total","meta","getPurchasesArray","items","fetchDashboardData","value","purchaseResponse","get","params","status","size","returnResponse","allPurchasesResponse","purchases","allItems","flatMap","purchase","Items","PurchaseItems","uniqueProducts","Set","forEach","item","product","Product","ProductDto","stock","Stock","qty","id","ID","product_id","Number","add","String","error","console","response","message"],"sources":["C:/Users/Personal/Documents/PKL/PKL Shop Managements/vue/src/views/DashboardPembelian.vue"],"sourcesContent":["<template>\n  <PurchasingLayouts>\n    <div class=\"p-8\">\n      <div class=\"mb-6\">\n        <h1\n          class=\"text-[#111418] text-[32px] font-bold leading-tight tracking-[-0.015em]\"\n        >\n          Purchase Dashboard\n        </h1>\n        <p class=\"text-[#60758a] text-sm font-normal leading-normal mt-1\">\n          Welcome back, Sarah! Here's an overview of your purchase activities.\n        </p>\n      </div>\n\n      <div v-if=\"loading\" class=\"text-center text-[#60758a]\">\n        Memuat data...\n      </div>\n      <div v-else class=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8\">\n        <div class=\"flex flex-col gap-2 rounded-lg p-6 border border-[#dbe0e6]\">\n          <p class=\"text-[#111418] text-base font-medium leading-normal\">\n            Purchase Orders to Process\n          </p>\n          <p class=\"text-[#111418] text-2xl font-bold leading-tight\">\n            {{ dashboardData.purchase_orders_to_process || 0 }}\n          </p>\n        </div>\n        <div class=\"flex flex-col gap-2 rounded-lg p-6 border border-[#dbe0e6]\">\n          <p class=\"text-[#111418] text-base font-medium leading-normal\">\n            Returns to Review\n          </p>\n          <p class=\"text-[#111418] text-2xl font-bold leading-tight\">\n            {{ dashboardData.returns_to_review || 0 }}\n          </p>\n        </div>\n        <div class=\"flex flex-col gap-2 rounded-lg p-6 border border-[#dbe0e6]\">\n          <p class=\"text-[#111418] text-base font-medium leading-normal\">\n            Products in Stock\n          </p>\n          <p class=\"text-[#111418] text-2xl font-bold leading-tight\">\n            {{ dashboardData.products_in_stock || 0 }}\n          </p>\n        </div>\n      </div>\n    </div>\n  </PurchasingLayouts>\n</template>\n\n<script setup>\nimport { ref, onMounted } from \"vue\";\nimport PurchasingLayouts from \"../components/PurchasingLayouts.vue\";\nimport api from \"../services/api.js\";\n\n// State untuk menyimpan data dashboard\nconst dashboardData = ref({\n  purchase_orders_to_process: 0,\n  returns_to_review: 0,\n  products_in_stock: 0,\n});\nconst loading = ref(true);\n\n// Helper untuk mengambil total dari berbagai bentuk respons API\nfunction getTotalFromResponse(resp) {\n  if (!resp) return 0;\n  const d = resp.data ?? resp;\n  // Cek berbagai struktur yang mungkin dari backend\n  return (\n    d.total ?? d?.data?.total ?? d?.meta?.total ?? d?.data?.meta?.total ?? 0\n  );\n}\n\n// Helper untuk mendapatkan array purchases dari respons\nfunction getPurchasesArray(resp) {\n  if (!resp) return [];\n  const d = resp.data ?? resp;\n  return d?.data?.data ?? d?.data ?? d?.items ?? [];\n}\n\n// Fungsi untuk mengambil data dari backend (menggunakan instance `api`)\nconst fetchDashboardData = async () => {\n  try {\n    loading.value = true;\n\n    // Ambil jumlah purchase orders dengan status SUBMITTED\n    const purchaseResponse = await api.get(\"/pembelian/purchases\", {\n      params: { status: \"SUBMITTED\", size: 1 },\n    });\n    dashboardData.value.purchase_orders_to_process =\n      getTotalFromResponse(purchaseResponse) || 0;\n\n    // Ambil jumlah purchase returns dengan status PENDING\n    const returnResponse = await api.get(\"/pembelian/purchase-returns\", {\n      params: { status: \"PENDING\", size: 1 },\n    });\n    dashboardData.value.returns_to_review =\n      getTotalFromResponse(returnResponse);\n\n    // Ambil data pembelian (lebih banyak) untuk menghitung produk yang ada di stok\n    const allPurchasesResponse = await api.get(\"/pembelian/purchases\", {\n      params: { size: 200 },\n    });\n\n    const purchases = getPurchasesArray(allPurchasesResponse);\n\n    // Flatten items dengan fallback properti yang berbeda\n    const allItems = purchases.flatMap((purchase) => {\n      return purchase.Items ?? purchase.items ?? purchase.PurchaseItems ?? [];\n    });\n\n    // Hitung produk unik dimana stock > 0 dengan fallback nama properti\n    const uniqueProducts = new Set();\n    allItems.forEach((item) => {\n      const product = item.Product ?? item.product ?? item.ProductDto ?? {};\n      const stock = product.stock ?? product.Stock ?? product.qty ?? 0;\n      const id = product.id ?? product.ID ?? product.product_id ?? null;\n      if (id && Number(stock) > 0) uniqueProducts.add(String(id));\n    });\n\n    dashboardData.value.products_in_stock = uniqueProducts.size;\n  } catch (error) {\n    console.error(\"Gagal mengambil data dashboard:\", error);\n    if (error.response) {\n      if (error.response.status === 401) {\n        console.error(\"Sesi Anda telah berakhir. Silakan login kembali.\");\n      } else if (error.response.status === 404) {\n        console.error(\"Endpoint tidak ditemukan. Periksa konfigurasi server.\");\n      } else {\n        console.error(\"Terjadi kesalahan saat memuat data:\", error.message);\n      }\n    } else {\n      console.error(\"Koneksi ke server gagal. Periksa jaringan Anda.\");\n    }\n  } finally {\n    loading.value = false;\n  }\n};\n\n// Panggil fungsi saat komponen dimuat\nonMounted(fetchDashboardData);\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}