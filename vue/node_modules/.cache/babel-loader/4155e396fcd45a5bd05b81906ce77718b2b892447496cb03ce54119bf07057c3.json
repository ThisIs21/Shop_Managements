{"ast":null,"code":"import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, withCtx as _withCtx, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"p-8\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"text-center text-[#60758a]\"\n};\nconst _hoisted_3 = {\n  key: 1,\n  class: \"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8\"\n};\nconst _hoisted_4 = {\n  class: \"flex flex-col gap-2 rounded-lg p-6 border border-[#dbe0e6]\"\n};\nconst _hoisted_5 = {\n  class: \"text-[#111418] text-2xl font-bold leading-tight\"\n};\nconst _hoisted_6 = {\n  class: \"flex flex-col gap-2 rounded-lg p-6 border border-[#dbe0e6]\"\n};\nconst _hoisted_7 = {\n  class: \"text-[#111418] text-2xl font-bold leading-tight\"\n};\nconst _hoisted_8 = {\n  class: \"flex flex-col gap-2 rounded-lg p-6 border border-[#dbe0e6]\"\n};\nconst _hoisted_9 = {\n  class: \"text-[#111418] text-2xl font-bold leading-tight\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createBlock($setup[\"PurchasingLayouts\"], null, {\n    default: _withCtx(() => [_createElementVNode(\"div\", _hoisted_1, [_cache[3] || (_cache[3] = _createElementVNode(\"div\", {\n      class: \"mb-6\"\n    }, [_createElementVNode(\"h1\", {\n      class: \"text-[#111418] text-[32px] font-bold leading-tight tracking-[-0.015em]\"\n    }, \" Purchase Dashboard \"), _createElementVNode(\"p\", {\n      class: \"text-[#60758a] text-sm font-normal leading-normal mt-1\"\n    }, \" Welcome back, Sarah! Here's an overview of your purchase activities. \")], -1 /* CACHED */)), $setup.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, \" Memuat data... \")) : (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [_createElementVNode(\"div\", _hoisted_4, [_cache[0] || (_cache[0] = _createElementVNode(\"p\", {\n      class: \"text-[#111418] text-base font-medium leading-normal\"\n    }, \" Purchase Orders to Process \", -1 /* CACHED */)), _createElementVNode(\"p\", _hoisted_5, _toDisplayString($setup.dashboardData.purchase_orders_to_process || 0), 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_6, [_cache[1] || (_cache[1] = _createElementVNode(\"p\", {\n      class: \"text-[#111418] text-base font-medium leading-normal\"\n    }, \" Returns to Review \", -1 /* CACHED */)), _createElementVNode(\"p\", _hoisted_7, _toDisplayString($setup.dashboardData.returns_to_review || 0), 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_8, [_cache[2] || (_cache[2] = _createElementVNode(\"p\", {\n      class: \"text-[#111418] text-base font-medium leading-normal\"\n    }, \" Products in Stock \", -1 /* CACHED */)), _createElementVNode(\"p\", _hoisted_9, _toDisplayString($setup.dashboardData.products_in_stock || 0), 1 /* TEXT */)])]))])]),\n    _: 1 /* STABLE */\n  });\n}","map":{"version":3,"names":["class","_createBlock","$setup","_createElementVNode","_hoisted_1","loading","_createElementBlock","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_toDisplayString","dashboardData","purchase_orders_to_process","_hoisted_6","_hoisted_7","returns_to_review","_hoisted_8","_hoisted_9","products_in_stock"],"sources":["C:\\Users\\Personal\\Documents\\PKL\\PKL Shop Managements\\vue\\src\\views\\DashboardPembelian.vue"],"sourcesContent":["<template>\n  <PurchasingLayouts>\n    <div class=\"p-8\">\n      <div class=\"mb-6\">\n        <h1\n          class=\"text-[#111418] text-[32px] font-bold leading-tight tracking-[-0.015em]\"\n        >\n          Purchase Dashboard\n        </h1>\n        <p class=\"text-[#60758a] text-sm font-normal leading-normal mt-1\">\n          Welcome back, Sarah! Here's an overview of your purchase activities.\n        </p>\n      </div>\n\n      <div v-if=\"loading\" class=\"text-center text-[#60758a]\">\n        Memuat data...\n      </div>\n      <div v-else class=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8\">\n        <div class=\"flex flex-col gap-2 rounded-lg p-6 border border-[#dbe0e6]\">\n          <p class=\"text-[#111418] text-base font-medium leading-normal\">\n            Purchase Orders to Process\n          </p>\n          <p class=\"text-[#111418] text-2xl font-bold leading-tight\">\n            {{ dashboardData.purchase_orders_to_process || 0 }}\n          </p>\n        </div>\n        <div class=\"flex flex-col gap-2 rounded-lg p-6 border border-[#dbe0e6]\">\n          <p class=\"text-[#111418] text-base font-medium leading-normal\">\n            Returns to Review\n          </p>\n          <p class=\"text-[#111418] text-2xl font-bold leading-tight\">\n            {{ dashboardData.returns_to_review || 0 }}\n          </p>\n        </div>\n        <div class=\"flex flex-col gap-2 rounded-lg p-6 border border-[#dbe0e6]\">\n          <p class=\"text-[#111418] text-base font-medium leading-normal\">\n            Products in Stock\n          </p>\n          <p class=\"text-[#111418] text-2xl font-bold leading-tight\">\n            {{ dashboardData.products_in_stock || 0 }}\n          </p>\n        </div>\n      </div>\n    </div>\n  </PurchasingLayouts>\n</template>\n\n<script setup>\nimport { ref, onMounted } from \"vue\";\nimport PurchasingLayouts from \"../components/PurchasingLayouts.vue\";\nimport api from \"../services/api.js\";\n\n// State untuk menyimpan data dashboard\nconst dashboardData = ref({\n  purchase_orders_to_process: 0,\n  returns_to_review: 0,\n  products_in_stock: 0,\n});\nconst loading = ref(true);\n\n// Helper untuk mengambil total dari berbagai bentuk respons API\nfunction getTotalFromResponse(resp) {\n  if (!resp) return 0;\n  const d = resp.data ?? resp;\n  // Cek berbagai struktur yang mungkin dari backend\n  return (\n    d.total ?? d?.data?.total ?? d?.meta?.total ?? d?.data?.meta?.total ?? 0\n  );\n}\n\n// Helper untuk mendapatkan array purchases dari respons\nfunction getPurchasesArray(resp) {\n  if (!resp) return [];\n  const d = resp.data ?? resp;\n  return d?.data?.data ?? d?.data ?? d?.items ?? [];\n}\n\n// Fungsi untuk mengambil data dari backend (menggunakan instance `api`)\nconst fetchDashboardData = async () => {\n  try {\n    loading.value = true;\n\n    // Ambil jumlah purchase orders dengan status SUBMITTED\n    const purchaseResponse = await api.get(\"/pembelian/purchases\", {\n      params: { status: \"SUBMITTED\", size: 1 },\n    });\n    dashboardData.value.purchase_orders_to_process =\n      getTotalFromResponse(purchaseResponse) || 0;\n\n    // Ambil jumlah purchase returns dengan status PENDING\n    const returnResponse = await api.get(\"/pembelian/purchase-returns\", {\n      params: { status: \"PENDING\", size: 1 },\n    });\n    dashboardData.value.returns_to_review =\n      getTotalFromResponse(returnResponse);\n\n    // Ambil data pembelian (lebih banyak) untuk menghitung produk yang ada di stok\n    const allPurchasesResponse = await api.get(\"/pembelian/purchases\", {\n      params: { size: 200 },\n    });\n\n    const purchases = getPurchasesArray(allPurchasesResponse);\n\n    // Flatten items dengan fallback properti yang berbeda\n    const allItems = purchases.flatMap((purchase) => {\n      return purchase.Items ?? purchase.items ?? purchase.PurchaseItems ?? [];\n    });\n\n    // Hitung produk unik dimana stock > 0 dengan fallback nama properti\n    const uniqueProducts = new Set();\n    allItems.forEach((item) => {\n      const product = item.Product ?? item.product ?? item.ProductDto ?? {};\n      const stock = product.stock ?? product.Stock ?? product.qty ?? 0;\n      const id = product.id ?? product.ID ?? product.product_id ?? null;\n      if (id && Number(stock) > 0) uniqueProducts.add(String(id));\n    });\n\n    dashboardData.value.products_in_stock = uniqueProducts.size;\n  } catch (error) {\n    console.error(\"Gagal mengambil data dashboard:\", error);\n    if (error.response) {\n      if (error.response.status === 401) {\n        console.error(\"Sesi Anda telah berakhir. Silakan login kembali.\");\n      } else if (error.response.status === 404) {\n        console.error(\"Endpoint tidak ditemukan. Periksa konfigurasi server.\");\n      } else {\n        console.error(\"Terjadi kesalahan saat memuat data:\", error.message);\n      }\n    } else {\n      console.error(\"Koneksi ke server gagal. Periksa jaringan Anda.\");\n    }\n  } finally {\n    loading.value = false;\n  }\n};\n\n// Panggil fungsi saat komponen dimuat\nonMounted(fetchDashboardData);\n</script>\n"],"mappings":";;EAESA,KAAK,EAAC;AAAK;;;EAYMA,KAAK,EAAC;;;;EAGdA,KAAK,EAAC;;;EACXA,KAAK,EAAC;AAA4D;;EAIlEA,KAAK,EAAC;AAAiD;;EAIvDA,KAAK,EAAC;AAA4D;;EAIlEA,KAAK,EAAC;AAAiD;;EAIvDA,KAAK,EAAC;AAA4D;;EAIlEA,KAAK,EAAC;AAAiD;;uBArClEC,YAAA,CA2CoBC,MAAA;sBA1ClB,MAyCM,CAzCNC,mBAAA,CAyCM,OAzCNC,UAyCM,G,0BAxCJD,mBAAA,CASM;MATDH,KAAK,EAAC;IAAM,IACfG,mBAAA,CAIK;MAHHH,KAAK,EAAC;IAAwE,GAC/E,sBAED,GACAG,mBAAA,CAEI;MAFDH,KAAK,EAAC;IAAwD,GAAC,wEAElE,E,qBAGSE,MAAA,CAAAG,OAAO,I,cAAlBC,mBAAA,CAEM,OAFNC,UAEM,EAFiD,kBAEvD,M,cACAD,mBAAA,CAyBM,OAzBNE,UAyBM,GAxBJL,mBAAA,CAOM,OAPNM,UAOM,G,0BANJN,mBAAA,CAEI;MAFDH,KAAK,EAAC;IAAqD,GAAC,8BAE/D,qBACAG,mBAAA,CAEI,KAFJO,UAEI,EAAAC,gBAAA,CADCT,MAAA,CAAAU,aAAa,CAACC,0BAA0B,sB,GAG/CV,mBAAA,CAOM,OAPNW,UAOM,G,0BANJX,mBAAA,CAEI;MAFDH,KAAK,EAAC;IAAqD,GAAC,qBAE/D,qBACAG,mBAAA,CAEI,KAFJY,UAEI,EAAAJ,gBAAA,CADCT,MAAA,CAAAU,aAAa,CAACI,iBAAiB,sB,GAGtCb,mBAAA,CAOM,OAPNc,UAOM,G,0BANJd,mBAAA,CAEI;MAFDH,KAAK,EAAC;IAAqD,GAAC,qBAE/D,qBACAG,mBAAA,CAEI,KAFJe,UAEI,EAAAP,gBAAA,CADCT,MAAA,CAAAU,aAAa,CAACO,iBAAiB,sB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}