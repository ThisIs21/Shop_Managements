{"ast":null,"code":"import \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport { ref, onMounted } from \"vue\";\nimport axios from \"axios\";\nimport OwnerLayout from \"../layouts/OwnerLayout.vue\"; // pastikan path ini sesuai\n\nexport default {\n  __name: 'ReportStockOpnameOwners',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const filters = ref({\n      startDate: \"\",\n      endDate: \"\"\n    });\n    const reportData = ref([]);\n    const loading = ref(false);\n    const error = ref(null);\n\n    // fungsi format tanggal tanpa dayjs\n    const formatDate = dateStr => {\n      if (!dateStr) return \"-\";\n      const date = new Date(dateStr);\n      if (isNaN(date)) return dateStr; // fallback kalau backend kasih format aneh\n      return date.toLocaleDateString(\"id-ID\", {\n        year: \"numeric\",\n        month: \"long\",\n        day: \"numeric\"\n      });\n    };\n\n    // ambil data laporan\n    const fetchReport = async () => {\n      loading.value = true;\n      error.value = null;\n      try {\n        const response = await axios.get(\"http://localhost:8081/api/v1/history/stock-opname\", {\n          params: {\n            startDate: filters.value.startDate,\n            endDate: filters.value.endDate\n          }\n        });\n\n        // backend golang biasanya bungkus di data.data atau langsung data\n        reportData.value = response.data.data || response.data || [];\n      } catch (err) {\n        console.error(\"Failed to fetch report data:\", err);\n        error.value = \"Gagal memuat data laporan.\";\n      } finally {\n        loading.value = false;\n      }\n    };\n\n    // export csv/pdf\n    const exportReport = async type => {\n      try {\n        const response = await axios.get(`http://localhost:8081/api/v1/history/stock-opname?export=${type}`, {\n          params: {\n            startDate: filters.value.startDate,\n            endDate: filters.value.endDate\n          },\n          responseType: \"blob\" // biar bisa download file\n        });\n        const blob = new Blob([response.data], {\n          type: type === \"csv\" ? \"text/csv\" : \"application/pdf\"\n        });\n        const link = document.createElement(\"a\");\n        link.href = window.URL.createObjectURL(blob);\n        link.download = `stock-opname-report.${type}`;\n        link.click();\n      } catch (err) {\n        console.error(\"Export failed:\", err);\n        alert(\"Gagal export laporan\");\n      }\n    };\n    onMounted(fetchReport);\n    const __returned__ = {\n      filters,\n      reportData,\n      loading,\n      error,\n      formatDate,\n      fetchReport,\n      exportReport,\n      ref,\n      onMounted,\n      get axios() {\n        return axios;\n      },\n      OwnerLayout\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","axios","OwnerLayout","filters","startDate","endDate","reportData","loading","error","formatDate","dateStr","date","Date","isNaN","toLocaleDateString","year","month","day","fetchReport","value","response","get","params","data","err","console","exportReport","type","responseType","blob","Blob","link","document","createElement","href","window","URL","createObjectURL","download","click","alert"],"sources":["C:/Users/Personal/Documents/PKL/aplikasi/aplikasi/src/views/ReportStockOpnameOwners.vue"],"sourcesContent":["<template>\n  <OwnerLayout>\n    <div class=\"p-4\">\n      <!-- FILTER -->\n      <div class=\"flex gap-4 mb-4\">\n        <input\n          type=\"date\"\n          v-model=\"filters.startDate\"\n          class=\"border p-2 rounded\"\n        />\n        <input\n          type=\"date\"\n          v-model=\"filters.endDate\"\n          class=\"border p-2 rounded\"\n        />\n        <button\n          @click=\"fetchReport\"\n          class=\"bg-blue-500 text-white px-4 py-2 rounded\"\n        >\n          Filter\n        </button>\n\n        <!-- EXPORT -->\n        <button\n          @click=\"exportReport('csv')\"\n          class=\"bg-green-500 text-white px-4 py-2 rounded\"\n        >\n          Export CSV\n        </button>\n        <button\n          @click=\"exportReport('pdf')\"\n          class=\"bg-red-500 text-white px-4 py-2 rounded\"\n        >\n          Export PDF\n        </button>\n      </div>\n\n      <!-- LOADING -->\n      <div v-if=\"loading\">Loading...</div>\n      <div v-else-if=\"error\" class=\"text-red-500\">{{ error }}</div>\n\n      <!-- TABLE -->\n      <table v-else class=\"min-w-full border\">\n        <thead class=\"bg-gray-200\">\n          <tr>\n            <th class=\"border px-4 py-2\">Tanggal</th>\n            <th class=\"border px-4 py-2\">Nama Barang</th>\n            <th class=\"border px-4 py-2\">Stok Sebelum</th>\n            <th class=\"border px-4 py-2\">Stok Sesudah</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr v-for=\"(item, idx) in reportData\" :key=\"idx\">\n            <td class=\"border px-4 py-2\">{{ formatDate(item.date) }}</td>\n            <td class=\"border px-4 py-2\">{{ item.product_name }}</td>\n            <td class=\"border px-4 py-2\">{{ item.stock_before }}</td>\n            <td class=\"border px-4 py-2\">{{ item.stock_after }}</td>\n          </tr>\n          <tr v-if=\"reportData.length === 0\">\n            <td colspan=\"4\" class=\"text-center py-4 text-gray-500\">\n              Tidak ada data untuk ditampilkan\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </OwnerLayout>\n</template>\n\n<script setup>\nimport { ref, onMounted } from \"vue\";\nimport axios from \"axios\";\nimport OwnerLayout from \"../layouts/OwnerLayout.vue\"; // pastikan path ini sesuai\n\nconst filters = ref({\n  startDate: \"\",\n  endDate: \"\",\n});\n\nconst reportData = ref([]);\nconst loading = ref(false);\nconst error = ref(null);\n\n// fungsi format tanggal tanpa dayjs\nconst formatDate = (dateStr) => {\n  if (!dateStr) return \"-\";\n  const date = new Date(dateStr);\n  if (isNaN(date)) return dateStr; // fallback kalau backend kasih format aneh\n  return date.toLocaleDateString(\"id-ID\", {\n    year: \"numeric\",\n    month: \"long\",\n    day: \"numeric\",\n  });\n};\n\n// ambil data laporan\nconst fetchReport = async () => {\n  loading.value = true;\n  error.value = null;\n\n  try {\n    const response = await axios.get(\n      \"http://localhost:8081/api/v1/history/stock-opname\",\n      {\n        params: {\n          startDate: filters.value.startDate,\n          endDate: filters.value.endDate,\n        },\n      }\n    );\n\n    // backend golang biasanya bungkus di data.data atau langsung data\n    reportData.value = response.data.data || response.data || [];\n  } catch (err) {\n    console.error(\"Failed to fetch report data:\", err);\n    error.value = \"Gagal memuat data laporan.\";\n  } finally {\n    loading.value = false;\n  }\n};\n\n// export csv/pdf\nconst exportReport = async (type) => {\n  try {\n    const response = await axios.get(\n      `http://localhost:8081/api/v1/history/stock-opname?export=${type}`,\n      {\n        params: {\n          startDate: filters.value.startDate,\n          endDate: filters.value.endDate,\n        },\n        responseType: \"blob\", // biar bisa download file\n      }\n    );\n\n    const blob = new Blob([response.data], {\n      type: type === \"csv\" ? \"text/csv\" : \"application/pdf\",\n    });\n    const link = document.createElement(\"a\");\n    link.href = window.URL.createObjectURL(blob);\n    link.download = `stock-opname-report.${type}`;\n    link.click();\n  } catch (err) {\n    console.error(\"Export failed:\", err);\n    alert(\"Gagal export laporan\");\n  }\n};\n\nonMounted(fetchReport);\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}