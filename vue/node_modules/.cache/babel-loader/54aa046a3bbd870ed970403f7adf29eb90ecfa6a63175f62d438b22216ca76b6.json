{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport { ref, onMounted } from \"vue\";\nimport KepalaGudangLayouts from \"@/components/KepalaGudangLayouts.vue\";\nimport api from \"../services/api.js\";\n\n// State untuk dashboard\n\nexport default {\n  __name: 'DashboardKepalagudang',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const loading = ref(true);\n    const errorMessage = ref(\"\");\n    const dashboard = ref({\n      purchase_orders_pending: 0,\n      purchase_returns_pending: 0,\n      products_low_stock: 0,\n      products_in_stock: 0\n    });\n\n    // Helper untuk mengambil total dari berbagai struktur respons\n    function getTotalFromResponse(resp) {\n      if (!resp) return 0;\n      const d = resp.data ?? resp;\n      return d.total ?? d?.data?.total ?? d?.meta?.total ?? d?.data?.meta?.total ?? 0;\n    }\n\n    // Ambil array produk dari respons\n    function getProductsArray(resp) {\n      if (!resp) return [];\n      const d = resp.data ?? resp;\n      return d?.data ?? d?.items ?? d?.products ?? [];\n    }\n\n    // Fungsi untuk mengambil data dashboard\n    const fetchDashboard = async () => {\n      loading.value = true;\n      errorMessage.value = \"\";\n      try {\n        // 1) Purchase orders pending approval (SUBMITTED)\n        const poResp = await api.get(\"/pembelian/purchases\", {\n          params: {\n            status: \"SUBMITTED\",\n            size: 1\n          }\n        });\n        dashboard.value.purchase_orders_pending = getTotalFromResponse(poResp);\n\n        // 2) Purchase returns pending - try several possible endpoints used in the app\n        let prResp = null;\n        const prEndpoints = [\"/pembelian/purchase-returns\", \"/gudang/purchase-returns\", \"/history/purchase-returns\", \"/purchase-returns\"];\n        let lastPrError = null;\n        for (const ep of prEndpoints) {\n          try {\n            prResp = await api.get(ep, {\n              params: {\n                status: \"PENDING\",\n                size: 1\n              }\n            });\n            // if succeeded, break\n            break;\n          } catch (e) {\n            // record last error and continue to try other endpoints\n            lastPrError = e;\n            // continue for any error (404, 403, etc.) so other paths can be tried\n            continue;\n          }\n        }\n        if (prResp) {\n          dashboard.value.purchase_returns_pending = getTotalFromResponse(prResp);\n        } else {\n          // if none found, set 0 and append warning to errorMessage with details from lastPrError\n          dashboard.value.purchase_returns_pending = 0;\n          if (lastPrError && lastPrError.response) {\n            const st = lastPrError.response.status;\n            let b = \"\";\n            try {\n              b = typeof lastPrError.response.data === \"string\" ? lastPrError.response.data : JSON.stringify(lastPrError.response.data);\n            } catch (e) {\n              b = String(lastPrError.response.data);\n            }\n            errorMessage.value = (errorMessage.value ? errorMessage.value + \" | \" : \"\") + `purchase-returns requests failed (last status ${st}): ${b}`;\n          } else if (lastPrError) {\n            errorMessage.value = (errorMessage.value ? errorMessage.value + \" | \" : \"\") + `purchase-returns requests failed: ${lastPrError.message || String(lastPrError)}`;\n          } else {\n            errorMessage.value = (errorMessage.value ? errorMessage.value + \" | \" : \"\") + \"purchase-returns endpoint not found (tried common paths).\";\n          }\n        }\n\n        // 3) Products list to compute low stock and in-stock counts\n        // try owner/products or /products depending on backend\n        let productsResp;\n        try {\n          productsResp = await api.get(\"/products\", {\n            params: {\n              size: 500\n            }\n          });\n        } catch (e) {\n          // fallback to owner/products\n          productsResp = await api.get(\"/owner/products\", {\n            params: {\n              size: 500\n            }\n          });\n        }\n        const products = getProductsArray(productsResp) || [];\n\n        // Threshold low stock (tweakable)\n        const LOW_STOCK_THRESHOLD = 5;\n        let lowCount = 0;\n        let inStockCount = 0;\n        products.forEach(p => {\n          const prod = p.Product ?? p.product ?? p; // support wrapped objects\n          const stock = Number(prod.stock ?? prod.Stock ?? prod.qty ?? prod.quantity ?? 0);\n          if (!Number.isNaN(stock)) {\n            if (stock <= LOW_STOCK_THRESHOLD) lowCount += 1;\n            if (stock > 0) inStockCount += 1;\n          }\n        });\n        dashboard.value.products_low_stock = lowCount;\n        dashboard.value.products_in_stock = inStockCount;\n      } catch (error) {\n        console.error(\"Gagal fetch dashboard Kepala Gudang:\", error);\n        // Build a detailed error message for UI debugging\n        if (error && error.response) {\n          const status = error.response.status;\n          const body = error.response.data;\n          let bodyText = \"\";\n          try {\n            bodyText = typeof body === \"string\" ? body : JSON.stringify(body);\n          } catch (e) {\n            bodyText = String(body);\n          }\n          errorMessage.value = `Request failed with status code ${status}: ${bodyText}`;\n        } else {\n          errorMessage.value = error?.message || String(error);\n        }\n      } finally {\n        loading.value = false;\n      }\n    };\n    onMounted(() => {\n      fetchDashboard();\n    });\n    const __returned__ = {\n      loading,\n      errorMessage,\n      dashboard,\n      getTotalFromResponse,\n      getProductsArray,\n      fetchDashboard,\n      ref,\n      onMounted,\n      KepalaGudangLayouts,\n      get api() {\n        return api;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","KepalaGudangLayouts","api","loading","errorMessage","dashboard","purchase_orders_pending","purchase_returns_pending","products_low_stock","products_in_stock","getTotalFromResponse","resp","d","data","total","meta","getProductsArray","items","products","fetchDashboard","value","poResp","get","params","status","size","prResp","prEndpoints","lastPrError","ep","e","response","st","b","JSON","stringify","String","message","productsResp","LOW_STOCK_THRESHOLD","lowCount","inStockCount","forEach","p","prod","Product","product","stock","Number","Stock","qty","quantity","isNaN","error","console","body","bodyText"],"sources":["C:/Users/Personal/Documents/PKL/PKL Shop Managements/vue/src/views/DashboardKepalagudang.vue"],"sourcesContent":["<template>\n  <KepalaGudangLayouts>\n    <div class=\"flex flex-wrap justify-between gap-3 p-4\">\n      <p\n        class=\"text-[#111418] tracking-light text-[32px] font-bold leading-tight min-w-72\"\n      >\n        Warehouse Manager Dashboard\n      </p>\n    </div>\n\n    <div class=\"p-4\">\n      <div class=\"mb-6\">\n        <p class=\"text-[#60758a] text-sm font-normal leading-normal mt-1\">\n          Welcome back â€” ringkasan aktivitas gudang terbaru.\n        </p>\n      </div>\n\n      <div v-if=\"loading\" class=\"text-center text-[#60758a]\">\n        Memuat data...\n      </div>\n\n      <div v-else>\n        <div v-if=\"errorMessage\" class=\"text-red-600 mb-4\">\n          {{ errorMessage }}\n        </div>\n\n        <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8\">\n          <div\n            class=\"flex flex-col gap-2 rounded-lg p-6 border border-[#dbe0e6]\"\n          >\n            <p class=\"text-[#111418] text-base font-medium leading-normal\">\n              Purchase Orders Pending\n            </p>\n            <p class=\"text-[#111418] text-2xl font-bold leading-tight\">\n              {{ dashboard.purchase_orders_pending || 0 }}\n            </p>\n          </div>\n\n          \n\n          <div\n            class=\"flex flex-col gap-2 rounded-lg p-6 border border-[#dbe0e6]\"\n          >\n            <p class=\"text-[#111418] text-base font-medium leading-normal\">\n              Products Low Stock (&le;5)\n            </p>\n            <p class=\"text-[#111418] text-2xl font-bold leading-tight\">\n              {{ dashboard.products_low_stock || 0 }}\n            </p>\n          </div>\n\n          <div\n            class=\"flex flex-col gap-2 rounded-lg p-6 border border-[#dbe0e6]\"\n          >\n            <p class=\"text-[#111418] text-base font-medium leading-normal\">\n              Products In Stock\n            </p>\n            <p class=\"text-[#111418] text-2xl font-bold leading-tight\">\n              {{ dashboard.products_in_stock || 0 }}\n            </p>\n          </div>\n        </div>\n\n        <div\n          class=\"flex flex-col gap-2 rounded-lg p-6 bg-[#f0f2f5] min-h-[120px]\"\n        >\n          <p\n            class=\"text-[#111418] tracking-light text-lg font-semibold leading-tight\"\n          >\n            Selamat datang, Kepala Gudang!\n          </p>\n          <p class=\"text-[#60758a] text-sm\">\n            Gunakan menu kiri untuk melihat permintaan dan katalog produk.\n          </p>\n        </div>\n      </div>\n    </div>\n  </KepalaGudangLayouts>\n</template>\n\n<script setup>\nimport { ref, onMounted } from \"vue\";\nimport KepalaGudangLayouts from \"@/components/KepalaGudangLayouts.vue\";\nimport api from \"../services/api.js\";\n\n// State untuk dashboard\nconst loading = ref(true);\nconst errorMessage = ref(\"\");\nconst dashboard = ref({\n  purchase_orders_pending: 0,\n  purchase_returns_pending: 0,\n  products_low_stock: 0,\n  products_in_stock: 0,\n});\n\n// Helper untuk mengambil total dari berbagai struktur respons\nfunction getTotalFromResponse(resp) {\n  if (!resp) return 0;\n  const d = resp.data ?? resp;\n  return (\n    d.total ?? d?.data?.total ?? d?.meta?.total ?? d?.data?.meta?.total ?? 0\n  );\n}\n\n// Ambil array produk dari respons\nfunction getProductsArray(resp) {\n  if (!resp) return [];\n  const d = resp.data ?? resp;\n  return d?.data ?? d?.items ?? d?.products ?? [];\n}\n\n// Fungsi untuk mengambil data dashboard\nconst fetchDashboard = async () => {\n  loading.value = true;\n  errorMessage.value = \"\";\n  try {\n    // 1) Purchase orders pending approval (SUBMITTED)\n    const poResp = await api.get(\"/pembelian/purchases\", {\n      params: { status: \"SUBMITTED\", size: 1 },\n    });\n    dashboard.value.purchase_orders_pending = getTotalFromResponse(poResp);\n\n    // 2) Purchase returns pending - try several possible endpoints used in the app\n    let prResp = null;\n    const prEndpoints = [\n      \"/pembelian/purchase-returns\",\n      \"/gudang/purchase-returns\",\n      \"/history/purchase-returns\",\n      \"/purchase-returns\",\n    ];\n    let lastPrError = null;\n    for (const ep of prEndpoints) {\n      try {\n        prResp = await api.get(ep, { params: { status: \"PENDING\", size: 1 } });\n        // if succeeded, break\n        break;\n      } catch (e) {\n        // record last error and continue to try other endpoints\n        lastPrError = e;\n        // continue for any error (404, 403, etc.) so other paths can be tried\n        continue;\n      }\n    }\n\n    if (prResp) {\n      dashboard.value.purchase_returns_pending = getTotalFromResponse(prResp);\n    } else {\n      // if none found, set 0 and append warning to errorMessage with details from lastPrError\n      dashboard.value.purchase_returns_pending = 0;\n      if (lastPrError && lastPrError.response) {\n        const st = lastPrError.response.status;\n        let b = \"\";\n        try {\n          b =\n            typeof lastPrError.response.data === \"string\"\n              ? lastPrError.response.data\n              : JSON.stringify(lastPrError.response.data);\n        } catch (e) {\n          b = String(lastPrError.response.data);\n        }\n        errorMessage.value =\n          (errorMessage.value ? errorMessage.value + \" | \" : \"\") +\n          `purchase-returns requests failed (last status ${st}): ${b}`;\n      } else if (lastPrError) {\n        errorMessage.value =\n          (errorMessage.value ? errorMessage.value + \" | \" : \"\") +\n          `purchase-returns requests failed: ${\n            lastPrError.message || String(lastPrError)\n          }`;\n      } else {\n        errorMessage.value =\n          (errorMessage.value ? errorMessage.value + \" | \" : \"\") +\n          \"purchase-returns endpoint not found (tried common paths).\";\n      }\n    }\n\n    // 3) Products list to compute low stock and in-stock counts\n    // try owner/products or /products depending on backend\n    let productsResp;\n    try {\n      productsResp = await api.get(\"/products\", { params: { size: 500 } });\n    } catch (e) {\n      // fallback to owner/products\n      productsResp = await api.get(\"/owner/products\", {\n        params: { size: 500 },\n      });\n    }\n\n    const products = getProductsArray(productsResp) || [];\n\n    // Threshold low stock (tweakable)\n    const LOW_STOCK_THRESHOLD = 5;\n\n    let lowCount = 0;\n    let inStockCount = 0;\n    products.forEach((p) => {\n      const prod = p.Product ?? p.product ?? p; // support wrapped objects\n      const stock = Number(\n        prod.stock ?? prod.Stock ?? prod.qty ?? prod.quantity ?? 0\n      );\n      if (!Number.isNaN(stock)) {\n        if (stock <= LOW_STOCK_THRESHOLD) lowCount += 1;\n        if (stock > 0) inStockCount += 1;\n      }\n    });\n\n    dashboard.value.products_low_stock = lowCount;\n    dashboard.value.products_in_stock = inStockCount;\n  } catch (error) {\n    console.error(\"Gagal fetch dashboard Kepala Gudang:\", error);\n    // Build a detailed error message for UI debugging\n    if (error && error.response) {\n      const status = error.response.status;\n      const body = error.response.data;\n      let bodyText = \"\";\n      try {\n        bodyText = typeof body === \"string\" ? body : JSON.stringify(body);\n      } catch (e) {\n        bodyText = String(body);\n      }\n      errorMessage.value = `Request failed with status code ${status}: ${bodyText}`;\n    } else {\n      errorMessage.value = error?.message || String(error);\n    }\n  } finally {\n    loading.value = false;\n  }\n};\n\nonMounted(() => {\n  fetchDashboard();\n});\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}