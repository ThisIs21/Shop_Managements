{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport { ref, computed, onMounted } from \"vue\";\nimport axios from \"axios\";\nimport OwnerLayout from \"../components/OwnerLayouts.vue\";\nexport default {\n  __name: 'ReportStockOpnameOwners',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const filters = ref({\n      startDate: \"\",\n      endDate: \"\"\n    });\n    const rawData = ref([]); // Data mentah dari API\n    const flattenedData = ref([]); // Data yang sudah diratakan dan siap tampil\n\n    // ambil token dari localStorage\n    const token = localStorage.getItem(\"token\");\n\n    /**\n     * Fungsi untuk meratakan data Stock Opname\n     * Menghasilkan array di mana setiap StockOpnameItem adalah 1 baris.\n     */\n    const flattenReportData = opnames => {\n      const flattened = [];\n      opnames.forEach(opname => {\n        // Cek apakah ada items\n        const items = opname.items && opname.items.length > 0 ? opname.items : [];\n        items.forEach(item => {\n          // Format data sesuai header tabel di template\n          flattened.push({\n            date: opname.date ? opname.date.substring(0, 10) : \"N/A\",\n            book_name: item.product?.name || \"N/A\",\n            // Nama Barang // MAPPING KOLOM\n            start_stock: item.systemStock || 0,\n            // Stok Awal (System Stock)\n            end_stock: item.physicalStock || 0,\n            // Stok Akhir (Physical Stock)\n            opname_id: opname.id,\n            item_id: item.id\n          });\n        });\n      });\n      return flattened;\n    };\n\n    // ambil data dari backend\n    const fetchData = async () => {\n      try {\n        // *** PERUBAHAN ENDPOINT: Ganti ke endpoint laporan yang dilindungi OWNER ***\n        // Anda juga bisa menambahkan filter tanggal di sini jika mau filter server-side\n        const url = \"http://localhost:8081/api/v1/owner/reports?type=stock-opnames\";\n        const res = await axios.get(url, {\n          headers: token ? {\n            Authorization: `Bearer ${token}`\n          } : undefined\n        }); // Data mentah adalah array di properti 'data'\n        rawData.value = res.data.data || []; // Rata-kan data untuk ditampilkan\n        flattenedData.value = flattenReportData(rawData.value);\n      } catch (err) {\n        console.error(\"Gagal ambil data laporan:\", err);\n      }\n    };\n    onMounted(fetchData);\n\n    // filter data di frontend (menggunakan data yang sudah diratakan)\n    const filteredData = computed(() => {\n      if (!filters.value.startDate || !filters.value.endDate) {\n        return flattenedData.value;\n      }\n      return flattenedData.value.filter(item => item.date >= filters.value.startDate && item.date <= filters.value.endDate);\n    });\n    function applyFilter() {\n      // Cukup computed property yang akan bekerja otomatis\n      console.log(\"Filter applied:\", filters.value);\n    }\n    const __returned__ = {\n      filters,\n      rawData,\n      flattenedData,\n      token,\n      flattenReportData,\n      fetchData,\n      filteredData,\n      applyFilter,\n      ref,\n      computed,\n      onMounted,\n      get axios() {\n        return axios;\n      },\n      OwnerLayout\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","axios","OwnerLayout","filters","startDate","endDate","rawData","flattenedData","token","localStorage","getItem","flattenReportData","opnames","flattened","forEach","opname","items","length","item","push","date","substring","book_name","product","name","start_stock","systemStock","end_stock","physicalStock","opname_id","id","item_id","fetchData","url","res","get","headers","Authorization","undefined","value","data","err","console","error","filteredData","filter","applyFilter","log"],"sources":["C:/Users/Personal/Documents/PKL/aplikasi/aplikasi/src/views/ReportStockOpnameOwners.vue"],"sourcesContent":["<template>\n  <OwnerLayout>\n    <div class=\"p-4\">\n      <!-- FILTER -->\n      <div class=\"flex gap-4 mb-4\">\n        <input\n          type=\"date\"\n          v-model=\"filters.startDate\"\n          class=\"border p-2 rounded\"\n        />\n        <input\n          type=\"date\"\n          v-model=\"filters.endDate\"\n          class=\"border p-2 rounded\"\n        />\n        <button\n          @click=\"applyFilter\"\n          class=\"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700\"\n        >\n          Terapkan\n        </button>\n      </div>\n\n      <!-- TABLE -->\n      <table class=\"w-full border-collapse border border-gray-300\">\n        <thead>\n          <tr class=\"bg-gray-100\">\n            <th class=\"border border-gray-300 px-4 py-2\">Tanggal</th>\n            <th class=\"border border-gray-300 px-4 py-2\">Nama Barang</th>\n            <th class=\"border border-gray-300 px-4 py-2\">Stok Awal</th>\n            <th class=\"border border-gray-300 px-4 py-2\">Stok Akhir</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr v-for=\"(item, index) in filteredData\" :key=\"index\">\n            <td class=\"border border-gray-300 px-4 py-2\">{{ item.date }}</td>\n            <td class=\"border border-gray-300 px-4 py-2\">\n              {{ item.book_name }}\n            </td>\n            <td class=\"border border-gray-300 px-4 py-2\">\n              {{ item.start_stock }}\n            </td>\n            <td class=\"border border-gray-300 px-4 py-2\">\n              {{ item.end_stock }}\n            </td>\n          </tr>\n          <tr v-if=\"filteredData.length === 0\">\n            <td colspan=\"4\" class=\"text-center py-4 text-gray-500\">\n              Tidak ada data\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </OwnerLayout>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted } from \"vue\";\nimport axios from \"axios\";\nimport OwnerLayout from \"../components/OwnerLayouts.vue\";\n\nconst filters = ref({\n  startDate: \"\",\n  endDate: \"\",\n});\n\nconst rawData = ref([]); // Data mentah dari API\nconst flattenedData = ref([]); // Data yang sudah diratakan dan siap tampil\n\n// ambil token dari localStorage\nconst token = localStorage.getItem(\"token\");\n\n/**\n * Fungsi untuk meratakan data Stock Opname\n * Menghasilkan array di mana setiap StockOpnameItem adalah 1 baris.\n */\nconst flattenReportData = (opnames) => {\n  const flattened = [];\n  opnames.forEach((opname) => {\n    // Cek apakah ada items\n    const items = opname.items && opname.items.length > 0 ? opname.items : [];\n\n    items.forEach((item) => {\n      // Format data sesuai header tabel di template\n      flattened.push({\n        date: opname.date ? opname.date.substring(0, 10) : \"N/A\",\n        book_name: item.product?.name || \"N/A\", // Nama Barang // MAPPING KOLOM\n        start_stock: item.systemStock || 0, // Stok Awal (System Stock)\n        end_stock: item.physicalStock || 0, // Stok Akhir (Physical Stock)\n        opname_id: opname.id,\n        item_id: item.id,\n      });\n    });\n  });\n  return flattened;\n};\n\n// ambil data dari backend\nconst fetchData = async () => {\n  try {\n    // *** PERUBAHAN ENDPOINT: Ganti ke endpoint laporan yang dilindungi OWNER ***\n    // Anda juga bisa menambahkan filter tanggal di sini jika mau filter server-side\n    const url = \"http://localhost:8081/api/v1/owner/reports?type=stock-opnames\";\n    const res = await axios.get(url, {\n      headers: token ? { Authorization: `Bearer ${token}` } : undefined,\n    }); // Data mentah adalah array di properti 'data'\n    rawData.value = res.data.data || []; // Rata-kan data untuk ditampilkan\n    flattenedData.value = flattenReportData(rawData.value);\n  } catch (err) {\n    console.error(\"Gagal ambil data laporan:\", err);\n  }\n};\n\nonMounted(fetchData);\n\n// filter data di frontend (menggunakan data yang sudah diratakan)\nconst filteredData = computed(() => {\n  if (!filters.value.startDate || !filters.value.endDate) {\n    return flattenedData.value;\n  }\n  return flattenedData.value.filter(\n    (item) =>\n      item.date >= filters.value.startDate && item.date <= filters.value.endDate\n  );\n});\n\nfunction applyFilter() {\n  // Cukup computed property yang akan bekerja otomatis\n  console.log(\"Filter applied:\", filters.value);\n}\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}