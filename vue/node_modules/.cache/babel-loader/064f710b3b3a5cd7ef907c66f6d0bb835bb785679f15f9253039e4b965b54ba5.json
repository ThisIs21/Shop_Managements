{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport { ref, computed, onMounted } from \"vue\";\nimport axios from \"axios\";\nimport OwnerLayout from \"../components/OwnerLayouts.vue\";\nexport default {\n  __name: 'ReportStockOpnameOwners',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const filters = ref({\n      startDate: \"\",\n      endDate: \"\"\n    });\n    const rawData = ref([]); // Data mentah dari API: array of StockOpname objects\n    const flattenedData = ref([]); // Data yang sudah diratakan dan siap tampil (satu baris per item buku)\n    const loading = ref(false);\n    const errorMessage = ref(\"\");\n\n    // Ambil token dari localStorage\n    const token = localStorage.getItem(\"token\");\n\n    /**\n     * Fungsi untuk meratakan data Stock Opname.\n     * Mengubah struktur data bersarang menjadi satu array item yang siap ditampilkan.\n     */\n    const flattenReportData = opnames => {\n      const flattened = [];\n      opnames.forEach(opname => {\n        const opnameDate = opname.date ? opname.date.substring(0, 10) : \"N/A\";\n\n        // Asumsi: 'opname.details' adalah array of items, BUKAN 'opname.items'\n        // Jika backend Anda menggunakan 'items', ganti 'opname.details' menjadi 'opname.items'\n        const items = opname.details && opname.details.length > 0 ? opname.details : [];\n        items.forEach(item => {\n          const system = item.system_stock || 0;\n          const physical = item.physical_stock || 0;\n          flattened.push({\n            date: opnameDate,\n            book_name: item.product_name || \"N/A\",\n            // Nama Barang\n            product_code: item.product_code || \"-\",\n            // Kode Barang\n            system_stock: system,\n            // Stok Awal/Sistem\n            physical_stock: physical,\n            // Stok Akhir/Fisik\n            difference: physical - system,\n            // Selisih\n            opname_id: opname.id\n          });\n        });\n      });\n      return flattened;\n    };\n\n    // Ambil data dari backend\n    const fetchData = async () => {\n      loading.value = true;\n      errorMessage.value = \"\";\n      try {\n        if (!token) {\n          errorMessage.value = \"Token autentikasi tidak ditemukan. Silakan login kembali.\";\n          return;\n        }\n\n        // ✅ PERBAIKAN ENDPOINT: Asumsi endpoint API yang benar\n        const url = \"http://localhost:8081/api/v1/owner/reports/stock-opname\";\n        const res = await axios.get(url, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        rawData.value = res.data.data || [];\n        flattenedData.value = flattenReportData(rawData.value);\n      } catch (err) {\n        console.error(\"Gagal ambil data laporan:\", err.response || err);\n        if (err.response) {\n          const status = err.response.status;\n          if (status === 500) {\n            errorMessage.value = `Kesalahan Internal Server (500). Detail: ${err.response.data?.error || 'Periksa log server Go.'}`;\n          } else if (status === 404) {\n            errorMessage.value = \"Endpoint API tidak ditemukan. Pastikan alamat: /api/v1/owner/reports/stock-opname sudah benar.\";\n          } else if (status === 401) {\n            errorMessage.value = \"Sesi Anda telah berakhir. Silakan login kembali.\";\n          } else {\n            errorMessage.value = `Gagal mengambil data laporan. Status: ${status}.`;\n          }\n        } else {\n          errorMessage.value = \"Gagal terhubung ke server. Pastikan backend berjalan di port 8081.\";\n        }\n      } finally {\n        loading.value = false;\n      }\n    };\n    onMounted(fetchData);\n\n    // Filter data di frontend berdasarkan tanggal (menggunakan data yang sudah diratakan)\n    const filteredData = computed(() => {\n      const {\n        startDate,\n        endDate\n      } = filters.value;\n      if (!startDate || !endDate) {\n        return flattenedData.value;\n      }\n\n      // Memastikan tanggal valid sebelum memfilter\n      const start = new Date(startDate).getTime();\n      const end = new Date(endDate).getTime();\n      if (isNaN(start) || isNaN(end)) {\n        return flattenedData.value; // Abaikan filter jika tanggal tidak valid\n      }\n      return flattenedData.value.filter(item => {\n        // Parsing tanggal item menjadi objek Date\n        const itemDate = new Date(item.date).getTime();\n\n        // Filter dengan menambahkan 1 hari (86400000 ms) ke endDate agar inklusif\n        return itemDate >= start && itemDate <= end;\n      });\n    });\n    function applyFilter() {\n      if (!filters.value.startDate || !filters.value.endDate) {\n        errorMessage.value = \"Harap masukkan kedua tanggal (Dari dan Sampai) untuk memfilter.\";\n        return;\n      }\n      errorMessage.value = \"\";\n      // Computed property akan otomatis memperbarui tampilan\n      console.log(\"Filter applied:\", filters.value);\n    }\n    function resetFilter() {\n      filters.value.startDate = \"\";\n      filters.value.endDate = \"\";\n      errorMessage.value = \"\";\n      // Computed property akan kembali menampilkan semua data\n    }\n    const __returned__ = {\n      filters,\n      rawData,\n      flattenedData,\n      loading,\n      errorMessage,\n      token,\n      flattenReportData,\n      fetchData,\n      filteredData,\n      applyFilter,\n      resetFilter,\n      ref,\n      computed,\n      onMounted,\n      get axios() {\n        return axios;\n      },\n      OwnerLayout\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","axios","OwnerLayout","filters","startDate","endDate","rawData","flattenedData","loading","errorMessage","token","localStorage","getItem","flattenReportData","opnames","flattened","forEach","opname","opnameDate","date","substring","items","details","length","item","system","system_stock","physical","physical_stock","push","book_name","product_name","product_code","difference","opname_id","id","fetchData","value","url","res","get","headers","Authorization","data","err","console","error","response","status","filteredData","start","Date","getTime","end","isNaN","filter","itemDate","applyFilter","log","resetFilter"],"sources":["C:/Users/Personal/Documents/PKL/aplikasi/aplikasi/src/views/ReportStockOpnameOwners.vue"],"sourcesContent":["<template>\n  <OwnerLayout>\n    <div class=\"p-4\">\n      <h1 class=\"text-2xl font-bold mb-4\">Laporan Stok Opname</h1>\n\n      <div\n        v-if=\"errorMessage\"\n        class=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4\"\n        role=\"alert\"\n      >\n        <span class=\"block sm:inline\">{{ errorMessage }}</span>\n      </div>\n\n      <div class=\"flex flex-wrap gap-4 mb-6 items-end\">\n        <label class=\"flex flex-col\">\n          <span class=\"text-sm font-medium mb-1\">Dari Tanggal</span>\n          <input\n            type=\"date\"\n            v-model=\"filters.startDate\"\n            class=\"border p-2 rounded w-40\"\n          />\n        </label>\n        <label class=\"flex flex-col\">\n          <span class=\"text-sm font-medium mb-1\">Sampai Tanggal</span>\n          <input\n            type=\"date\"\n            v-model=\"filters.endDate\"\n            class=\"border p-2 rounded w-40\"\n          />\n        </label>\n        <button\n          @click=\"applyFilter\"\n          class=\"h-10 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 font-semibold\"\n          :disabled=\"loading\"\n        >\n          Terapkan Filter\n        </button>\n        <button\n          @click=\"resetFilter\"\n          class=\"h-10 px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 font-semibold\"\n          :disabled=\"loading\"\n        >\n          Reset\n        </button>\n      </div>\n\n      <div v-if=\"loading\" class=\"text-center py-8\">\n        <svg\n          class=\"animate-spin h-6 w-6 text-blue-600 mx-auto\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n          fill=\"none\"\n          viewBox=\"0 0 24 24\"\n        >\n          <circle\n            class=\"opacity-25\"\n            cx=\"12\"\n            cy=\"12\"\n            r=\"10\"\n            stroke=\"currentColor\"\n            stroke-width=\"4\"\n          ></circle>\n          <path\n            class=\"opacity-75\"\n            fill=\"currentColor\"\n            d=\"M4 12a8 8 0 018-8v8H4z\"\n          ></path>\n        </svg>\n        <p class=\"mt-2 text-gray-600\">Memuat data...</p>\n      </div>\n\n      <table v-else class=\"w-full border-collapse border border-gray-300 shadow-md\">\n        <thead>\n          <tr class=\"bg-gray-100\">\n            <th class=\"border border-gray-300 px-4 py-3 text-left w-[150px]\">\n              Tanggal Opname\n            </th>\n            <th class=\"border border-gray-300 px-4 py-3 text-left\">\n              Nama Barang\n            </th>\n            <th class=\"border border-gray-300 px-4 py-3 text-right w-[150px]\">\n              Stok Sistem\n            </th>\n            <th class=\"border border-gray-300 px-4 py-3 text-right w-[150px]\">\n              Stok Fisik\n            </th>\n            <th class=\"border border-gray-300 px-4 py-3 text-right w-[150px]\">\n              Selisih\n            </th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr v-for=\"(item, index) in filteredData\" :key=\"index\">\n            <td class=\"border border-gray-300 px-4 py-2 text-sm\">\n              {{ item.date }}\n            </td>\n            <td class=\"border border-gray-300 px-4 py-2 text-sm\">\n              {{ item.book_name }} ({{ item.product_code }})\n            </td>\n            <td class=\"border border-gray-300 px-4 py-2 text-right text-sm\">\n              {{ item.system_stock }}\n            </td>\n            <td class=\"border border-gray-300 px-4 py-2 text-right text-sm\">\n              {{ item.physical_stock }}\n            </td>\n            <td\n              class=\"border border-gray-300 px-4 py-2 text-right text-sm font-semibold\"\n              :class=\"{\n                'text-red-600': item.difference < 0,\n                'text-green-600': item.difference > 0,\n              }\"\n            >\n              {{ item.difference }}\n            </td>\n          </tr>\n          <tr v-if=\"filteredData.length === 0\">\n            <td colspan=\"5\" class=\"text-center py-6 text-gray-500 text-base\">\n              Tidak ada data Stok Opname dalam periode ini.\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </OwnerLayout>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted } from \"vue\";\nimport axios from \"axios\";\nimport OwnerLayout from \"../components/OwnerLayouts.vue\";\n\nconst filters = ref({\n  startDate: \"\",\n  endDate: \"\",\n});\n\nconst rawData = ref([]); // Data mentah dari API: array of StockOpname objects\nconst flattenedData = ref([]); // Data yang sudah diratakan dan siap tampil (satu baris per item buku)\nconst loading = ref(false);\nconst errorMessage = ref(\"\");\n\n// Ambil token dari localStorage\nconst token = localStorage.getItem(\"token\");\n\n/**\n * Fungsi untuk meratakan data Stock Opname.\n * Mengubah struktur data bersarang menjadi satu array item yang siap ditampilkan.\n */\nconst flattenReportData = (opnames) => {\n  const flattened = [];\n  opnames.forEach((opname) => {\n    const opnameDate = opname.date ? opname.date.substring(0, 10) : \"N/A\";\n    \n    // Asumsi: 'opname.details' adalah array of items, BUKAN 'opname.items'\n    // Jika backend Anda menggunakan 'items', ganti 'opname.details' menjadi 'opname.items'\n    const items = opname.details && opname.details.length > 0 ? opname.details : [];\n\n    items.forEach((item) => {\n      const system = item.system_stock || 0;\n      const physical = item.physical_stock || 0;\n\n      flattened.push({\n        date: opnameDate,\n        book_name: item.product_name || \"N/A\", // Nama Barang\n        product_code: item.product_code || \"-\", // Kode Barang\n        system_stock: system, // Stok Awal/Sistem\n        physical_stock: physical, // Stok Akhir/Fisik\n        difference: physical - system, // Selisih\n        opname_id: opname.id,\n      });\n    });\n  });\n  return flattened;\n};\n\n// Ambil data dari backend\nconst fetchData = async () => {\n  loading.value = true;\n  errorMessage.value = \"\";\n  try {\n    if (!token) {\n      errorMessage.value = \"Token autentikasi tidak ditemukan. Silakan login kembali.\";\n      return;\n    }\n    \n    // ✅ PERBAIKAN ENDPOINT: Asumsi endpoint API yang benar\n    const url = \"http://localhost:8081/api/v1/owner/reports/stock-opname\";\n    \n    const res = await axios.get(url, {\n      headers: { Authorization: `Bearer ${token}` },\n    });\n    \n    rawData.value = res.data.data || [];\n    flattenedData.value = flattenReportData(rawData.value);\n\n  } catch (err) {\n    console.error(\"Gagal ambil data laporan:\", err.response || err);\n    if (err.response) {\n        const status = err.response.status;\n        if (status === 500) {\n            errorMessage.value = `Kesalahan Internal Server (500). Detail: ${err.response.data?.error || 'Periksa log server Go.'}`;\n        } else if (status === 404) {\n            errorMessage.value = \"Endpoint API tidak ditemukan. Pastikan alamat: /api/v1/owner/reports/stock-opname sudah benar.\";\n        } else if (status === 401) {\n            errorMessage.value = \"Sesi Anda telah berakhir. Silakan login kembali.\";\n        } else {\n            errorMessage.value = `Gagal mengambil data laporan. Status: ${status}.`;\n        }\n    } else {\n        errorMessage.value = \"Gagal terhubung ke server. Pastikan backend berjalan di port 8081.\";\n    }\n  } finally {\n    loading.value = false;\n  }\n};\n\nonMounted(fetchData);\n\n// Filter data di frontend berdasarkan tanggal (menggunakan data yang sudah diratakan)\nconst filteredData = computed(() => {\n  const { startDate, endDate } = filters.value;\n\n  if (!startDate || !endDate) {\n    return flattenedData.value;\n  }\n  \n  // Memastikan tanggal valid sebelum memfilter\n  const start = new Date(startDate).getTime();\n  const end = new Date(endDate).getTime();\n\n  if (isNaN(start) || isNaN(end)) {\n      return flattenedData.value; // Abaikan filter jika tanggal tidak valid\n  }\n\n  return flattenedData.value.filter((item) => {\n    // Parsing tanggal item menjadi objek Date\n    const itemDate = new Date(item.date).getTime();\n    \n    // Filter dengan menambahkan 1 hari (86400000 ms) ke endDate agar inklusif\n    return itemDate >= start && itemDate <= end;\n  });\n});\n\nfunction applyFilter() {\n  if (!filters.value.startDate || !filters.value.endDate) {\n      errorMessage.value = \"Harap masukkan kedua tanggal (Dari dan Sampai) untuk memfilter.\";\n      return;\n  }\n  errorMessage.value = \"\";\n  // Computed property akan otomatis memperbarui tampilan\n  console.log(\"Filter applied:\", filters.value);\n}\n\nfunction resetFilter() {\n    filters.value.startDate = \"\";\n    filters.value.endDate = \"\";\n    errorMessage.value = \"\";\n    // Computed property akan kembali menampilkan semua data\n}\n</script>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}