{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, onMounted } from \"vue\";\nimport axios from \"axios\";\nimport GudangSidebar from \"../components/GudangSidebar.vue\"; // Import sidebar baru\nimport { useRouter } from \"vue-router\";\nconst API_BASE = \"http://localhost:8081/api/v1\";\nexport default {\n  __name: 'GoodsReceipt',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const router = useRouter();\n    const token = localStorage.getItem(\"token\");\n    const purchases = ref([]);\n    const loading = ref(false);\n    const totalItems = ref(0);\n    const searchQuery = ref(\"\");\n    const currentStatus = ref(\"APPROVED\"); // Default hanya tampilkan yang APPROVED\n    const loadingStates = ref({}); // Untuk status loading per PO\n\n    const page = ref(1);\n    const size = ref(10); // Asumsi size\n\n    // --- Helper Functions ---\n    const formatDate = dateString => {\n      if (!dateString) return \"-\";\n      return new Date(dateString).toLocaleDateString(\"id-ID\");\n    };\n    const formatCurrency = amount => {\n      // FIX: Konversi amount ke Number secara eksplisit.\n      // Jika amount null, undefined, atau string non-angka, gunakan 0 untuk mencegah RpNaN.\n      const numericAmount = Number(amount) || 0;\n      return new Intl.NumberFormat(\"id-ID\", {\n        style: \"currency\",\n        currency: \"IDR\",\n        minimumFractionDigits: 0\n      }).format(numericAmount);\n    };\n    const getStatusClass = status => {\n      switch (status) {\n        case \"APPROVED\":\n          return \"bg-yellow-200 text-yellow-800 py-1 px-3 rounded-full text-xs font-medium\";\n        case \"RECEIVED\":\n          return \"bg-green-200 text-green-800 py-1 px-3 rounded-full text-xs font-medium\";\n        case \"REJECTED\":\n          return \"bg-red-200 text-red-800 py-1 px-3 rounded-full text-xs font-medium\";\n        default:\n          return \"bg-gray-200 text-gray-800 py-1 px-3 rounded-full text-xs font-medium\";\n      }\n    };\n    const showDetail = id => {\n      // Arahkan ke halaman detail (asumsi rute sudah ada)\n      router.push(`/history/purchases/${id}`);\n    };\n\n    // --- API Calls ---\n    const loadPurchases = async () => {\n      loading.value = true;\n      purchases.value = [];\n      try {\n        const res = await axios.get(`${API_BASE}/history/purchases`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          },\n          params: {\n            page: page.value,\n            size: size.value,\n            q: searchQuery.value,\n            status: currentStatus.value // Filter berdasarkan status\n          }\n        });\n        // Data dari HistoryService.Purchases\n        const data = res.data.data.data || [];\n        totalItems.value = res.data.data.total || 0;\n        purchases.value = data;\n      } catch (err) {\n        console.error(\"Error load purchases:\", err.response?.data || err.message);\n        alert(\"Gagal memuat daftar Purchase Order.\");\n      } finally {\n        loading.value = false;\n      }\n    };\n    const receivePurchase = async id => {\n      if (!confirm(`Anda yakin ingin MENERIMA Purchase Order #${id} ini? Stok akan ditambahkan.`)) {\n        return;\n      }\n      loadingStates.value[id] = true;\n      try {\n        // Panggil ENDPOINT BARU untuk Goods Receipt (Role GUDANG)\n        await axios.post(`${API_BASE}/gudang/purchases/${id}/receive`, {}, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        alert(`Purchase Order #${id} berhasil DITERIMA. Stok telah diperbarui.`);\n\n        // Perbarui data PO di list secara lokal\n        const index = purchases.value.findIndex(p => p.id === id);\n        if (index !== -1) {\n          // Set status menjadi RECEIVED\n          purchases.value[index].status = \"RECEIVED\";\n        }\n\n        // Muat ulang jika status filter adalah APPROVED (agar PO yang sudah diterima hilang)\n        if (currentStatus.value === \"APPROVED\") {\n          loadPurchases();\n        }\n      } catch (err) {\n        console.error(\"Error receiving purchase:\", err.response?.data || err.message);\n        alert(`Gagal menerima Purchase Order #${id}. Error: ${err.response?.data?.error || err.response?.data?.message || \"Terjadi kesalahan.\"}`);\n      } finally {\n        loadingStates.value[id] = false;\n      }\n    };\n    onMounted(() => {\n      loadPurchases();\n    });\n    const __returned__ = {\n      router,\n      API_BASE,\n      token,\n      purchases,\n      loading,\n      totalItems,\n      searchQuery,\n      currentStatus,\n      loadingStates,\n      page,\n      size,\n      formatDate,\n      formatCurrency,\n      getStatusClass,\n      showDetail,\n      loadPurchases,\n      receivePurchase,\n      ref,\n      onMounted,\n      get axios() {\n        return axios;\n      },\n      GudangSidebar,\n      get useRouter() {\n        return useRouter;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","axios","GudangSidebar","useRouter","API_BASE","router","token","localStorage","getItem","purchases","loading","totalItems","searchQuery","currentStatus","loadingStates","page","size","formatDate","dateString","Date","toLocaleDateString","formatCurrency","amount","numericAmount","Number","Intl","NumberFormat","style","currency","minimumFractionDigits","format","getStatusClass","status","showDetail","id","push","loadPurchases","value","res","get","headers","Authorization","params","q","data","total","err","console","error","response","message","alert","receivePurchase","confirm","post","index","findIndex","p"],"sources":["C:/Users/Personal/Documents/PKL/aplikasi/aplikasi/src/views/GoodsReceipt.vue"],"sourcesContent":["<template>\n  <div class=\"flex\">\n    <GudangSidebar />\n\n    <main class=\"flex-1 ml-64 p-6\">\n      <h1 class=\"text-2xl font-bold mb-6\">Penerimaan Barang (Goods Receipt)</h1>\n\n      <div class=\"flex justify-between items-center mb-4\">\n        <div class=\"flex gap-2\">\n          <label class=\"text-sm font-medium pt-2\">Filter:</label>\n          <select\n            v-model=\"currentStatus\"\n            @change=\"loadPurchases\"\n            class=\"border rounded p-2 text-sm\"\n          >\n            <option value=\"APPROVED\">Disetujui (APPROVED)</option>\n            <option value=\"RECEIVED\">Sudah Diterima (RECEIVED)</option>\n            <option value=\"\">Semua</option>\n          </select>\n        </div>\n        <input\n          type=\"text\"\n          v-model=\"searchQuery\"\n          @keyup.enter=\"loadPurchases\"\n          placeholder=\"Cari PO ID atau Total...\"\n          class=\"border rounded p-2 text-sm w-64\"\n        />\n      </div>\n\n      <div class=\"bg-white shadow-md rounded-lg overflow-hidden\">\n        <table class=\"min-w-full leading-normal\">\n          <thead>\n            <tr\n              class=\"bg-gray-100 text-gray-600 uppercase text-sm leading-normal\"\n            >\n              <th class=\"py-3 px-6 text-left\">ID</th>\n              <th class=\"py-3 px-6 text-left\">Tanggal</th>\n              <th class=\"py-3 px-6 text-left\">Supplier</th>\n              <th class=\"py-3 px-6 text-right\">Total</th>\n              <th class=\"py-3 px-6 text-center\">Status</th>\n              <th class=\"py-3 px-6 text-center\">Aksi</th>\n            </tr>\n          </thead>\n          <tbody class=\"text-gray-600 text-sm font-light\">\n            <tr\n              v-for=\"po in purchases\"\n              :key=\"po.ID\"\n              class=\"border-b border-gray-200 hover:bg-gray-50\"\n            >\n              <td class=\"py-3 px-6 text-left whitespace-nowrap\">{{ po.ID }}</td>\n              <td class=\"py-3 px-6 text-left\">\n                {{ formatDate(po.Date) }}\n              </td>\n              <td class=\"py-3 px-6 text-left\">\n                {{ po.Supplier?.name || \"N/A\" }}\n              </td>\n              <td class=\"py-3 px-6 text-right\">\n                {{ formatCurrency(po.Total) }}\n              </td>\n              <td class=\"py-3 px-6 text-center\">\n                <span :class=\"getStatusClass(po.Status)\">\n                  {{ po.Status }}\n                </span>\n              </td>\n              <td class=\"py-3 px-6 text-center\">\n                <button\n                  v-if=\"po.Status === 'APPROVED'\"\n                  @click=\"receivePurchase(po.ID)\"\n                  :disabled=\"loadingStates[po.ID]\"\n                  class=\"bg-green-500 hover:bg-green-600 text-white text-xs font-bold py-1 px-3 rounded disabled:opacity-50\"\n                ></button>\n                <span\n                  v-else-if=\"po.Status === 'RECEIVED'\"\n                  class=\"text-green-500 font-bold text-xs\"\n                >\n                  âœ… Diterima\n                </span>\n                <button\n                  @click=\"showDetail(po.ID)\"\n                  class=\"ml-2 text-blue-500 hover:text-blue-700 text-xs\"\n                >\n                  Detail\n                </button>\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n\n      <div class=\"flex justify-between items-center mt-4\">\n        <p class=\"text-sm text-gray-600\">Total: {{ totalItems }}</p>\n        <div v-if=\"loading\" class=\"text-blue-500\">Memuat...</div>\n      </div>\n    </main>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted } from \"vue\";\nimport axios from \"axios\";\nimport GudangSidebar from \"../components/GudangSidebar.vue\"; // Import sidebar baru\nimport { useRouter } from \"vue-router\";\n\nconst router = useRouter();\nconst API_BASE = \"http://localhost:8081/api/v1\";\nconst token = localStorage.getItem(\"token\");\n\nconst purchases = ref([]);\nconst loading = ref(false);\nconst totalItems = ref(0);\nconst searchQuery = ref(\"\");\nconst currentStatus = ref(\"APPROVED\"); // Default hanya tampilkan yang APPROVED\nconst loadingStates = ref({}); // Untuk status loading per PO\n\nconst page = ref(1);\nconst size = ref(10); // Asumsi size\n\n// --- Helper Functions ---\nconst formatDate = (dateString) => {\n  if (!dateString) return \"-\";\n  return new Date(dateString).toLocaleDateString(\"id-ID\");\n};\n\nconst formatCurrency = (amount) => {\n  // FIX: Konversi amount ke Number secara eksplisit.\n  // Jika amount null, undefined, atau string non-angka, gunakan 0 untuk mencegah RpNaN.\n  const numericAmount = Number(amount) || 0;\n\n  return new Intl.NumberFormat(\"id-ID\", {\n    style: \"currency\",\n    currency: \"IDR\",\n    minimumFractionDigits: 0,\n  }).format(numericAmount);\n};\n\nconst getStatusClass = (status) => {\n  switch (status) {\n    case \"APPROVED\":\n      return \"bg-yellow-200 text-yellow-800 py-1 px-3 rounded-full text-xs font-medium\";\n    case \"RECEIVED\":\n      return \"bg-green-200 text-green-800 py-1 px-3 rounded-full text-xs font-medium\";\n    case \"REJECTED\":\n      return \"bg-red-200 text-red-800 py-1 px-3 rounded-full text-xs font-medium\";\n    default:\n      return \"bg-gray-200 text-gray-800 py-1 px-3 rounded-full text-xs font-medium\";\n  }\n};\n\nconst showDetail = (id) => {\n  // Arahkan ke halaman detail (asumsi rute sudah ada)\n  router.push(`/history/purchases/${id}`);\n};\n\n// --- API Calls ---\nconst loadPurchases = async () => {\n  loading.value = true;\n  purchases.value = [];\n  try {\n    const res = await axios.get(`${API_BASE}/history/purchases`, {\n      headers: { Authorization: `Bearer ${token}` },\n      params: {\n        page: page.value,\n        size: size.value,\n        q: searchQuery.value,\n        status: currentStatus.value, // Filter berdasarkan status\n      },\n    });\n    // Data dari HistoryService.Purchases\n    const data = res.data.data.data || [];\n    totalItems.value = res.data.data.total || 0;\n    purchases.value = data;\n  } catch (err) {\n    console.error(\"Error load purchases:\", err.response?.data || err.message);\n    alert(\"Gagal memuat daftar Purchase Order.\");\n  } finally {\n    loading.value = false;\n  }\n};\n\nconst receivePurchase = async (id) => {\n  if (\n    !confirm(\n      `Anda yakin ingin MENERIMA Purchase Order #${id} ini? Stok akan ditambahkan.`\n    )\n  ) {\n    return;\n  }\n\n  loadingStates.value[id] = true;\n  try {\n    // Panggil ENDPOINT BARU untuk Goods Receipt (Role GUDANG)\n    await axios.post(\n      `${API_BASE}/gudang/purchases/${id}/receive`,\n      {},\n      { headers: { Authorization: `Bearer ${token}` } }\n    );\n\n    alert(`Purchase Order #${id} berhasil DITERIMA. Stok telah diperbarui.`);\n\n    // Perbarui data PO di list secara lokal\n    const index = purchases.value.findIndex((p) => p.id === id);\n    if (index !== -1) {\n      // Set status menjadi RECEIVED\n      purchases.value[index].status = \"RECEIVED\";\n    }\n\n    // Muat ulang jika status filter adalah APPROVED (agar PO yang sudah diterima hilang)\n    if (currentStatus.value === \"APPROVED\") {\n      loadPurchases();\n    }\n  } catch (err) {\n    console.error(\n      \"Error receiving purchase:\",\n      err.response?.data || err.message\n    );\n    alert(\n      `Gagal menerima Purchase Order #${id}. Error: ${\n        err.response?.data?.error ||\n        err.response?.data?.message ||\n        \"Terjadi kesalahan.\"\n      }`\n    );\n  } finally {\n    loadingStates.value[id] = false;\n  }\n};\n\nonMounted(() => {\n  loadPurchases();\n});\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}