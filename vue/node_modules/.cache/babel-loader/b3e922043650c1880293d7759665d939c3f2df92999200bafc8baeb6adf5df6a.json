{"ast":null,"code":"import axios from \"axios\";\nimport KepalaGudangSidebar from \"@/components/KepalaGudangSidebar.vue\";\nexport default {\n  name: \"ProductCatalogKepalaGudang\",\n  components: {\n    KepalaGudangSidebar\n  },\n  data() {\n    return {\n      showForm: false,\n      products: [],\n      categories: [],\n      // newProduct.selectedCategoryIndex will hold the index of chosen kategori in categories[]\n      newProduct: {\n        name: \"\",\n        purchase_price: null,\n        selling_price: null,\n        stock: null,\n        selectedCategoryIndex: \"\"\n      },\n      api: axios.create({\n        baseURL: \"http://localhost:8081/api/v1\",\n        timeout: 10000,\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"token\") || \"\"}`\n        }\n      })\n    };\n  },\n  methods: {\n    async fetchProducts() {\n      try {\n        // gunakan shared GET /products (sesuai routes.go Anda)\n        const res = await this.api.get(\"/products\");\n        // backend bisa mengembalikan array langsung atau object {data: [...]}\n        this.products = Array.isArray(res.data) ? res.data : res.data.data ?? [];\n      } catch (err) {\n        console.error(\"Gagal ambil produk:\", err.response?.data ?? err.message ?? err);\n        this.products = [];\n      }\n    },\n    async fetchCategories() {\n      try {\n        // endpoint kategori (ada di routes.go sebagai /categories)\n        const res = await this.api.get(\"/categories\");\n        this.categories = Array.isArray(res.data) ? res.data : res.data.data ?? [];\n      } catch (err) {\n        console.error(\"Gagal ambil kategori:\", err.response?.data ?? err.message ?? err);\n        this.categories = [];\n      }\n    },\n    buildPayloadForBackend() {\n      // buat payload sesuai kondisi: jika kategori objek ada id -> kirim category_id,\n      // kalau kategori hanya string -> kirim category\n      const payload = {\n        name: this.newProduct.name,\n        purchase_price: Number(this.newProduct.purchase_price),\n        selling_price: Number(this.newProduct.selling_price),\n        stock: Number(this.newProduct.stock)\n      };\n      const idx = this.newProduct.selectedCategoryIndex;\n      if (idx !== \"\" && this.categories[idx] !== undefined) {\n        const cat = this.categories[idx];\n        if (cat && typeof cat === \"object\" && (cat.id !== undefined || cat.name !== undefined)) {\n          // kirim kedua kemungkinan supaya backend menerima: primary kirim category_id kalau ada\n          if (cat.id !== undefined) payload.category_id = cat.id;\n          // juga kirim category name (some backend expect the name)\n          if (cat.name !== undefined) payload.category = cat.name;\n        } else {\n          // categories might be array of strings\n          payload.category = cat;\n        }\n      }\n      return payload;\n    },\n    async addProduct() {\n      try {\n        const payload = this.buildPayloadForBackend();\n\n        // POST ke /owner/products (sesuai route backend Anda)\n        const res = await this.api.post(\"/owner/products\", payload);\n\n        // untuk debugging: lihat respon backend\n        console.log(\"Create product response:\", res.data);\n\n        // reset form, tutup, dan refresh daftar\n        this.newProduct = {\n          name: \"\",\n          purchase_price: null,\n          selling_price: null,\n          stock: null,\n          selectedCategoryIndex: \"\"\n        };\n        this.showForm = false;\n        await this.fetchProducts();\n        // opsional: notifikasi sederhana\n        alert(\"Produk berhasil ditambahkan.\");\n      } catch (err) {\n        console.error(\"Gagal tambah produk:\", err.response?.data ?? err.message ?? err);\n        // tampilkan pesan error dari backend jika ada\n        const message = err.response?.data?.message || err.response?.data || err.message || \"Gagal menyimpan produk\";\n        alert(\"Gagal menyimpan produk: \" + JSON.stringify(message));\n      }\n    },\n    formatPrice(value) {\n      if (value == null || isNaN(value)) return \"0\";\n      return new Intl.NumberFormat(\"id-ID\").format(value);\n    }\n  },\n  mounted() {\n    this.fetchCategories();\n    this.fetchProducts();\n  }\n};","map":{"version":3,"names":["axios","KepalaGudangSidebar","name","components","data","showForm","products","categories","newProduct","purchase_price","selling_price","stock","selectedCategoryIndex","api","create","baseURL","timeout","headers","Authorization","localStorage","getItem","methods","fetchProducts","res","get","Array","isArray","err","console","error","response","message","fetchCategories","buildPayloadForBackend","payload","Number","idx","undefined","cat","id","category_id","category","addProduct","post","log","alert","JSON","stringify","formatPrice","value","isNaN","Intl","NumberFormat","format","mounted"],"sources":["C:\\Users\\Personal\\Documents\\PKL\\aplikasi\\aplikasi\\src\\views\\ProductCatalogKepalaGudang.vue"],"sourcesContent":["<template>\n  <div class=\"flex h-screen bg-gray-100\">\n    <!-- Sidebar (tidak diubah) -->\n    <KepalaGudangSidebar />\n\n    <!-- Main Content -->\n    <div class=\"flex-1 flex flex-col\">\n      <!-- Header -->\n      <header class=\"bg-white shadow p-4 flex justify-between items-center\">\n        <h1 class=\"text-2xl font-bold\">Product Catalog - Kepala Gudang</h1>\n      </header>\n\n      <!-- Content -->\n      <main class=\"p-6 flex-1 overflow-y-auto\">\n        <!-- Tombol Tambah Produk -->\n        <div class=\"flex justify-end mb-4\">\n          <button\n            @click=\"showForm = !showForm\"\n            class=\"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700\"\n          >\n            {{ showForm ? \"Tutup Form\" : \"Tambah Produk\" }}\n          </button>\n        </div>\n\n        <!-- Form Tambah Produk (Inline) -->\n        <section\n          v-if=\"showForm\"\n          class=\"mb-8 border rounded p-4 bg-white shadow\"\n        >\n          <h2 class=\"text-xl font-semibold mb-4\">Tambah Produk</h2>\n\n          <form\n            @submit.prevent=\"addProduct\"\n            class=\"grid grid-cols-1 md:grid-cols-2 gap-4\"\n          >\n            <div>\n              <label class=\"block text-sm font-medium mb-1\">Nama Produk</label>\n              <input\n                v-model=\"newProduct.name\"\n                type=\"text\"\n                class=\"w-full border rounded p-2 bg-gray-800 text-white\"\n                required\n              />\n            </div>\n\n            <div>\n              <label class=\"block text-sm font-medium mb-1\">Harga Beli</label>\n              <input\n                v-model.number=\"newProduct.purchase_price\"\n                type=\"number\"\n                min=\"0\"\n                class=\"w-full border rounded p-2 bg-gray-800 text-white\"\n                required\n              />\n            </div>\n\n            <div>\n              <label class=\"block text-sm font-medium mb-1\">Harga Jual</label>\n              <input\n                v-model.number=\"newProduct.selling_price\"\n                type=\"number\"\n                min=\"0\"\n                class=\"w-full border rounded p-2 bg-gray-800 text-white\"\n                required\n              />\n            </div>\n\n            <div>\n              <label class=\"block text-sm font-medium mb-1\">Kategori</label>\n              <select\n                v-model=\"newProduct.selectedCategoryIndex\"\n                class=\"w-full border rounded p-2 bg-gray-800 text-white\"\n                required\n              >\n                <option value=\"\" disabled>Pilih Kategori</option>\n                <option\n                  v-for=\"(cat, idx) in categories\"\n                  :key=\"cat.id ?? cat.name\"\n                  :value=\"idx\"\n                >\n                  {{ cat.name ?? cat }}\n                </option>\n              </select>\n            </div>\n\n            <div>\n              <label class=\"block text-sm font-medium mb-1\">Stok</label>\n              <input\n                v-model.number=\"newProduct.stock\"\n                type=\"number\"\n                min=\"0\"\n                class=\"w-full border rounded p-2 bg-gray-800 text-white\"\n                required\n              />\n            </div>\n\n            <div class=\"md:col-span-2\">\n              <button\n                type=\"submit\"\n                class=\"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700\"\n              >\n                Simpan Produk\n              </button>\n            </div>\n          </form>\n        </section>\n\n        <!-- Daftar Produk -->\n        <section>\n          <h2 class=\"text-xl font-semibold mb-4\">Daftar Produk</h2>\n\n          <div class=\"overflow-x-auto bg-white p-4 rounded shadow\">\n            <table class=\"w-full border-collapse text-sm\">\n              <thead class=\"bg-gray-100\">\n                <tr>\n                  <th class=\"border p-2 text-left\">Nama</th>\n                  <th class=\"border p-2 text-left\">Kategori</th>\n                  <th class=\"border p-2 text-right\">Harga Beli</th>\n                  <th class=\"border p-2 text-right\">Harga Jual</th>\n                  <th class=\"border p-2 text-right\">Stok</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr v-for=\"prod in products\" :key=\"prod.id\">\n                  <td class=\"border p-2\">{{ prod.name }}</td>\n                  <td class=\"border p-2\">\n                    {{ prod.category?.name ?? prod.category ?? \"-\" }}\n                  </td>\n\n                  <!-- tampilkan '-' kalau null/undefined, jangan pakai $ directly di {{ }} -->\n                  <td class=\"border p-2 text-right\">\n                    {{\n                      prod.purchase_price != null\n                        ? \"Rp \" + formatPrice(prod.purchase_price)\n                        : \"-\"\n                    }}\n                  </td>\n                  <td class=\"border p-2 text-right\">\n                    {{\n                      prod.selling_price != null\n                        ? \"Rp \" + formatPrice(prod.selling_price)\n                        : \"-\"\n                    }}\n                  </td>\n                  <td class=\"border p-2 text-right\">{{ prod.stock ?? \"-\" }}</td>\n                </tr>\n\n                <tr v-if=\"products.length === 0\">\n                  <td class=\"text-center p-4\" colspan=\"5\">\n                    No products available\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </section>\n      </main>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from \"axios\";\nimport KepalaGudangSidebar from \"@/components/KepalaGudangSidebar.vue\";\n\nexport default {\n  name: \"ProductCatalogKepalaGudang\",\n  components: { KepalaGudangSidebar },\n  data() {\n    return {\n      showForm: false,\n      products: [],\n      categories: [],\n      // newProduct.selectedCategoryIndex will hold the index of chosen kategori in categories[]\n      newProduct: {\n        name: \"\",\n        purchase_price: null,\n        selling_price: null,\n        stock: null,\n        selectedCategoryIndex: \"\",\n      },\n      api: axios.create({\n        baseURL: \"http://localhost:8081/api/v1\",\n        timeout: 10000,\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"token\") || \"\"}`,\n        },\n      }),\n    };\n  },\n  methods: {\n    async fetchProducts() {\n      try {\n        // gunakan shared GET /products (sesuai routes.go Anda)\n        const res = await this.api.get(\"/products\");\n        // backend bisa mengembalikan array langsung atau object {data: [...]}\n        this.products = Array.isArray(res.data)\n          ? res.data\n          : res.data.data ?? [];\n      } catch (err) {\n        console.error(\n          \"Gagal ambil produk:\",\n          err.response?.data ?? err.message ?? err\n        );\n        this.products = [];\n      }\n    },\n    async fetchCategories() {\n      try {\n        // endpoint kategori (ada di routes.go sebagai /categories)\n        const res = await this.api.get(\"/categories\");\n        this.categories = Array.isArray(res.data)\n          ? res.data\n          : res.data.data ?? [];\n      } catch (err) {\n        console.error(\n          \"Gagal ambil kategori:\",\n          err.response?.data ?? err.message ?? err\n        );\n        this.categories = [];\n      }\n    },\n    buildPayloadForBackend() {\n      // buat payload sesuai kondisi: jika kategori objek ada id -> kirim category_id,\n      // kalau kategori hanya string -> kirim category\n      const payload = {\n        name: this.newProduct.name,\n        purchase_price: Number(this.newProduct.purchase_price),\n        selling_price: Number(this.newProduct.selling_price),\n        stock: Number(this.newProduct.stock),\n      };\n\n      const idx = this.newProduct.selectedCategoryIndex;\n      if (idx !== \"\" && this.categories[idx] !== undefined) {\n        const cat = this.categories[idx];\n        if (\n          cat &&\n          typeof cat === \"object\" &&\n          (cat.id !== undefined || cat.name !== undefined)\n        ) {\n          // kirim kedua kemungkinan supaya backend menerima: primary kirim category_id kalau ada\n          if (cat.id !== undefined) payload.category_id = cat.id;\n          // juga kirim category name (some backend expect the name)\n          if (cat.name !== undefined) payload.category = cat.name;\n        } else {\n          // categories might be array of strings\n          payload.category = cat;\n        }\n      }\n\n      return payload;\n    },\n    async addProduct() {\n      try {\n        const payload = this.buildPayloadForBackend();\n\n        // POST ke /owner/products (sesuai route backend Anda)\n        const res = await this.api.post(\"/owner/products\", payload);\n\n        // untuk debugging: lihat respon backend\n        console.log(\"Create product response:\", res.data);\n\n        // reset form, tutup, dan refresh daftar\n        this.newProduct = {\n          name: \"\",\n          purchase_price: null,\n          selling_price: null,\n          stock: null,\n          selectedCategoryIndex: \"\",\n        };\n        this.showForm = false;\n        await this.fetchProducts();\n        // opsional: notifikasi sederhana\n        alert(\"Produk berhasil ditambahkan.\");\n      } catch (err) {\n        console.error(\n          \"Gagal tambah produk:\",\n          err.response?.data ?? err.message ?? err\n        );\n        // tampilkan pesan error dari backend jika ada\n        const message =\n          err.response?.data?.message ||\n          err.response?.data ||\n          err.message ||\n          \"Gagal menyimpan produk\";\n        alert(\"Gagal menyimpan produk: \" + JSON.stringify(message));\n      }\n    },\n    formatPrice(value) {\n      if (value == null || isNaN(value)) return \"0\";\n      return new Intl.NumberFormat(\"id-ID\").format(value);\n    },\n  },\n  mounted() {\n    this.fetchCategories();\n    this.fetchProducts();\n  },\n};\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}