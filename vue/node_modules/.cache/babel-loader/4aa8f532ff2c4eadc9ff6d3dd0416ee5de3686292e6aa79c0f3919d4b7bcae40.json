{"ast":null,"code":"import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, withCtx as _withCtx, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"p-4\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"text-center text-[#60758a]\"\n};\nconst _hoisted_3 = {\n  key: 1\n};\nconst _hoisted_4 = {\n  key: 0,\n  class: \"text-red-600 mb-4\"\n};\nconst _hoisted_5 = {\n  key: 1,\n  class: \"debug-meta mb-2\"\n};\nconst _hoisted_6 = {\n  key: 0,\n  class: \"mt-1\"\n};\nconst _hoisted_7 = {\n  class: \"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8\"\n};\nconst _hoisted_8 = {\n  class: \"flex flex-col gap-2 rounded-lg p-6 border border-[#dbe0e6]\"\n};\nconst _hoisted_9 = {\n  class: \"text-[#111418] text-2xl font-bold leading-tight\"\n};\nconst _hoisted_10 = {\n  class: \"flex flex-col gap-2 rounded-lg p-6 border border-[#dbe0e6]\"\n};\nconst _hoisted_11 = {\n  class: \"text-[#111418] text-2xl font-bold leading-tight\"\n};\nconst _hoisted_12 = {\n  class: \"flex flex-col gap-2 rounded-lg p-6 border border-[#dbe0e6]\"\n};\nconst _hoisted_13 = {\n  class: \"text-[#111418] text-2xl font-bold leading-tight\"\n};\nconst _hoisted_14 = {\n  class: \"flex flex-col gap-2 rounded-lg p-6 border border-[#dbe0e6]\"\n};\nconst _hoisted_15 = {\n  class: \"text-[#111418] text-2xl font-bold leading-tight\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createBlock($setup[\"KepalaGudangLayouts\"], null, {\n    default: _withCtx(() => [_cache[8] || (_cache[8] = _createElementVNode(\"div\", {\n      class: \"flex flex-wrap justify-between gap-3 p-4\"\n    }, [_createElementVNode(\"p\", {\n      class: \"text-[#111418] tracking-light text-[32px] font-bold leading-tight min-w-72\"\n    }, \" Warehouse Manager Dashboard \")], -1 /* CACHED */)), _createElementVNode(\"div\", _hoisted_1, [_cache[7] || (_cache[7] = _createElementVNode(\"div\", {\n      class: \"mb-6\"\n    }, [_createElementVNode(\"p\", {\n      class: \"text-[#60758a] text-sm font-normal leading-normal mt-1\"\n    }, \" Welcome back — ringkasan aktivitas gudang terbaru. \")], -1 /* CACHED */)), $setup.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, \" Memuat data... \")) : (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [$setup.errorMessage ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, _toDisplayString($setup.errorMessage), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true), _createCommentVNode(\" Debug: show which endpoint returned purchase-returns and a short sample \"), $setup.prEndpointUsed ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [_cache[1] || (_cache[1] = _createTextVNode(\" Data source for Returns: \", -1 /* CACHED */)), _createElementVNode(\"strong\", null, _toDisplayString($setup.prEndpointUsed), 1 /* TEXT */), $setup.prSample ? (_openBlock(), _createElementBlock(\"div\", _hoisted_6, [_cache[0] || (_cache[0] = _createTextVNode(\"Sample: \", -1 /* CACHED */)), _createElementVNode(\"code\", null, _toDisplayString($setup.prSample) + _toDisplayString($setup.prSample.length >= 1000 ? '...' : ''), 1 /* TEXT */)])) : _createCommentVNode(\"v-if\", true)])) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"div\", _hoisted_7, [_createElementVNode(\"div\", _hoisted_8, [_cache[2] || (_cache[2] = _createElementVNode(\"p\", {\n      class: \"text-[#111418] text-base font-medium leading-normal\"\n    }, \" Purchase Orders Pending \", -1 /* CACHED */)), _createElementVNode(\"p\", _hoisted_9, _toDisplayString($setup.dashboard.purchase_orders_pending || 0), 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_10, [_cache[3] || (_cache[3] = _createElementVNode(\"p\", {\n      class: \"text-[#111418] text-base font-medium leading-normal\"\n    }, \" Purchase Returns Pending \", -1 /* CACHED */)), _createElementVNode(\"p\", _hoisted_11, _toDisplayString($setup.dashboard.purchase_returns_pending || 0), 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_12, [_cache[4] || (_cache[4] = _createElementVNode(\"p\", {\n      class: \"text-[#111418] text-base font-medium leading-normal\"\n    }, \" Products Low Stock (≤5) \", -1 /* CACHED */)), _createElementVNode(\"p\", _hoisted_13, _toDisplayString($setup.dashboard.products_low_stock || 0), 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_14, [_cache[5] || (_cache[5] = _createElementVNode(\"p\", {\n      class: \"text-[#111418] text-base font-medium leading-normal\"\n    }, \" Products In Stock \", -1 /* CACHED */)), _createElementVNode(\"p\", _hoisted_15, _toDisplayString($setup.dashboard.products_in_stock || 0), 1 /* TEXT */)])]), _cache[6] || (_cache[6] = _createElementVNode(\"div\", {\n      class: \"flex flex-col gap-2 rounded-lg p-6 bg-[#f0f2f5] min-h-[120px]\"\n    }, [_createElementVNode(\"p\", {\n      class: \"text-[#111418] tracking-light text-lg font-semibold leading-tight\"\n    }, \" Selamat datang, Kepala Gudang! \"), _createElementVNode(\"p\", {\n      class: \"text-[#60758a] text-sm\"\n    }, \" Gunakan menu kiri untuk melihat permintaan dan katalog produk. \")], -1 /* CACHED */))]))])]),\n    _: 1 /* STABLE */\n  });\n}","map":{"version":3,"names":["class","_createBlock","$setup","_createElementVNode","_hoisted_1","loading","_createElementBlock","_hoisted_2","_hoisted_3","errorMessage","_hoisted_4","_toDisplayString","_createCommentVNode","prEndpointUsed","_hoisted_5","prSample","_hoisted_6","length","_hoisted_7","_hoisted_8","_hoisted_9","dashboard","purchase_orders_pending","_hoisted_10","_hoisted_11","purchase_returns_pending","_hoisted_12","_hoisted_13","products_low_stock","_hoisted_14","_hoisted_15","products_in_stock"],"sources":["C:\\Users\\Personal\\Documents\\PKL\\PKL Shop Managements\\vue\\src\\views\\DashboardKepalagudang.vue"],"sourcesContent":["<template>\n  <KepalaGudangLayouts>\n    <div class=\"flex flex-wrap justify-between gap-3 p-4\">\n      <p\n        class=\"text-[#111418] tracking-light text-[32px] font-bold leading-tight min-w-72\"\n      >\n        Warehouse Manager Dashboard\n      </p>\n    </div>\n\n    <div class=\"p-4\">\n      <div class=\"mb-6\">\n        <p class=\"text-[#60758a] text-sm font-normal leading-normal mt-1\">\n          Welcome back — ringkasan aktivitas gudang terbaru.\n        </p>\n      </div>\n\n      <div v-if=\"loading\" class=\"text-center text-[#60758a]\">\n        Memuat data...\n      </div>\n\n      <div v-else>\n        <div v-if=\"errorMessage\" class=\"text-red-600 mb-4\">\n          {{ errorMessage }}\n        </div>\n\n        <!-- Debug: show which endpoint returned purchase-returns and a short sample -->\n        <div v-if=\"prEndpointUsed\" class=\"debug-meta mb-2\">\n          Data source for Returns: <strong>{{ prEndpointUsed }}</strong>\n          <div v-if=\"prSample\" class=\"mt-1\">Sample: <code>{{ prSample }}{{ prSample.length >= 1000 ? '...' : '' }}</code></div>\n        </div>\n\n        <div class=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8\">\n          <div\n            class=\"flex flex-col gap-2 rounded-lg p-6 border border-[#dbe0e6]\"\n          >\n            <p class=\"text-[#111418] text-base font-medium leading-normal\">\n              Purchase Orders Pending\n            </p>\n            <p class=\"text-[#111418] text-2xl font-bold leading-tight\">\n              {{ dashboard.purchase_orders_pending || 0 }}\n            </p>\n          </div>\n\n          <div\n            class=\"flex flex-col gap-2 rounded-lg p-6 border border-[#dbe0e6]\"\n          >\n            <p class=\"text-[#111418] text-base font-medium leading-normal\">\n              Purchase Returns Pending\n            </p>\n            <p class=\"text-[#111418] text-2xl font-bold leading-tight\">\n              {{ dashboard.purchase_returns_pending || 0 }}\n            </p>\n          </div>\n\n          <div\n            class=\"flex flex-col gap-2 rounded-lg p-6 border border-[#dbe0e6]\"\n          >\n            <p class=\"text-[#111418] text-base font-medium leading-normal\">\n              Products Low Stock (&le;5)\n            </p>\n            <p class=\"text-[#111418] text-2xl font-bold leading-tight\">\n              {{ dashboard.products_low_stock || 0 }}\n            </p>\n          </div>\n\n          <div\n            class=\"flex flex-col gap-2 rounded-lg p-6 border border-[#dbe0e6]\"\n          >\n            <p class=\"text-[#111418] text-base font-medium leading-normal\">\n              Products In Stock\n            </p>\n            <p class=\"text-[#111418] text-2xl font-bold leading-tight\">\n              {{ dashboard.products_in_stock || 0 }}\n            </p>\n          </div>\n        </div>\n\n        <div\n          class=\"flex flex-col gap-2 rounded-lg p-6 bg-[#f0f2f5] min-h-[120px]\"\n        >\n          <p\n            class=\"text-[#111418] tracking-light text-lg font-semibold leading-tight\"\n          >\n            Selamat datang, Kepala Gudang!\n          </p>\n          <p class=\"text-[#60758a] text-sm\">\n            Gunakan menu kiri untuk melihat permintaan dan katalog produk.\n          </p>\n        </div>\n      </div>\n    </div>\n  </KepalaGudangLayouts>\n</template>\n\n<script setup>\nimport { ref, onMounted } from \"vue\";\nimport KepalaGudangLayouts from \"@/components/KepalaGudangLayouts.vue\";\nimport api from \"../services/api.js\";\n\n// State untuk dashboard\nconst loading = ref(true);\nconst errorMessage = ref(\"\");\nconst dashboard = ref({\n  purchase_orders_pending: 0,\n  purchase_returns_pending: 0,\n  products_low_stock: 0,\n  products_in_stock: 0,\n});\n// Debug info to trace where numbers come from\nconst prEndpointUsed = ref(\"\");\nconst prSample = ref(\"\");\n\n// Helper untuk mengambil total dari berbagai struktur respons\nfunction getTotalFromResponse(resp) {\n  if (!resp) return 0;\n  const d = resp.data ?? resp;\n  return (\n    d.total ?? d?.data?.total ?? d?.meta?.total ?? d?.data?.meta?.total ?? 0\n  );\n}\n\n// Ambil array produk dari respons\nfunction getProductsArray(resp) {\n  if (!resp) return [];\n  const d = resp.data ?? resp;\n  return d?.data ?? d?.items ?? d?.products ?? [];\n}\n\n// Fungsi untuk mengambil data dashboard\nconst fetchDashboard = async () => {\n  loading.value = true;\n  errorMessage.value = \"\";\n  try {\n    // 1) Purchase orders pending approval (SUBMITTED)\n    const poResp = await api.get(\"/pembelian/purchases\", {\n      params: { status: \"SUBMITTED\", size: 1 },\n    });\n    dashboard.value.purchase_orders_pending = getTotalFromResponse(poResp);\n\n    // 2) Purchase returns pending - try several possible endpoints used in the app\n    let prResp = null;\n    const prEndpoints = [\n      \"/pembelian/purchase-returns\",\n      \"/gudang/purchase-returns\",\n      \"/history/purchase-returns\",\n      \"/purchase-returns\",\n    ];\n    let lastPrError = null;\n    for (const ep of prEndpoints) {\n      try {\n        prResp = await api.get(ep, { params: { status: \"PENDING\", size: 1 } });\n        // if succeeded, break\n        prEndpointUsed.value = ep;\n        // store a small sample of response for debugging\n        try {\n          prSample.value = JSON.stringify(prResp.data).slice(0, 1000);\n        } catch (e) {\n          prSample.value = String(prResp.data);\n        }\n        break;\n      } catch (e) {\n        // record last error and continue to try other endpoints\n        lastPrError = e;\n        // continue for any error (404, 403, etc.) so other paths can be tried\n        continue;\n      }\n    }\n\n    if (prResp) {\n      dashboard.value.purchase_returns_pending = getTotalFromResponse(prResp);\n      // If API returned a list instead of total, try to infer count\n      try {\n        const arr = prResp.data?.data ?? prResp.data?.items ?? null;\n        if (Array.isArray(arr) && arr.length > 0) {\n          // if total is zero but array has items, set to array length\n          if (\n            !dashboard.value.purchase_returns_pending ||\n            dashboard.value.purchase_returns_pending === 0\n          ) {\n            dashboard.value.purchase_returns_pending = arr.length;\n          }\n        }\n      } catch (e) {\n        // ignore\n      }\n    } else {\n      // if none found, set 0 and append warning to errorMessage with details from lastPrError\n      dashboard.value.purchase_returns_pending = 0;\n      if (lastPrError && lastPrError.response) {\n        const st = lastPrError.response.status;\n        let b = \"\";\n        try {\n          b =\n            typeof lastPrError.response.data === \"string\"\n              ? lastPrError.response.data\n              : JSON.stringify(lastPrError.response.data);\n        } catch (e) {\n          b = String(lastPrError.response.data);\n        }\n        errorMessage.value =\n          (errorMessage.value ? errorMessage.value + \" | \" : \"\") +\n          `purchase-returns requests failed (last status ${st}): ${b}`;\n      } else if (lastPrError) {\n        errorMessage.value =\n          (errorMessage.value ? errorMessage.value + \" | \" : \"\") +\n          `purchase-returns requests failed: ${\n            lastPrError.message || String(lastPrError)\n          }`;\n      } else {\n        errorMessage.value =\n          (errorMessage.value ? errorMessage.value + \" | \" : \"\") +\n          \"purchase-returns endpoint not found (tried common paths).\";\n      }\n    }\n\n    // 3) Products list to compute low stock and in-stock counts\n    // try owner/products or /products depending on backend\n    let productsResp;\n    try {\n      productsResp = await api.get(\"/products\", { params: { size: 500 } });\n    } catch (e) {\n      // fallback to owner/products\n      productsResp = await api.get(\"/owner/products\", {\n        params: { size: 500 },\n      });\n    }\n\n    const products = getProductsArray(productsResp) || [];\n\n    // Threshold low stock (tweakable)\n    const LOW_STOCK_THRESHOLD = 5;\n\n    let lowCount = 0;\n    let inStockCount = 0;\n    products.forEach((p) => {\n      const prod = p.Product ?? p.product ?? p; // support wrapped objects\n      const stock = Number(\n        prod.stock ?? prod.Stock ?? prod.qty ?? prod.quantity ?? 0\n      );\n      if (!Number.isNaN(stock)) {\n        if (stock <= LOW_STOCK_THRESHOLD) lowCount += 1;\n        if (stock > 0) inStockCount += 1;\n      }\n    });\n\n    dashboard.value.products_low_stock = lowCount;\n    dashboard.value.products_in_stock = inStockCount;\n  } catch (error) {\n    console.error(\"Gagal fetch dashboard Kepala Gudang:\", error);\n    // Build a detailed error message for UI debugging\n    if (error && error.response) {\n      const status = error.response.status;\n      const body = error.response.data;\n      let bodyText = \"\";\n      try {\n        bodyText = typeof body === \"string\" ? body : JSON.stringify(body);\n      } catch (e) {\n        bodyText = String(body);\n      }\n      errorMessage.value = `Request failed with status code ${status}: ${bodyText}`;\n    } else {\n      errorMessage.value = error?.message || String(error);\n    }\n  } finally {\n    loading.value = false;\n  }\n};\n\nonMounted(() => {\n  fetchDashboard();\n});\n</script>\n\n<style scoped>\n.debug-meta {\n  font-size: 12px;\n  color: #6b7280;\n}\n</style>\n"],"mappings":";;EAUSA,KAAK,EAAC;AAAK;;;EAOMA,KAAK,EAAC;;;;;;;EAKCA,KAAK,EAAC;;;;EAKJA,KAAK,EAAC;;;;EAEVA,KAAK,EAAC;;;EAGxBA,KAAK,EAAC;AAA4C;;EAEnDA,KAAK,EAAC;AAA4D;;EAK/DA,KAAK,EAAC;AAAiD;;EAM1DA,KAAK,EAAC;AAA4D;;EAK/DA,KAAK,EAAC;AAAiD;;EAM1DA,KAAK,EAAC;AAA4D;;EAK/DA,KAAK,EAAC;AAAiD;;EAM1DA,KAAK,EAAC;AAA4D;;EAK/DA,KAAK,EAAC;AAAiD;;uBAvEpEC,YAAA,CA2FsBC,MAAA;sBA1FpB,MAMM,C,0BANNC,mBAAA,CAMM;MANDH,KAAK,EAAC;IAA0C,IACnDG,mBAAA,CAII;MAHFH,KAAK,EAAC;IAA4E,GACnF,+BAED,E,qBAGFG,mBAAA,CAiFM,OAjFNC,UAiFM,G,0BAhFJD,mBAAA,CAIM;MAJDH,KAAK,EAAC;IAAM,IACfG,mBAAA,CAEI;MAFDH,KAAK,EAAC;IAAwD,GAAC,sDAElE,E,qBAGSE,MAAA,CAAAG,OAAO,I,cAAlBC,mBAAA,CAEM,OAFNC,UAEM,EAFiD,kBAEvD,M,cAEAD,mBAAA,CAqEM,OAAAE,UAAA,GApEON,MAAA,CAAAO,YAAY,I,cAAvBH,mBAAA,CAEM,OAFNI,UAEM,EAAAC,gBAAA,CADDT,MAAA,CAAAO,YAAY,oB,mCAGjBG,mBAAA,6EAAgF,EACrEV,MAAA,CAAAW,cAAc,I,cAAzBP,mBAAA,CAGM,OAHNQ,UAGM,G,2CAH6C,4BACxB,qBAAAX,mBAAA,CAAqC,gBAAAQ,gBAAA,CAA1BT,MAAA,CAAAW,cAAc,kBACvCX,MAAA,CAAAa,QAAQ,I,cAAnBT,mBAAA,CAAqH,OAArHU,UAAqH,G,2CAAnF,UAAQ,qBAAAb,mBAAA,CAAqE,cAAAQ,gBAAA,CAA5DT,MAAA,CAAAa,QAAQ,IAAAJ,gBAAA,CAAMT,MAAA,CAAAa,QAAQ,CAACE,MAAM,sC,+EAGlFd,mBAAA,CA4CM,OA5CNe,UA4CM,GA3CJf,mBAAA,CASM,OATNgB,UASM,G,0BANJhB,mBAAA,CAEI;MAFDH,KAAK,EAAC;IAAqD,GAAC,2BAE/D,qBACAG,mBAAA,CAEI,KAFJiB,UAEI,EAAAT,gBAAA,CADCT,MAAA,CAAAmB,SAAS,CAACC,uBAAuB,sB,GAIxCnB,mBAAA,CASM,OATNoB,WASM,G,0BANJpB,mBAAA,CAEI;MAFDH,KAAK,EAAC;IAAqD,GAAC,4BAE/D,qBACAG,mBAAA,CAEI,KAFJqB,WAEI,EAAAb,gBAAA,CADCT,MAAA,CAAAmB,SAAS,CAACI,wBAAwB,sB,GAIzCtB,mBAAA,CASM,OATNuB,WASM,G,0BANJvB,mBAAA,CAEI;MAFDH,KAAK,EAAC;IAAqD,GAAC,2BAE/D,qBACAG,mBAAA,CAEI,KAFJwB,WAEI,EAAAhB,gBAAA,CADCT,MAAA,CAAAmB,SAAS,CAACO,kBAAkB,sB,GAInCzB,mBAAA,CASM,OATN0B,WASM,G,0BANJ1B,mBAAA,CAEI;MAFDH,KAAK,EAAC;IAAqD,GAAC,qBAE/D,qBACAG,mBAAA,CAEI,KAFJ2B,WAEI,EAAAnB,gBAAA,CADCT,MAAA,CAAAmB,SAAS,CAACU,iBAAiB,sB,+BAKpC5B,mBAAA,CAWM;MAVJH,KAAK,EAAC;IAA+D,IAErEG,mBAAA,CAII;MAHFH,KAAK,EAAC;IAAmE,GAC1E,kCAED,GACAG,mBAAA,CAEI;MAFDH,KAAK,EAAC;IAAwB,GAAC,kEAElC,E","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}