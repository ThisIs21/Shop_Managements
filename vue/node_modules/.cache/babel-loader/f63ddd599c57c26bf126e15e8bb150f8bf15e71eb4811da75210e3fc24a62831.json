{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.every.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { ref, onMounted, computed } from \"vue\";\nimport axios from \"axios\";\nimport GudangSidebar from \"../components/GudangSidebar.vue\";\nconst API_BASE = \"http://localhost:8081/api/v1\";\nexport default {\n  __name: 'GoodsReceipt',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const token = localStorage.getItem(\"token\");\n    const purchases = ref([]);\n    const loading = ref(false);\n    const totalItems = ref(0);\n    const searchQuery = ref(\"\");\n    const currentStatus = ref(\"APPROVED\");\n    const selectedPurchase = ref(null);\n    const isModalOpen = ref(false);\n    const isQcModalOpen = ref(false);\n    const submitting = ref(false);\n    const qcError = ref(\"\");\n    const qcForm = ref({\n      purchase_id: null,\n      supplierName: \"\",\n      purchaseDate: \"\",\n      items: []\n    });\n    const isQcFormValid = computed(() => {\n      return qcForm.value.items.length > 0 && qcForm.value.items.every(item => item.qty_good !== null && item.qty_good >= 0 && item.qty_damaged !== null && item.qty_damaged >= 0 && item.total_received <= item.qty_ordered);\n    });\n    const page = ref(1);\n    const size = ref(10);\n    const formatDate = dateString => {\n      if (!dateString) return \"-\";\n      const date = new Date(dateString);\n      const day = String(date.getDate()).padStart(2, \"0\");\n      const month = String(date.getMonth() + 1).padStart(2, \"0\");\n      const year = date.getFullYear();\n      return `${day}/${month}/${year}`;\n    };\n    const formatCurrency = amount => {\n      const numericAmount = Number(amount) || 0;\n      return new Intl.NumberFormat(\"id-ID\", {\n        style: \"currency\",\n        currency: \"IDR\",\n        minimumFractionDigits: 0\n      }).format(numericAmount);\n    };\n    const getStatusClass = status => {\n      switch (status) {\n        case \"APPROVED\":\n          return \"bg-yellow-400 text-gray-900 py-1 px-3 rounded-full text-xs font-medium\";\n        case \"RECEIVED\":\n          return \"bg-green-400 text-gray-900 py-1 px-3 rounded-full text-xs font-medium\";\n        case \"REJECTED\":\n          return \"bg-red-400 text-white py-1 px-3 rounded-full text-xs font-medium\";\n        default:\n          return \"bg-gray-400 text-gray-900 py-1 px-3 rounded-full text-xs font-medium\";\n      }\n    };\n    const closeModal = () => {\n      isModalOpen.value = false;\n      selectedPurchase.value = null;\n    };\n    const closeQcModal = () => {\n      isQcModalOpen.value = false;\n      qcError.value = \"\";\n      qcForm.value = {\n        purchase_id: null,\n        supplierName: \"\",\n        purchaseDate: \"\",\n        items: []\n      };\n    };\n    const showDetail = async id => {\n      try {\n        const res = await axios.get(`${API_BASE}/history/purchases/${id}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        selectedPurchase.value = res.data.data;\n        isModalOpen.value = true;\n      } catch (err) {\n        console.error(\"Error loading purchase detail:\", err.response?.data || err.message);\n        alert(`Gagal memuat detail Purchase Order #${id}.`);\n      }\n    };\n    const loadPurchases = async () => {\n      loading.value = true;\n      purchases.value = [];\n      try {\n        const res = await axios.get(`${API_BASE}/history/purchases`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          },\n          params: {\n            page: page.value,\n            size: size.value,\n            q: searchQuery.value,\n            status: currentStatus.value\n          }\n        });\n        const data = res.data.data?.data || res.data.data || [];\n        totalItems.value = res.data.data?.total || 0;\n        purchases.value = data;\n      } catch (err) {\n        console.error(\"Error load purchases:\", err.response?.data || err.message);\n        alert(\"Gagal memuat daftar Purchase Order.\");\n      } finally {\n        loading.value = false;\n      }\n    };\n    const openQcModal = async id => {\n      try {\n        const res = await axios.get(`${API_BASE}/history/purchases/${id}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        const po = res.data.data;\n        if (!po || po.Status !== \"APPROVED\") {\n          alert(\"PO ini tidak bisa diproses karena statusnya bukan APPROVED.\");\n          return;\n        }\n        qcForm.value.purchase_id = po.ID;\n        qcForm.value.supplierName = po.Supplier?.name || \"N/A\";\n        qcForm.value.purchaseDate = po.Date;\n        qcForm.value.items = po.Items.map(item => {\n          const itemProxy = {\n            purchase_item_id: item.ID,\n            product_id: item.Product_ID,\n            product_name: item.Product?.name || \"Produk Hilang\",\n            qty_ordered: item.Qty,\n            qty_good: item.Qty,\n            qty_damaged: 0,\n            note: \"\"\n          };\n          Object.defineProperty(itemProxy, \"total_received\", {\n            enumerable: true,\n            get: () => itemProxy.qty_good + itemProxy.qty_damaged\n          });\n          return itemProxy;\n        });\n        isQcModalOpen.value = true;\n      } catch (err) {\n        console.error(\"Error loading PO for QC:\", err.response?.data || err.message);\n        alert(`Gagal memuat detail PO #${id} untuk QC.`);\n      }\n    };\n    const submitQcReport = async () => {\n      if (!isQcFormValid.value) {\n        qcError.value = \"Kuantitas total yang diterima (Baik + Rusak) tidak boleh melebihi Qty dipesan.\";\n        return;\n      }\n      submitting.value = true;\n      qcError.value = \"\";\n      const payloadItems = qcForm.value.items.map(item => ({\n        purchase_item_id: item.purchase_item_id,\n        qty_good: item.qty_good,\n        qty_damaged: item.qty_damaged,\n        note: item.note\n      }));\n      const payload = {\n        items: payloadItems\n      };\n      const id = qcForm.value.purchase_id;\n      try {\n        await axios.post(`${API_BASE}/gudang/purchases/${id}/qc-receive`, payload, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        alert(`QC Report untuk Purchase Order #${id} berhasil dicatat. Stok telah diperbarui dan status PO diubah menjadi RECEIVED.`);\n        closeQcModal();\n        loadPurchases();\n      } catch (err) {\n        console.error(\"Error submitting QC Report:\", err.response?.data || err.message);\n        qcError.value = `Gagal menyelesaikan QC & Penerimaan: ${err.response?.data?.error || err.response?.data?.message || \"Terjadi kesalahan pada server.\"}`;\n      } finally {\n        submitting.value = false;\n      }\n    };\n    onMounted(() => {\n      loadPurchases();\n    });\n    const __returned__ = {\n      API_BASE,\n      token,\n      purchases,\n      loading,\n      totalItems,\n      searchQuery,\n      currentStatus,\n      selectedPurchase,\n      isModalOpen,\n      isQcModalOpen,\n      submitting,\n      qcError,\n      qcForm,\n      isQcFormValid,\n      page,\n      size,\n      formatDate,\n      formatCurrency,\n      getStatusClass,\n      closeModal,\n      closeQcModal,\n      showDetail,\n      loadPurchases,\n      openQcModal,\n      submitQcReport,\n      ref,\n      onMounted,\n      computed,\n      get axios() {\n        return axios;\n      },\n      GudangSidebar\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","computed","axios","GudangSidebar","API_BASE","token","localStorage","getItem","purchases","loading","totalItems","searchQuery","currentStatus","selectedPurchase","isModalOpen","isQcModalOpen","submitting","qcError","qcForm","purchase_id","supplierName","purchaseDate","items","isQcFormValid","value","length","every","item","qty_good","qty_damaged","total_received","qty_ordered","page","size","formatDate","dateString","date","Date","day","String","getDate","padStart","month","getMonth","year","getFullYear","formatCurrency","amount","numericAmount","Number","Intl","NumberFormat","style","currency","minimumFractionDigits","format","getStatusClass","status","closeModal","closeQcModal","showDetail","id","res","get","headers","Authorization","data","err","console","error","response","message","alert","loadPurchases","params","q","total","openQcModal","po","Status","ID","Supplier","name","Items","map","itemProxy","purchase_item_id","product_id","Product_ID","product_name","Product","Qty","note","Object","defineProperty","enumerable","submitQcReport","payloadItems","payload","post"],"sources":["C:/Users/Personal/Documents/PKL/aplikasi/aplikasi/src/views/GoodsReceipt.vue"],"sourcesContent":["<template>\n  <div\n    class=\"flex\"\n    style=\"\n      font-family: 'Inter', 'Poppins', sans-serif;\n      background: linear-gradient(135deg, #1b262c 0%, #0f4c75 100%);\n      min-height: 100vh;\n    \"\n  >\n    <GudangSidebar />\n\n    <main class=\"flex-1 ml-64 p-6\">\n      <h1 class=\"text-3xl font-bold mb-6\" style=\"color: #bbe1fa\">\n        Penerimaan Barang (Goods Receipt)\n      </h1>\n\n      <div\n        class=\"flex justify-between items-center mb-6 p-4 rounded-lg border-2\"\n        style=\"background-color: #0f4c75; border-color: #3282b8\"\n      >\n        <div class=\"flex gap-3 items-center\">\n          <label class=\"text-sm font-medium\" style=\"color: #bbe1fa\"\n            >Filter Status:</label\n          >\n          <select\n            v-model=\"currentStatus\"\n            @change=\"loadPurchases\"\n            class=\"border-2 rounded-lg p-2.5 text-sm font-medium transition-all\"\n            style=\"\n              background-color: #1b262c;\n              border-color: #3282b8;\n              color: #bbe1fa;\n            \"\n          >\n            <option value=\"APPROVED\">Siap Diterima (APPROVED)</option>\n            <option value=\"RECEIVED\">Sudah Diterima (RECEIVED)</option>\n            <option value=\"\">Semua</option>\n          </select>\n        </div>\n        <input\n          type=\"text\"\n          v-model=\"searchQuery\"\n          @keyup.enter=\"loadPurchases\"\n          placeholder=\"Cari PO ID atau Supplier...\"\n          class=\"border-2 rounded-lg p-2.5 text-sm w-64 transition-all\"\n          style=\"\n            background-color: #1b262c;\n            border-color: #3282b8;\n            color: #bbe1fa;\n          \"\n        />\n      </div>\n\n      <div\n        class=\"shadow-2xl rounded-xl overflow-hidden border-2\"\n        style=\"border-color: #3282b8\"\n      >\n        <table class=\"min-w-full\">\n          <thead style=\"background-color: #3282b8\">\n            <tr>\n              <th\n                class=\"py-4 px-6 text-left text-sm font-bold uppercase tracking-wider\"\n                style=\"color: #bbe1fa\"\n              >\n                ID\n              </th>\n              <th\n                class=\"py-4 px-6 text-left text-sm font-bold uppercase tracking-wider\"\n                style=\"color: #bbe1fa\"\n              >\n                Tanggal\n              </th>\n              <th\n                class=\"py-4 px-6 text-left text-sm font-bold uppercase tracking-wider\"\n                style=\"color: #bbe1fa\"\n              >\n                Supplier\n              </th>\n              <th\n                class=\"py-4 px-6 text-right text-sm font-bold uppercase tracking-wider\"\n                style=\"color: #bbe1fa\"\n              >\n                Total\n              </th>\n              <th\n                class=\"py-4 px-6 text-center text-sm font-bold uppercase tracking-wider\"\n                style=\"color: #bbe1fa\"\n              >\n                Status\n              </th>\n              <th\n                class=\"py-4 px-6 text-center text-sm font-bold uppercase tracking-wider\"\n                style=\"color: #bbe1fa\"\n              >\n                Aksi\n              </th>\n            </tr>\n          </thead>\n          <tbody style=\"background-color: #0f4c75\">\n            <tr\n              v-for=\"po in purchases\"\n              :key=\"po.ID\"\n              class=\"border-b transition-all hover:bg-opacity-80\"\n              style=\"border-color: #3282b8\"\n            >\n              <td\n                class=\"py-4 px-6 whitespace-nowrap text-sm font-medium\"\n                style=\"color: #bbe1fa\"\n              >\n                {{ po.ID }}\n              </td>\n              <td class=\"py-4 px-6 text-sm\" style=\"color: #bbe1fa\">\n                {{ formatDate(po.Date) }}\n              </td>\n              <td class=\"py-4 px-6 text-sm\" style=\"color: #bbe1fa\">\n                {{ po.Supplier?.name || \"N/A\" }}\n              </td>\n              <td\n                class=\"py-4 px-6 text-right text-sm font-semibold\"\n                style=\"color: #bbe1fa\"\n              >\n                {{ formatCurrency(po.Total) }}\n              </td>\n              <td class=\"py-4 px-6 text-center\">\n                <span :class=\"getStatusClass(po.Status)\">\n                  {{ po.Status }}\n                </span>\n              </td>\n              <td\n                class=\"py-4 px-6 text-center flex justify-center items-center gap-2\"\n              >\n                <button\n                  v-if=\"po.Status === 'APPROVED'\"\n                  @click=\"openQcModal(po.ID)\"\n                  class=\"text-xs font-bold py-2 px-4 rounded-lg shadow-lg transition-all transform hover:scale-105\"\n                  style=\"background-color: #bbe1fa; color: #1b262c\"\n                >\n                  QC & Terima\n                </button>\n                <span\n                  v-else-if=\"po.Status === 'RECEIVED'\"\n                  class=\"text-xs font-bold px-3 py-1 rounded-full\"\n                  style=\"background-color: #4ade80; color: white\"\n                >\n                  âœ… Diterima\n                </span>\n                <button\n                  @click=\"showDetail(po.ID)\"\n                  class=\"text-xs font-medium px-3 py-1 rounded-lg transition-all\"\n                  style=\"color: #3282b8; text-decoration: underline\"\n                >\n                  Detail\n                </button>\n              </td>\n            </tr>\n            <tr v-if=\"!purchases.length && !loading\">\n              <td\n                colspan=\"6\"\n                class=\"py-6 text-center\"\n                style=\"color: #bbe1fa; opacity: 0.7\"\n              >\n                Tidak ada Purchase Order yang ditemukan.\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n\n      <div class=\"flex justify-between items-center mt-4\">\n        <p class=\"text-sm\" style=\"color: #bbe1fa\">Total: {{ totalItems }}</p>\n        <div v-if=\"loading\" style=\"color: #3282b8\">Memuat...</div>\n      </div>\n    </main>\n\n    <!-- Modal Detail -->\n    <div\n      v-if=\"isModalOpen\"\n      class=\"fixed inset-0 bg-black bg-opacity-75 overflow-y-auto h-full w-full z-50 flex justify-center items-center backdrop-blur-sm\"\n      @click=\"closeModal\"\n    >\n      <div\n        class=\"p-6 rounded-xl shadow-2xl max-w-4xl w-full mx-4 border-2\"\n        style=\"background-color: #0f4c75; border-color: #3282b8\"\n        @click.stop\n      >\n        <div\n          class=\"flex justify-between items-center border-b pb-3 mb-4\"\n          style=\"border-color: #3282b8\"\n        >\n          <h3 class=\"text-2xl font-bold\" style=\"color: #bbe1fa\">\n            Detail Purchase Order #{{ selectedPurchase?.ID }}\n          </h3>\n          <button\n            @click=\"closeModal\"\n            class=\"text-2xl leading-none hover:opacity-70\"\n            style=\"color: #bbe1fa\"\n          >\n            &times;\n          </button>\n        </div>\n\n        <div v-if=\"selectedPurchase\">\n          <h4 class=\"text-lg font-semibold mb-3\" style=\"color: #bbe1fa\">\n            Item Pembelian\n          </h4>\n          <div\n            class=\"overflow-x-auto border-2 rounded-lg\"\n            style=\"border-color: #3282b8\"\n          >\n            <table class=\"min-w-full text-sm\">\n              <thead style=\"background-color: #3282b8\">\n                <tr>\n                  <th\n                    class=\"py-3 px-4 text-left font-bold\"\n                    style=\"color: #bbe1fa\"\n                  >\n                    Produk\n                  </th>\n                  <th\n                    class=\"py-3 px-4 text-right font-bold\"\n                    style=\"color: #bbe1fa\"\n                  >\n                    Qty PO\n                  </th>\n                </tr>\n              </thead>\n              <tbody style=\"background-color: #1b262c\">\n                <tr\n                  v-for=\"item in selectedPurchase.Items\"\n                  :key=\"item.ID\"\n                  class=\"border-t\"\n                  style=\"border-color: #3282b8\"\n                >\n                  <td class=\"py-3 px-4\" style=\"color: #bbe1fa\">\n                    {{ item.Product?.name || \"Produk Hilang\" }}\n                  </td>\n                  <td\n                    class=\"py-3 px-4 text-right font-semibold\"\n                    style=\"color: #bbe1fa\"\n                  >\n                    {{ item.Qty }}\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n\n        <div class=\"mt-6 flex justify-end\">\n          <button\n            @click=\"closeModal\"\n            class=\"font-bold py-2 px-6 rounded-lg shadow-lg transition-all\"\n            style=\"\n              background-color: #1b262c;\n              color: #bbe1fa;\n              border: 2px solid #3282b8;\n            \"\n          >\n            Tutup\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <!-- Modal QC -->\n    <div\n      v-if=\"isQcModalOpen\"\n      class=\"fixed inset-0 bg-black bg-opacity-75 overflow-y-auto h-full w-full z-50 flex justify-center items-center backdrop-blur-sm\"\n      @click=\"closeQcModal\"\n    >\n      <div\n        class=\"p-6 rounded-xl shadow-2xl max-w-5xl w-full mx-4 border-2\"\n        style=\"background-color: #0f4c75; border-color: #3282b8\"\n        @click.stop\n      >\n        <div\n          class=\"flex justify-between items-center border-b pb-3 mb-4\"\n          style=\"border-color: #3282b8\"\n        >\n          <h3 class=\"text-2xl font-bold\" style=\"color: #bbe1fa\">\n            Laporan Quality Control (PO #{{ qcForm.purchase_id }})\n          </h3>\n          <button\n            @click=\"closeQcModal\"\n            class=\"text-2xl leading-none hover:opacity-70\"\n            style=\"color: #bbe1fa\"\n            :disabled=\"submitting\"\n          >\n            &times;\n          </button>\n        </div>\n\n        <form @submit.prevent=\"submitQcReport\">\n          <div class=\"mb-4\">\n            <p class=\"text-sm font-medium\" style=\"color: #bbe1fa\">\n              Supplier:\n              <span class=\"font-bold\">{{ qcForm.supplierName }}</span>\n            </p>\n          </div>\n\n          <h4 class=\"text-base font-semibold mb-3\" style=\"color: #bbe1fa\">\n            Input Hasil QC per Item\n          </h4>\n          <div\n            class=\"overflow-x-auto border-2 rounded-lg max-h-80\"\n            style=\"border-color: #3282b8\"\n          >\n            <table class=\"min-w-full text-sm\">\n              <thead style=\"background-color: #3282b8\">\n                <tr>\n                  <th\n                    class=\"py-3 px-4 text-left w-2/5 font-bold\"\n                    style=\"color: #bbe1fa\"\n                  >\n                    Produk\n                  </th>\n                  <th\n                    class=\"py-3 px-4 text-center w-1/12 font-bold\"\n                    style=\"color: #bbe1fa\"\n                  >\n                    Qty PO\n                  </th>\n                  <th\n                    class=\"py-3 px-4 text-center w-1/12 font-bold\"\n                    style=\"color: #bbe1fa\"\n                  >\n                    Qty Baik\n                  </th>\n                  <th\n                    class=\"py-3 px-4 text-center w-1/12 font-bold\"\n                    style=\"color: #bbe1fa\"\n                  >\n                    Qty Rusak\n                  </th>\n                  <th\n                    class=\"py-3 px-4 text-center w-1/12 font-bold\"\n                    style=\"color: #bbe1fa\"\n                  >\n                    Total Terima\n                  </th>\n                  <th\n                    class=\"py-3 px-4 text-left w-1/5 font-bold\"\n                    style=\"color: #bbe1fa\"\n                  >\n                    Catatan\n                  </th>\n                </tr>\n              </thead>\n              <tbody style=\"background-color: #1b262c\">\n                <tr\n                  v-for=\"(item, index) in qcForm.items\"\n                  :key=\"index\"\n                  class=\"border-t\"\n                  style=\"border-color: #3282b8\"\n                >\n                  <td class=\"py-3 px-4 font-medium\" style=\"color: #bbe1fa\">\n                    {{ item.product_name }}\n                  </td>\n                  <td\n                    class=\"py-3 px-4 text-center font-semibold\"\n                    style=\"color: #bbe1fa\"\n                  >\n                    {{ item.qty_ordered }}\n                  </td>\n                  <td class=\"py-3 px-4 text-center\">\n                    <input\n                      v-model.number=\"item.qty_good\"\n                      type=\"number\"\n                      min=\"0\"\n                      required\n                      class=\"w-full rounded-lg text-sm p-2 text-center border-2\"\n                      style=\"\n                        background-color: #0f4c75;\n                        border-color: #3282b8;\n                        color: #bbe1fa;\n                      \"\n                    />\n                  </td>\n                  <td class=\"py-3 px-4 text-center\">\n                    <input\n                      v-model.number=\"item.qty_damaged\"\n                      type=\"number\"\n                      min=\"0\"\n                      class=\"w-full rounded-lg text-sm p-2 text-center border-2\"\n                      style=\"\n                        background-color: #0f4c75;\n                        border-color: #3282b8;\n                        color: #bbe1fa;\n                      \"\n                    />\n                  </td>\n                  <td\n                    class=\"py-3 px-4 text-center font-bold\"\n                    :class=\"{\n                      'text-red-500': item.total_received > item.qty_ordered,\n                    }\"\n                    :style=\"{\n                      color:\n                        item.total_received > item.qty_ordered\n                          ? '#ff6b6b'\n                          : '#BBE1FA',\n                    }\"\n                  >\n                    {{ item.total_received }}\n                    <p\n                      v-if=\"item.total_received > item.qty_ordered\"\n                      class=\"text-red-500 text-xs mt-1\"\n                    >\n                      Melebihi PO!\n                    </p>\n                  </td>\n                  <td class=\"py-3 px-4\">\n                    <input\n                      v-model=\"item.note\"\n                      type=\"text\"\n                      class=\"w-full rounded-lg text-sm p-2 border-2\"\n                      style=\"\n                        background-color: #0f4c75;\n                        border-color: #3282b8;\n                        color: #bbe1fa;\n                      \"\n                      placeholder=\"e.g. 5 Pcs Rusak karena goresan\"\n                    />\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n\n          <p\n            v-if=\"qcError\"\n            class=\"text-red-400 text-sm mt-4 p-3 rounded-lg border-2\"\n            style=\"background-color: #1b262c; border-color: #ff6b6b\"\n          >\n            <strong>Error:</strong> {{ qcError }}\n          </p>\n\n          <div class=\"mt-6 flex justify-end gap-3\">\n            <button\n              type=\"button\"\n              @click=\"closeQcModal\"\n              class=\"px-6 py-2 rounded-lg shadow-lg font-medium transition-all border-2\"\n              style=\"\n                background-color: #1b262c;\n                color: #bbe1fa;\n                border-color: #3282b8;\n              \"\n              :disabled=\"submitting\"\n            >\n              Batal\n            </button>\n            <button\n              type=\"submit\"\n              :disabled=\"submitting || !isQcFormValid\"\n              class=\"px-6 py-2 font-semibold rounded-lg shadow-lg transition-all transform hover:scale-105 disabled:opacity-50\"\n              style=\"background-color: #bbe1fa; color: #1b262c\"\n            >\n              {{ submitting ? \"Memproses...\" : \"Selesaikan QC & Terima\" }}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted, computed } from \"vue\";\nimport axios from \"axios\";\nimport GudangSidebar from \"../components/GudangSidebar.vue\";\n\nconst API_BASE = \"http://localhost:8081/api/v1\";\nconst token = localStorage.getItem(\"token\");\n\nconst purchases = ref([]);\nconst loading = ref(false);\nconst totalItems = ref(0);\nconst searchQuery = ref(\"\");\nconst currentStatus = ref(\"APPROVED\");\n\nconst selectedPurchase = ref(null);\nconst isModalOpen = ref(false);\n\nconst isQcModalOpen = ref(false);\nconst submitting = ref(false);\nconst qcError = ref(\"\");\nconst qcForm = ref({\n  purchase_id: null,\n  supplierName: \"\",\n  purchaseDate: \"\",\n  items: [],\n});\n\nconst isQcFormValid = computed(() => {\n  return (\n    qcForm.value.items.length > 0 &&\n    qcForm.value.items.every(\n      (item) =>\n        item.qty_good !== null &&\n        item.qty_good >= 0 &&\n        item.qty_damaged !== null &&\n        item.qty_damaged >= 0 &&\n        item.total_received <= item.qty_ordered\n    )\n  );\n});\n\nconst page = ref(1);\nconst size = ref(10);\n\nconst formatDate = (dateString) => {\n  if (!dateString) return \"-\";\n  const date = new Date(dateString);\n  const day = String(date.getDate()).padStart(2, \"0\");\n  const month = String(date.getMonth() + 1).padStart(2, \"0\");\n  const year = date.getFullYear();\n  return `${day}/${month}/${year}`;\n};\n\nconst formatCurrency = (amount) => {\n  const numericAmount = Number(amount) || 0;\n\n  return new Intl.NumberFormat(\"id-ID\", {\n    style: \"currency\",\n    currency: \"IDR\",\n    minimumFractionDigits: 0,\n  }).format(numericAmount);\n};\n\nconst getStatusClass = (status) => {\n  switch (status) {\n    case \"APPROVED\":\n      return \"bg-yellow-400 text-gray-900 py-1 px-3 rounded-full text-xs font-medium\";\n    case \"RECEIVED\":\n      return \"bg-green-400 text-gray-900 py-1 px-3 rounded-full text-xs font-medium\";\n    case \"REJECTED\":\n      return \"bg-red-400 text-white py-1 px-3 rounded-full text-xs font-medium\";\n    default:\n      return \"bg-gray-400 text-gray-900 py-1 px-3 rounded-full text-xs font-medium\";\n  }\n};\n\nconst closeModal = () => {\n  isModalOpen.value = false;\n  selectedPurchase.value = null;\n};\n\nconst closeQcModal = () => {\n  isQcModalOpen.value = false;\n  qcError.value = \"\";\n  qcForm.value = {\n    purchase_id: null,\n    supplierName: \"\",\n    purchaseDate: \"\",\n    items: [],\n  };\n};\n\nconst showDetail = async (id) => {\n  try {\n    const res = await axios.get(`${API_BASE}/history/purchases/${id}`, {\n      headers: { Authorization: `Bearer ${token}` },\n    });\n\n    selectedPurchase.value = res.data.data;\n    isModalOpen.value = true;\n  } catch (err) {\n    console.error(\n      \"Error loading purchase detail:\",\n      err.response?.data || err.message\n    );\n    alert(`Gagal memuat detail Purchase Order #${id}.`);\n  }\n};\n\nconst loadPurchases = async () => {\n  loading.value = true;\n  purchases.value = [];\n  try {\n    const res = await axios.get(`${API_BASE}/history/purchases`, {\n      headers: { Authorization: `Bearer ${token}` },\n      params: {\n        page: page.value,\n        size: size.value,\n        q: searchQuery.value,\n        status: currentStatus.value,\n      },\n    });\n\n    const data = res.data.data?.data || res.data.data || [];\n    totalItems.value = res.data.data?.total || 0;\n    purchases.value = data;\n  } catch (err) {\n    console.error(\"Error load purchases:\", err.response?.data || err.message);\n    alert(\"Gagal memuat daftar Purchase Order.\");\n  } finally {\n    loading.value = false;\n  }\n};\n\nconst openQcModal = async (id) => {\n  try {\n    const res = await axios.get(`${API_BASE}/history/purchases/${id}`, {\n      headers: { Authorization: `Bearer ${token}` },\n    });\n\n    const po = res.data.data;\n\n    if (!po || po.Status !== \"APPROVED\") {\n      alert(\"PO ini tidak bisa diproses karena statusnya bukan APPROVED.\");\n      return;\n    }\n\n    qcForm.value.purchase_id = po.ID;\n    qcForm.value.supplierName = po.Supplier?.name || \"N/A\";\n    qcForm.value.purchaseDate = po.Date;\n\n    qcForm.value.items = po.Items.map((item) => {\n      const itemProxy = {\n        purchase_item_id: item.ID,\n        product_id: item.Product_ID,\n        product_name: item.Product?.name || \"Produk Hilang\",\n        qty_ordered: item.Qty,\n        qty_good: item.Qty,\n        qty_damaged: 0,\n        note: \"\",\n      };\n\n      Object.defineProperty(itemProxy, \"total_received\", {\n        enumerable: true,\n        get: () => itemProxy.qty_good + itemProxy.qty_damaged,\n      });\n      return itemProxy;\n    });\n\n    isQcModalOpen.value = true;\n  } catch (err) {\n    console.error(\n      \"Error loading PO for QC:\",\n      err.response?.data || err.message\n    );\n    alert(`Gagal memuat detail PO #${id} untuk QC.`);\n  }\n};\n\nconst submitQcReport = async () => {\n  if (!isQcFormValid.value) {\n    qcError.value =\n      \"Kuantitas total yang diterima (Baik + Rusak) tidak boleh melebihi Qty dipesan.\";\n    return;\n  }\n\n  submitting.value = true;\n  qcError.value = \"\";\n\n  const payloadItems = qcForm.value.items.map((item) => ({\n    purchase_item_id: item.purchase_item_id,\n    qty_good: item.qty_good,\n    qty_damaged: item.qty_damaged,\n    note: item.note,\n  }));\n\n  const payload = {\n    items: payloadItems,\n  };\n\n  const id = qcForm.value.purchase_id;\n\n  try {\n    await axios.post(`${API_BASE}/gudang/purchases/${id}/qc-receive`, payload, {\n      headers: { Authorization: `Bearer ${token}` },\n    });\n\n    alert(\n      `QC Report untuk Purchase Order #${id} berhasil dicatat. Stok telah diperbarui dan status PO diubah menjadi RECEIVED.`\n    );\n\n    closeQcModal();\n    loadPurchases();\n  } catch (err) {\n    console.error(\n      \"Error submitting QC Report:\",\n      err.response?.data || err.message\n    );\n    qcError.value = `Gagal menyelesaikan QC & Penerimaan: ${\n      err.response?.data?.error ||\n      err.response?.data?.message ||\n      \"Terjadi kesalahan pada server.\"\n    }`;\n  } finally {\n    submitting.value = false;\n  }\n};\n\nonMounted(() => {\n  loadPurchases();\n});\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}