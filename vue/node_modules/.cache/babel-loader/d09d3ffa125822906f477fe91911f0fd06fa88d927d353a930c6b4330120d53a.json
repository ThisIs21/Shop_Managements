{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { ref, onMounted } from \"vue\";\nimport axios from \"axios\";\nimport PurchasingSidebar from \"../components/PurchasingSidebar.vue\";\nexport default {\n  __name: 'CreatePurchase',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const suppliers = ref([]);\n    const products = ref([]);\n    const selectedProduct = ref(\"\");\n    const qty = ref(1);\n    const token = localStorage.getItem(\"token\");\n    const role = localStorage.getItem(\"role\"); // ambil role dari localStorage\n\n    const form = ref({\n      supplier_id: null,\n      date: \"\",\n      items: [],\n      submit: true\n    });\n\n    // Ambil supplier\n    const loadSuppliers = async () => {\n      try {\n        const res = await axios.get(\"http://localhost:8081/api/v1/pembelian/suppliers\", {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        console.log(\"Supplier response:\", res.data);\n        suppliers.value = res.data.data || res.data.suppliers || res.data;\n      } catch (err) {\n        console.error(\"Error load suppliers:\", err.response?.data || err.message);\n      }\n    };\n\n    // Ambil produk\n    const loadProducts = async () => {\n      try {\n        const res = await axios.get(\"http://localhost:8081/api/v1/products\", {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        products.value = res.data.data;\n      } catch (err) {\n        console.error(\"Error load products:\", err.response?.data || err.message);\n      }\n    };\n\n    // Tambah item\n    const addItem = () => {\n      if (!selectedProduct.value || qty.value <= 0) return;\n      form.value.items.push({\n        product_id: selectedProduct.value.id,\n        name: selectedProduct.value.name,\n        qty: qty.value,\n        price: selectedProduct.value.price\n      });\n      selectedProduct.value = \"\";\n      qty.value = 1;\n    };\n\n    // Submit purchase\n    const submitPurchase = async () => {\n      try {\n        const payload = {\n          supplier_id: Number(form.value.supplier_id),\n          date: new Date(form.value.date).toISOString(),\n          items: form.value.items.map(i => ({\n            product_id: i.product_id,\n            qty: i.qty,\n            price: i.price\n          })),\n          submit: true\n        };\n        await axios.post(\"http://localhost:8081/api/v1/pembelian/purchases\", payload, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        alert(\"Purchase berhasil disimpan!\");\n        form.value = {\n          supplier_id: null,\n          date: \"\",\n          items: [],\n          submit: true\n        };\n      } catch (err) {\n        console.error(\"Error submit purchase:\", err.response?.data || err.message);\n      }\n    };\n    onMounted(() => {\n      loadSuppliers();\n      loadProducts();\n    });\n    const __returned__ = {\n      suppliers,\n      products,\n      selectedProduct,\n      qty,\n      token,\n      role,\n      form,\n      loadSuppliers,\n      loadProducts,\n      addItem,\n      submitPurchase,\n      ref,\n      onMounted,\n      get axios() {\n        return axios;\n      },\n      PurchasingSidebar\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","axios","PurchasingSidebar","suppliers","products","selectedProduct","qty","token","localStorage","getItem","role","form","supplier_id","date","items","submit","loadSuppliers","res","get","headers","Authorization","console","log","data","value","err","error","response","message","loadProducts","addItem","push","product_id","id","name","price","submitPurchase","payload","Number","Date","toISOString","map","i","post","alert"],"sources":["C:/Users/Personal/Documents/PKL/aplikasi/aplikasi/src/views/CreatePurchase.vue"],"sourcesContent":["<template>\n  <div class=\"flex\">\n    <!-- Sidebar -->\n    <PurchasingSidebar />\n\n    <!-- Konten utama -->\n    <main class=\"flex-1 ml-64 p-6\">\n      <h1 class=\"text-2xl font-bold mb-6\">Create Purchase Order</h1>\n\n      <form @submit.prevent=\"submitPurchase\">\n        <!-- Supplier -->\n        <div class=\"mb-4\">\n          <label class=\"block mb-2 text-sm font-medium\">Supplier</label>\n          <select v-model=\"form.supplier_id\" class=\"w-full border rounded p-2\">\n            <option value=\"\">-- Pilih Supplier --</option>\n            <option v-for=\"s in suppliers\" :key=\"s.id\" :value=\"s.id\">\n              {{ s.name }}\n            </option>\n          </select>\n        </div>\n\n        <!-- Tanggal -->\n        <div class=\"mb-4\">\n          <label class=\"block mb-2 text-sm font-medium\">Tanggal</label>\n          <input\n            type=\"date\"\n            v-model=\"form.date\"\n            class=\"w-full border rounded p-2\"\n          />\n        </div>\n\n        <!-- Produk -->\n        <div class=\"mb-4\">\n          <label class=\"block mb-2 text-sm font-medium\">Tambah Produk</label>\n          <div class=\"flex gap-2\">\n            <select v-model=\"selectedProduct\" class=\"border rounded p-2\">\n              <option value=\"\">-- Pilih Produk --</option>\n              <option v-for=\"p in products\" :key=\"p.id\" :value=\"p\">\n                {{ p.name }}\n              </option>\n            </select>\n            <input\n              type=\"number\"\n              v-model.number=\"qty\"\n              placeholder=\"Qty\"\n              class=\"w-24 border rounded p-2\"\n            />\n            <button\n              type=\"button\"\n              @click=\"addItem\"\n              class=\"bg-blue-500 text-white px-3 py-1 rounded\"\n            >\n              Tambah\n            </button>\n          </div>\n        </div>\n\n        <!-- List Item -->\n        <div v-if=\"form.items.length\" class=\"mb-4\">\n          <h2 class=\"font-semibold mb-2\">Daftar Item</h2>\n          <table class=\"w-full border\">\n            <thead>\n              <tr class=\"bg-gray-100\">\n                <th class=\"p-2 border\">Produk</th>\n                <th class=\"p-2 border\">Qty</th>\n                <th class=\"p-2 border\">Harga</th>\n                <th class=\"p-2 border\">Subtotal</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr v-for=\"(item, i) in form.items\" :key=\"i\">\n                <td class=\"border p-2\">{{ item.name }}</td>\n                <td class=\"border p-2\">{{ item.qty }}</td>\n                <td class=\"border p-2\">{{ item.price }}</td>\n                <td class=\"border p-2\">{{ item.qty * item.price }}</td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n\n        <!-- Tombol -->\n        <div class=\"mt-6\">\n          <button\n            type=\"submit\"\n            class=\"bg-green-500 text-white px-4 py-2 rounded\"\n          >\n            Simpan\n          </button>\n        </div>\n      </form>\n    </main>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted } from \"vue\";\nimport axios from \"axios\";\nimport PurchasingSidebar from \"../components/PurchasingSidebar.vue\";\n\nconst suppliers = ref([]);\nconst products = ref([]);\nconst selectedProduct = ref(\"\");\nconst qty = ref(1);\n\nconst token = localStorage.getItem(\"token\");\nconst role = localStorage.getItem(\"role\"); // ambil role dari localStorage\n\nconst form = ref({\n  supplier_id: null,\n  date: \"\",\n  items: [],\n  submit: true,\n});\n\n// Ambil supplier\nconst loadSuppliers = async () => {\n  try {\n    const res = await axios.get(\n      \"http://localhost:8081/api/v1/pembelian/suppliers\",\n      {\n        headers: { Authorization: `Bearer ${token}` },\n      }\n    );\n    console.log(\"Supplier response:\", res.data);\n    suppliers.value = res.data.data || res.data.suppliers || res.data;\n  } catch (err) {\n    console.error(\"Error load suppliers:\", err.response?.data || err.message);\n  }\n};\n\n// Ambil produk\nconst loadProducts = async () => {\n  try {\n    const res = await axios.get(\"http://localhost:8081/api/v1/products\", {\n      headers: { Authorization: `Bearer ${token}` },\n    });\n    products.value = res.data.data;\n  } catch (err) {\n    console.error(\"Error load products:\", err.response?.data || err.message);\n  }\n};\n\n// Tambah item\nconst addItem = () => {\n  if (!selectedProduct.value || qty.value <= 0) return;\n\n  form.value.items.push({\n    product_id: selectedProduct.value.id,\n    name: selectedProduct.value.name,\n    qty: qty.value,\n    price: selectedProduct.value.price,\n  });\n\n  selectedProduct.value = \"\";\n  qty.value = 1;\n};\n\n// Submit purchase\nconst submitPurchase = async () => {\n  try {\n    const payload = {\n      supplier_id: Number(form.value.supplier_id),\n      date: new Date(form.value.date).toISOString(),\n      items: form.value.items.map((i) => ({\n        product_id: i.product_id,\n        qty: i.qty,\n        price: i.price,\n      })),\n      submit: true,\n    };\n\n    await axios.post(\n      \"http://localhost:8081/api/v1/pembelian/purchases\",\n      payload,\n      {\n        headers: { Authorization: `Bearer ${token}` },\n      }\n    );\n\n    alert(\"Purchase berhasil disimpan!\");\n    form.value = { supplier_id: null, date: \"\", items: [], submit: true };\n  } catch (err) {\n    console.error(\"Error submit purchase:\", err.response?.data || err.message);\n  }\n};\n\nonMounted(() => {\n  loadSuppliers();\n  loadProducts();\n});\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}