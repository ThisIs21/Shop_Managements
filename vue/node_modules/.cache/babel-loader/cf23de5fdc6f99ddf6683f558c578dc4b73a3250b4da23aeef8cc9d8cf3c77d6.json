{"ast":null,"code":"import { createVNode as _createVNode, createElementVNode as _createElementVNode, vModelSelect as _vModelSelect, withDirectives as _withDirectives, vModelText as _vModelText, withKeys as _withKeys, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, normalizeClass as _normalizeClass, createCommentVNode as _createCommentVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"flex\"\n};\nconst _hoisted_2 = {\n  class: \"flex-1 ml-64 p-6\"\n};\nconst _hoisted_3 = {\n  class: \"flex justify-between items-center mb-4\"\n};\nconst _hoisted_4 = {\n  class: \"flex gap-2\"\n};\nconst _hoisted_5 = {\n  class: \"bg-white shadow-md rounded-lg overflow-hidden\"\n};\nconst _hoisted_6 = {\n  class: \"min-w-full leading-normal\"\n};\nconst _hoisted_7 = {\n  class: \"text-gray-600 text-sm font-light\"\n};\nconst _hoisted_8 = {\n  class: \"py-3 px-6 text-left whitespace-nowrap\"\n};\nconst _hoisted_9 = {\n  class: \"py-3 px-6 text-left\"\n};\nconst _hoisted_10 = {\n  class: \"py-3 px-6 text-left\"\n};\nconst _hoisted_11 = {\n  class: \"py-3 px-6 text-right\"\n};\nconst _hoisted_12 = {\n  class: \"py-3 px-6 text-center\"\n};\nconst _hoisted_13 = {\n  class: \"py-3 px-6 text-center\"\n};\nconst _hoisted_14 = [\"onClick\", \"disabled\"];\nconst _hoisted_15 = {\n  key: 1,\n  class: \"text-green-500 font-bold text-xs\"\n};\nconst _hoisted_16 = [\"onClick\"];\nconst _hoisted_17 = {\n  class: \"flex justify-between items-center mt-4\"\n};\nconst _hoisted_18 = {\n  class: \"text-sm text-gray-600\"\n};\nconst _hoisted_19 = {\n  key: 0,\n  class: \"text-blue-500\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode($setup[\"GudangSidebar\"]), _createElementVNode(\"main\", _hoisted_2, [_cache[5] || (_cache[5] = _createElementVNode(\"h1\", {\n    class: \"text-2xl font-bold mb-6\"\n  }, \"Penerimaan Barang (Goods Receipt)\", -1 /* CACHED */)), _createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"div\", _hoisted_4, [_cache[3] || (_cache[3] = _createElementVNode(\"label\", {\n    class: \"text-sm font-medium pt-2\"\n  }, \"Filter:\", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"select\", {\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.currentStatus = $event),\n    onChange: $setup.loadPurchases,\n    class: \"border rounded p-2 text-sm\"\n  }, [...(_cache[2] || (_cache[2] = [_createElementVNode(\"option\", {\n    value: \"APPROVED\"\n  }, \"Disetujui (APPROVED)\", -1 /* CACHED */), _createElementVNode(\"option\", {\n    value: \"RECEIVED\"\n  }, \"Sudah Diterima (RECEIVED)\", -1 /* CACHED */), _createElementVNode(\"option\", {\n    value: \"\"\n  }, \"Semua\", -1 /* CACHED */)]))], 544 /* NEED_HYDRATION, NEED_PATCH */), [[_vModelSelect, $setup.currentStatus]])]), _withDirectives(_createElementVNode(\"input\", {\n    type: \"text\",\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $setup.searchQuery = $event),\n    onKeyup: _withKeys($setup.loadPurchases, [\"enter\"]),\n    placeholder: \"Cari PO ID atau Total...\",\n    class: \"border rounded p-2 text-sm w-64\"\n  }, null, 544 /* NEED_HYDRATION, NEED_PATCH */), [[_vModelText, $setup.searchQuery]])]), _createElementVNode(\"div\", _hoisted_5, [_createElementVNode(\"table\", _hoisted_6, [_cache[4] || (_cache[4] = _createElementVNode(\"thead\", null, [_createElementVNode(\"tr\", {\n    class: \"bg-gray-100 text-gray-600 uppercase text-sm leading-normal\"\n  }, [_createElementVNode(\"th\", {\n    class: \"py-3 px-6 text-left\"\n  }, \"ID\"), _createElementVNode(\"th\", {\n    class: \"py-3 px-6 text-left\"\n  }, \"Tanggal\"), _createElementVNode(\"th\", {\n    class: \"py-3 px-6 text-left\"\n  }, \"Supplier\"), _createElementVNode(\"th\", {\n    class: \"py-3 px-6 text-right\"\n  }, \"Total\"), _createElementVNode(\"th\", {\n    class: \"py-3 px-6 text-center\"\n  }, \"Status\"), _createElementVNode(\"th\", {\n    class: \"py-3 px-6 text-center\"\n  }, \"Aksi\")])], -1 /* CACHED */)), _createElementVNode(\"tbody\", _hoisted_7, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.purchases, po => {\n    return _openBlock(), _createElementBlock(\"tr\", {\n      key: po.ID,\n      class: \"border-b border-gray-200 hover:bg-gray-50\"\n    }, [_createElementVNode(\"td\", _hoisted_8, _toDisplayString(po.ID), 1 /* TEXT */), _createElementVNode(\"td\", _hoisted_9, _toDisplayString($setup.formatDate(po.Date)), 1 /* TEXT */), _createElementVNode(\"td\", _hoisted_10, _toDisplayString(po.Supplier?.name || \"N/A\"), 1 /* TEXT */), _createElementVNode(\"td\", _hoisted_11, _toDisplayString($setup.formatCurrency(po.Total)), 1 /* TEXT */), _createElementVNode(\"td\", _hoisted_12, [_createElementVNode(\"span\", {\n      class: _normalizeClass($setup.getStatusClass(po.Status))\n    }, _toDisplayString(po.Status), 3 /* TEXT, CLASS */)]), _createElementVNode(\"td\", _hoisted_13, [po.Status === 'APPROVED' ? (_openBlock(), _createElementBlock(\"button\", {\n      key: 0,\n      onClick: $event => $setup.receivePurchase(po.ID),\n      disabled: $setup.loadingStates[po.ID],\n      class: \"bg-green-500 hover:bg-green-600 text-white text-xs font-bold py-1 px-3 rounded disabled:opacity-50\"\n    }, \" Terima \", 8 /* PROPS */, _hoisted_14)) : po.Status === 'RECEIVED' ? (_openBlock(), _createElementBlock(\"span\", _hoisted_15, \" ✅ Diterima \")) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"button\", {\n      onClick: $event => $setup.showDetail(po.ID),\n      class: \"ml-2 text-blue-500 hover:text-blue-700 text-xs\"\n    }, \" Detail \", 8 /* PROPS */, _hoisted_16)])]);\n  }), 128 /* KEYED_FRAGMENT */))])])]), _createElementVNode(\"div\", _hoisted_17, [_createElementVNode(\"p\", _hoisted_18, \"Total: \" + _toDisplayString($setup.totalItems), 1 /* TEXT */), $setup.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_19, \"Memuat...\")) : _createCommentVNode(\"v-if\", true)])])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createVNode","$setup","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","currentStatus","$event","onChange","loadPurchases","value","type","searchQuery","onKeyup","_withKeys","placeholder","_hoisted_5","_hoisted_6","_hoisted_7","_Fragment","_renderList","purchases","po","key","ID","_hoisted_8","_toDisplayString","_hoisted_9","formatDate","Date","_hoisted_10","Supplier","name","_hoisted_11","formatCurrency","Total","_hoisted_12","_normalizeClass","getStatusClass","Status","_hoisted_13","onClick","receivePurchase","disabled","loadingStates","_hoisted_14","_hoisted_15","showDetail","_hoisted_16","_hoisted_17","_hoisted_18","totalItems","loading","_hoisted_19"],"sources":["C:\\Users\\Personal\\Documents\\PKL\\aplikasi\\aplikasi\\src\\views\\GoodsReceipt.vue"],"sourcesContent":["<template>\n  <div class=\"flex\">\n    <GudangSidebar />\n\n    <main class=\"flex-1 ml-64 p-6\">\n      <h1 class=\"text-2xl font-bold mb-6\">Penerimaan Barang (Goods Receipt)</h1>\n\n      <div class=\"flex justify-between items-center mb-4\">\n        <div class=\"flex gap-2\">\n          <label class=\"text-sm font-medium pt-2\">Filter:</label>\n          <select\n            v-model=\"currentStatus\"\n            @change=\"loadPurchases\"\n            class=\"border rounded p-2 text-sm\"\n          >\n            <option value=\"APPROVED\">Disetujui (APPROVED)</option>\n            <option value=\"RECEIVED\">Sudah Diterima (RECEIVED)</option>\n            <option value=\"\">Semua</option>\n          </select>\n        </div>\n        <input\n          type=\"text\"\n          v-model=\"searchQuery\"\n          @keyup.enter=\"loadPurchases\"\n          placeholder=\"Cari PO ID atau Total...\"\n          class=\"border rounded p-2 text-sm w-64\"\n        />\n      </div>\n\n      <div class=\"bg-white shadow-md rounded-lg overflow-hidden\">\n        <table class=\"min-w-full leading-normal\">\n          <thead>\n            <tr\n              class=\"bg-gray-100 text-gray-600 uppercase text-sm leading-normal\"\n            >\n              <th class=\"py-3 px-6 text-left\">ID</th>\n              <th class=\"py-3 px-6 text-left\">Tanggal</th>\n              <th class=\"py-3 px-6 text-left\">Supplier</th>\n              <th class=\"py-3 px-6 text-right\">Total</th>\n              <th class=\"py-3 px-6 text-center\">Status</th>\n              <th class=\"py-3 px-6 text-center\">Aksi</th>\n            </tr>\n          </thead>\n          <tbody class=\"text-gray-600 text-sm font-light\">\n            <tr\n              v-for=\"po in purchases\"\n              :key=\"po.ID\"\n              class=\"border-b border-gray-200 hover:bg-gray-50\"\n            >\n              <td class=\"py-3 px-6 text-left whitespace-nowrap\">{{ po.ID }}</td>\n              <td class=\"py-3 px-6 text-left\">\n                {{ formatDate(po.Date) }}\n              </td>\n              <td class=\"py-3 px-6 text-left\">\n                {{ po.Supplier?.name || \"N/A\" }}\n              </td>\n              <td class=\"py-3 px-6 text-right\">\n                {{ formatCurrency(po.Total) }}\n              </td>\n              <td class=\"py-3 px-6 text-center\">\n                <span :class=\"getStatusClass(po.Status)\">\n                  {{ po.Status }}\n                </span>\n              </td>\n              <td class=\"py-3 px-6 text-center\">\n                <button\n                  v-if=\"po.Status === 'APPROVED'\"\n                  @click=\"receivePurchase(po.ID)\"\n                  :disabled=\"loadingStates[po.ID]\"\n                  class=\"bg-green-500 hover:bg-green-600 text-white text-xs font-bold py-1 px-3 rounded disabled:opacity-50\"\n                >\n                  Terima\n                </button>\n                <span\n                  v-else-if=\"po.Status === 'RECEIVED'\"\n                  class=\"text-green-500 font-bold text-xs\"\n                >\n                  ✅ Diterima\n                </span>\n                <button\n                  @click=\"showDetail(po.ID)\"\n                  class=\"ml-2 text-blue-500 hover:text-blue-700 text-xs\"\n                >\n                  Detail\n                </button>\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n\n      <div class=\"flex justify-between items-center mt-4\">\n        <p class=\"text-sm text-gray-600\">Total: {{ totalItems }}</p>\n        <div v-if=\"loading\" class=\"text-blue-500\">Memuat...</div>\n      </div>\n    </main>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted } from \"vue\";\nimport axios from \"axios\";\nimport GudangSidebar from \"../components/GudangSidebar.vue\"; // Import sidebar baru\nimport { useRouter } from \"vue-router\";\n\nconst router = useRouter();\nconst API_BASE = \"http://localhost:8081/api/v1\";\nconst token = localStorage.getItem(\"token\");\n\nconst purchases = ref([]);\nconst loading = ref(false);\nconst totalItems = ref(0);\nconst searchQuery = ref(\"\");\nconst currentStatus = ref(\"APPROVED\"); // Default hanya tampilkan yang APPROVED\nconst loadingStates = ref({}); // Untuk status loading per PO\n\nconst page = ref(1);\nconst size = ref(10); // Asumsi size\n\n// --- Helper Functions ---\nconst formatDate = (dateString) => {\n  if (!dateString) return \"-\";\n  return new Date(dateString).toLocaleDateString(\"id-ID\");\n};\n\nconst formatCurrency = (amount) => {\n  // FIX: Konversi amount ke Number secara eksplisit.\n  // Jika amount null, undefined, atau string non-angka, gunakan 0 untuk mencegah RpNaN.\n  const numericAmount = Number(amount) || 0;\n\n  return new Intl.NumberFormat(\"id-ID\", {\n    style: \"currency\",\n    currency: \"IDR\",\n    minimumFractionDigits: 0,\n  }).format(numericAmount);\n};\n\nconst getStatusClass = (status) => {\n  switch (status) {\n    case \"APPROVED\":\n      return \"bg-yellow-200 text-yellow-800 py-1 px-3 rounded-full text-xs font-medium\";\n    case \"RECEIVED\":\n      return \"bg-green-200 text-green-800 py-1 px-3 rounded-full text-xs font-medium\";\n    case \"REJECTED\":\n      return \"bg-red-200 text-red-800 py-1 px-3 rounded-full text-xs font-medium\";\n    default:\n      return \"bg-gray-200 text-gray-800 py-1 px-3 rounded-full text-xs font-medium\";\n  }\n};\n\nconst showDetail = (id) => {\n  // Arahkan ke halaman detail (asumsi rute sudah ada)\n  router.push(`/history/purchases/${id}`);\n};\n\n// --- API Calls ---\nconst loadPurchases = async () => {\n  loading.value = true;\n  purchases.value = [];\n  try {\n    const res = await axios.get(`${API_BASE}/history/purchases`, {\n      headers: { Authorization: `Bearer ${token}` },\n      params: {\n        page: page.value,\n        size: size.value,\n        q: searchQuery.value,\n        status: currentStatus.value, // Filter berdasarkan status\n      },\n    });\n    // Data dari HistoryService.Purchases\n    const data = res.data.data.data || [];\n    totalItems.value = res.data.data.total || 0;\n    purchases.value = data;\n  } catch (err) {\n    console.error(\"Error load purchases:\", err.response?.data || err.message);\n    alert(\"Gagal memuat daftar Purchase Order.\");\n  } finally {\n    loading.value = false;\n  }\n};\n\nconst receivePurchase = async (id) => {\n  if (\n    !confirm(\n      `Anda yakin ingin MENERIMA Purchase Order #${id} ini? Stok akan ditambahkan.`\n    )\n  ) {\n    return;\n  }\n\n  loadingStates.value[id] = true;\n  try {\n    // Panggil ENDPOINT BARU untuk Goods Receipt (Role GUDANG)\n    await axios.post(\n      `${API_BASE}/gudang/purchases/${id}/receive`,\n      {},\n      { headers: { Authorization: `Bearer ${token}` } }\n    );\n\n    alert(`Purchase Order #${id} berhasil DITERIMA. Stok telah diperbarui.`);\n\n    // Perbarui data PO di list secara lokal\n    const index = purchases.value.findIndex((p) => p.id === id);\n    if (index !== -1) {\n      // Set status menjadi RECEIVED\n      purchases.value[index].status = \"RECEIVED\";\n    }\n\n    // Muat ulang jika status filter adalah APPROVED (agar PO yang sudah diterima hilang)\n    if (currentStatus.value === \"APPROVED\") {\n      loadPurchases();\n    }\n  } catch (err) {\n    console.error(\n      \"Error receiving purchase:\",\n      err.response?.data || err.message\n    );\n    alert(\n      `Gagal menerima Purchase Order #${id}. Error: ${\n        err.response?.data?.error ||\n        err.response?.data?.message ||\n        \"Terjadi kesalahan.\"\n      }`\n    );\n  } finally {\n    loadingStates.value[id] = false;\n  }\n};\n\nonMounted(() => {\n  loadPurchases();\n});\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}