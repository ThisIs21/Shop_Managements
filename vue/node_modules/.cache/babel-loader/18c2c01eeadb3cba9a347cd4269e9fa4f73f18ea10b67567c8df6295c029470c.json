{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nimport { ref, computed, watch } from \"vue\";\nimport axios from \"axios\";\n\n// State\n\nexport default {\n  __name: 'CashierPage',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const customerName = ref(\"\");\n    const selectedProductId = ref(\"\");\n    const qty = ref(1);\n    const cart = ref([]);\n    const voucherCode = ref(\"\");\n    const voucherMessage = ref(\"\");\n    const discount = ref(0);\n    const paidAmount = ref(0);\n    const products = ref([]); // ini biasanya dari API\n    const vouchers = ref([]); // daftar voucher aktif dari API\n\n    // Subtotal\n    const subtotal = computed(() => cart.value.reduce((sum, item) => sum + item.qty * item.price, 0));\n\n    // Total (subtotal - discount)\n    const total = computed(() => Math.max(0, subtotal.value - discount.value));\n\n    // Change (paid - total)\n    const change = computed(() => Math.max(0, paidAmount.value - total.value));\n\n    // Ambil produk & voucher (mock API)\n    async function fetchData() {\n      try {\n        const resProducts = await axios.get(\"/api/products\");\n        products.value = resProducts.data.data;\n        const resVouchers = await axios.get(\"/api/vouchers\");\n        vouchers.value = resVouchers.data.data;\n      } catch (err) {\n        console.error(\"Gagal fetch data:\", err);\n      }\n    }\n    fetchData();\n\n    // Tambah produk ke keranjang\n    function addToCart() {\n      if (!selectedProductId.value || qty.value < 1) return;\n      const product = products.value.find(p => p.id === selectedProductId.value);\n      if (!product) return;\n\n      // cek stok\n      if (product.stock < qty.value) {\n        alert(`Stok produk ${product.name} tidak cukup!`);\n        return;\n      }\n      cart.value.push({\n        id: product.id,\n        name: product.name,\n        price: product.sellPrice,\n        qty: qty.value\n      });\n      selectedProductId.value = \"\";\n      qty.value = 1;\n    }\n\n    // Hapus item dari cart\n    function removeItem(index) {\n      cart.value.splice(index, 1);\n    }\n\n    // Validasi voucher\n    function validateVoucher() {\n      if (!voucherCode.value) {\n        discount.value = 0;\n        voucherMessage.value = \"Tidak ada voucher\";\n        return;\n      }\n      const v = vouchers.value.find(vc => vc.code === voucherCode.value);\n      if (!v) {\n        discount.value = 0;\n        voucherMessage.value = \"Voucher tidak ditemukan / tidak aktif\";\n        return;\n      }\n      if (v.type === \"percent\") {\n        discount.value = v.value / 100 * subtotal.value;\n        voucherMessage.value = `Diskon ${v.value}% berhasil diterapkan`;\n      } else if (v.type === \"amount\") {\n        discount.value = v.value;\n        voucherMessage.value = `Diskon Rp ${v.value} berhasil diterapkan`;\n      }\n    }\n\n    // Submit transaksi\n    async function submitSale() {\n      if (cart.value.length === 0) {\n        alert(\"Keranjang kosong\");\n        return;\n      }\n      if (paidAmount.value < total.value) {\n        alert(\"Jumlah bayar kurang dari total\");\n        return;\n      }\n      const payload = {\n        customer_name: customerName.value,\n        items: cart.value.map(i => ({\n          product_id: i.id,\n          qty: i.qty\n        })),\n        voucher_code: voucherCode.value || null,\n        paid_amount: paidAmount.value\n      };\n      try {\n        const res = await axios.post(\"/api/sales\", payload);\n        alert(\"Transaksi berhasil! No: \" + res.data.transaction_number);\n\n        // reset form\n        cart.value = [];\n        customerName.value = \"\";\n        voucherCode.value = \"\";\n        discount.value = 0;\n        paidAmount.value = 0;\n        voucherMessage.value = \"\";\n        fetchData(); // refresh stok\n      } catch (err) {\n        console.error(err);\n        alert(\"Gagal menyimpan transaksi\");\n      }\n    }\n    const __returned__ = {\n      customerName,\n      selectedProductId,\n      qty,\n      cart,\n      voucherCode,\n      voucherMessage,\n      discount,\n      paidAmount,\n      products,\n      vouchers,\n      subtotal,\n      total,\n      change,\n      fetchData,\n      addToCart,\n      removeItem,\n      validateVoucher,\n      submitSale,\n      ref,\n      computed,\n      watch,\n      get axios() {\n        return axios;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","watch","axios","customerName","selectedProductId","qty","cart","voucherCode","voucherMessage","discount","paidAmount","products","vouchers","subtotal","value","reduce","sum","item","price","total","Math","max","change","fetchData","resProducts","get","data","resVouchers","err","console","error","addToCart","product","find","p","id","stock","alert","name","push","sellPrice","removeItem","index","splice","validateVoucher","v","vc","code","type","submitSale","length","payload","customer_name","items","map","i","product_id","voucher_code","paid_amount","res","post","transaction_number"],"sources":["C:/Users/Personal/Documents/PKL/aplikasi/aplikasi/src/views/CashierPage.vue"],"sourcesContent":["<template>\n  <div class=\"cashier-page\">\n    <h2>Kasir Penjualan</h2>\n\n    <!-- Input Pelanggan -->\n    <div class=\"form-group\">\n      <label>Nama Pelanggan</label>\n      <input v-model=\"customerName\" placeholder=\"Nama pelanggan\" />\n    </div>\n\n    <!-- Produk -->\n    <div class=\"form-group\">\n      <label>Tambah Produk</label>\n      <select v-model=\"selectedProductId\">\n        <option disabled value=\"\">Pilih Produk</option>\n        <option v-for=\"p in products\" :key=\"p.id\" :value=\"p.id\">\n          {{ p.name }} - Rp {{ p.sellPrice }} (stok: {{ p.stock }})\n        </option>\n      </select>\n      <input type=\"number\" v-model.number=\"qty\" min=\"1\" placeholder=\"Qty\" />\n      <button @click=\"addToCart\">Tambah</button>\n    </div>\n\n    <!-- Keranjang -->\n    <table border=\"1\" cellpadding=\"5\" cellspacing=\"0\">\n      <thead>\n        <tr>\n          <th>Produk</th>\n          <th>Qty</th>\n          <th>Harga</th>\n          <th>Subtotal</th>\n          <th>Aksi</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr v-for=\"(item, index) in cart\" :key=\"index\">\n          <td>{{ item.name }}</td>\n          <td>{{ item.qty }}</td>\n          <td>{{ item.price }}</td>\n          <td>{{ item.qty * item.price }}</td>\n          <td><button @click=\"removeItem(index)\">Hapus</button></td>\n        </tr>\n      </tbody>\n    </table>\n\n    <!-- Voucher -->\n    <div class=\"form-group\">\n      <label>Kode Voucher</label>\n      <input v-model=\"voucherCode\" placeholder=\"Masukkan kode voucher\" />\n      <button @click=\"validateVoucher\">Cek Voucher</button>\n      <p v-if=\"voucherMessage\">{{ voucherMessage }}</p>\n    </div>\n\n    <!-- Totals -->\n    <div class=\"totals\">\n      <p>Subtotal: Rp {{ subtotal }}</p>\n      <p>Diskon: Rp {{ discount }}</p>\n      <p><b>Total: Rp {{ total }}</b></p>\n    </div>\n\n    <!-- Pembayaran -->\n    <div class=\"form-group\">\n      <label>Bayar</label>\n      <input type=\"number\" v-model.number=\"paidAmount\" placeholder=\"Jumlah bayar\" />\n      <p>Kembalian: Rp {{ change }}</p>\n    </div>\n\n    <!-- Submit -->\n    <button @click=\"submitSale\">Bayar & Simpan</button>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, watch } from \"vue\"\nimport axios from \"axios\"\n\n// State\nconst customerName = ref(\"\")\nconst selectedProductId = ref(\"\")\nconst qty = ref(1)\nconst cart = ref([])\n\nconst voucherCode = ref(\"\")\nconst voucherMessage = ref(\"\")\nconst discount = ref(0)\n\nconst paidAmount = ref(0)\nconst products = ref([]) // ini biasanya dari API\nconst vouchers = ref([]) // daftar voucher aktif dari API\n\n// Subtotal\nconst subtotal = computed(() =>\n  cart.value.reduce((sum, item) => sum + item.qty * item.price, 0)\n)\n\n// Total (subtotal - discount)\nconst total = computed(() => Math.max(0, subtotal.value - discount.value))\n\n// Change (paid - total)\nconst change = computed(() => Math.max(0, paidAmount.value - total.value))\n\n// Ambil produk & voucher (mock API)\nasync function fetchData() {\n  try {\n    const resProducts = await axios.get(\"/api/products\")\n    products.value = resProducts.data.data\n\n    const resVouchers = await axios.get(\"/api/vouchers\")\n    vouchers.value = resVouchers.data.data\n  } catch (err) {\n    console.error(\"Gagal fetch data:\", err)\n  }\n}\nfetchData()\n\n// Tambah produk ke keranjang\nfunction addToCart() {\n  if (!selectedProductId.value || qty.value < 1) return\n\n  const product = products.value.find(p => p.id === selectedProductId.value)\n  if (!product) return\n\n  // cek stok\n  if (product.stock < qty.value) {\n    alert(`Stok produk ${product.name} tidak cukup!`)\n    return\n  }\n\n  cart.value.push({\n    id: product.id,\n    name: product.name,\n    price: product.sellPrice,\n    qty: qty.value,\n  })\n\n  selectedProductId.value = \"\"\n  qty.value = 1\n}\n\n// Hapus item dari cart\nfunction removeItem(index) {\n  cart.value.splice(index, 1)\n}\n\n// Validasi voucher\nfunction validateVoucher() {\n  if (!voucherCode.value) {\n    discount.value = 0\n    voucherMessage.value = \"Tidak ada voucher\"\n    return\n  }\n\n  const v = vouchers.value.find(vc => vc.code === voucherCode.value)\n  if (!v) {\n    discount.value = 0\n    voucherMessage.value = \"Voucher tidak ditemukan / tidak aktif\"\n    return\n  }\n\n  if (v.type === \"percent\") {\n    discount.value = (v.value / 100) * subtotal.value\n    voucherMessage.value = `Diskon ${v.value}% berhasil diterapkan`\n  } else if (v.type === \"amount\") {\n    discount.value = v.value\n    voucherMessage.value = `Diskon Rp ${v.value} berhasil diterapkan`\n  }\n}\n\n// Submit transaksi\nasync function submitSale() {\n  if (cart.value.length === 0) {\n    alert(\"Keranjang kosong\")\n    return\n  }\n\n  if (paidAmount.value < total.value) {\n    alert(\"Jumlah bayar kurang dari total\")\n    return\n  }\n\n  const payload = {\n    customer_name: customerName.value,\n    items: cart.value.map(i => ({\n      product_id: i.id,\n      qty: i.qty,\n    })),\n    voucher_code: voucherCode.value || null,\n    paid_amount: paidAmount.value,\n  }\n\n  try {\n    const res = await axios.post(\"/api/sales\", payload)\n    alert(\"Transaksi berhasil! No: \" + res.data.transaction_number)\n\n    // reset form\n    cart.value = []\n    customerName.value = \"\"\n    voucherCode.value = \"\"\n    discount.value = 0\n    paidAmount.value = 0\n    voucherMessage.value = \"\"\n    fetchData() // refresh stok\n  } catch (err) {\n    console.error(err)\n    alert(\"Gagal menyimpan transaksi\")\n  }\n}\n</script>\n\n<style scoped>\n.cashier-page {\n  max-width: 700px;\n  margin: auto;\n  padding: 20px;\n}\n.form-group {\n  margin-bottom: 15px;\n}\ntable {\n  width: 100%;\n  margin: 10px 0;\n}\n.totals {\n  margin-top: 15px;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}