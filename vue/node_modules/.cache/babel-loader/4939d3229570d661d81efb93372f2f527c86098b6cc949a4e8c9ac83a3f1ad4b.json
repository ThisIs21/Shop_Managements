{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nimport { ref, computed } from \"vue\";\nimport axios from \"axios\";\n\n// Import sidebar yang sudah ada tanpa mengubahnya\nimport OwnerSidebar from \"../components/OwnerSidebar.vue\";\nexport default {\n  __name: 'PurchaseSummaryReportOwners',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const fromDate = ref(\"\");\n    const toDate = ref(\"\");\n    const reportData = ref([]);\n    const grandTotal = computed(() => {\n      return reportData.value.reduce((sum, item) => sum + (item.total || 0), 0);\n    });\n    const formatDate = dateStr => {\n      if (!dateStr) return \"-\"; // Tangani jika dateStr kosong atau null\n      const date = new Date(dateStr);\n      return isNaN(date) ? \"-\" : date.toLocaleDateString(\"id-ID\");\n    };\n    const formatCurrency = value => {\n      return new Intl.NumberFormat(\"id-ID\", {\n        style: \"currency\",\n        currency: \"IDR\"\n      }).format(value || 0);\n    };\n    const fetchReport = async () => {\n      try {\n        // Siapkan parameter untuk filter tanggal\n        const params = {};\n        if (fromDate.value) params.from = fromDate.value;\n        if (toDate.value) params.to = toDate.value;\n\n        // Panggil API dengan parameter\n        const response = await axios.get(\"http://localhost:8081/api/v1/history/purchases\", {\n          headers: {\n            Authorization: `Bearer ${localStorage.getItem(\"token\")}`\n          },\n          params\n        });\n\n        // Debug: cetak data mentah dari backend\n        console.log(\"Data mentah dari backend:\", JSON.stringify(response.data, null, 2));\n\n        // Mapping data ke format tabel frontend\n        reportData.value = response.data.map(purchase => purchase.items?.map(it => ({\n          date: purchase.date || purchase.tanggal || \"\",\n          customer_name: purchase.supplier?.nama || purchase.supplier?.name || \"-\",\n          product_name: it.product?.nama_barang || it.product?.name || it.product_name || \"-\",\n          quantity: it.qty || it.quantity || 0,\n          price: it.harga || it.price || 0,\n          total: it.subtotal || it.total || 0\n        })) || []).flat();\n\n        // Debug: cek data setelah mapping\n        console.log(\"Data setelah mapping:\", reportData.value);\n\n        // Kalau data masih kosong, beri peringatan\n        if (reportData.value.length === 0) {\n          console.warn(\"Data kosong setelah mapping. Cek struktur JSON dari backend dan sesuaikan mapping.\");\n        }\n      } catch (error) {\n        console.error(\"Gagal mengambil data laporan:\", error);\n        alert(\"Gagal mengambil data laporan\");\n      }\n    };\n    const printReport = () => {\n      const printContents = document.createElement(\"div\");\n      printContents.innerHTML = document.querySelector(\"table\").outerHTML;\n      const newWindow = window.open(\"\", \"\", \"width=900,height=600\");\n      newWindow.document.write(`\n    <html>\n      <head>\n        <title>Purchase Report</title>\n        <style>\n          table { width: 100%; border-collapse: collapse; }\n          th, td { border: 1px solid #333; padding: 8px; text-align: left; }\n          th { background-color: #eee; }\n        </style>\n      </head>\n      <body>\n        <h1>Purchase Summary Report</h1>\n        ${printContents.innerHTML}\n      </body>\n    </html>\n  `);\n      newWindow.document.close();\n      newWindow.print();\n    };\n    const __returned__ = {\n      fromDate,\n      toDate,\n      reportData,\n      grandTotal,\n      formatDate,\n      formatCurrency,\n      fetchReport,\n      printReport,\n      ref,\n      computed,\n      get axios() {\n        return axios;\n      },\n      OwnerSidebar\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","axios","OwnerSidebar","fromDate","toDate","reportData","grandTotal","value","reduce","sum","item","total","formatDate","dateStr","date","Date","isNaN","toLocaleDateString","formatCurrency","Intl","NumberFormat","style","currency","format","fetchReport","params","from","to","response","get","headers","Authorization","localStorage","getItem","console","log","JSON","stringify","data","map","purchase","items","it","tanggal","customer_name","supplier","nama","name","product_name","product","nama_barang","quantity","qty","price","harga","subtotal","flat","length","warn","error","alert","printReport","printContents","document","createElement","innerHTML","querySelector","outerHTML","newWindow","window","open","write","close","print"],"sources":["C:/Users/Personal/Documents/PKL/aplikasi/aplikasi/src/views/PurchaseSummaryReportOwners.vue"],"sourcesContent":["<template>\n  <div class=\"flex\">\n    <!-- Sidebar tetap utuh -->\n    <OwnerSidebar />\n\n    <!-- Konten utama -->\n    <div class=\"flex-1 p-4\">\n      <h1 class=\"text-2xl font-bold mb-4\">Purchase Summary Report</h1>\n\n      <!-- Filter tanggal -->\n      <div class=\"mb-4 flex gap-2 items-center\">\n        <label>From:</label>\n        <input type=\"date\" v-model=\"fromDate\" class=\"border p-1 rounded\" />\n        <label>To:</label>\n        <input type=\"date\" v-model=\"toDate\" class=\"border p-1 rounded\" />\n        <button\n          @click=\"fetchReport\"\n          class=\"bg-blue-500 text-white px-4 py-1 rounded\"\n        >\n          Filter\n        </button>\n        <button\n          @click=\"printReport\"\n          class=\"bg-green-500 text-white px-4 py-1 rounded\"\n        >\n          Print PDF\n        </button>\n      </div>\n\n      <!-- Tabel laporan -->\n      <div ref=\"reportContent\">\n        <table class=\"w-full border-collapse border border-gray-300\">\n          <thead>\n            <tr class=\"bg-gray-200\">\n              <th class=\"border border-gray-300 p-2\">#</th>\n              <th class=\"border border-gray-300 p-2\">Date</th>\n              <th class=\"border border-gray-300 p-2\">Customer</th>\n              <th class=\"border border-gray-300 p-2\">Product</th>\n              <th class=\"border border-gray-300 p-2\">Quantity</th>\n              <th class=\"border border-gray-300 p-2\">Price</th>\n              <th class=\"border border-gray-300 p-2\">Total</th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr v-for=\"(item, index) in reportData\" :key=\"index\">\n              <td class=\"border border-gray-300 p-2\">{{ index + 1 }}</td>\n              <td class=\"border border-gray-300 p-2\">\n                {{ formatDate(item.date) }}\n              </td>\n              <td class=\"border border-gray-300 p-2\">\n                {{ item.customer_name }}\n              </td>\n              <td class=\"border border-gray-300 p-2\">\n                {{ item.product_name }}\n              </td>\n              <td class=\"border border-gray-300 p-2\">{{ item.quantity }}</td>\n              <td class=\"border border-gray-300 p-2\">\n                {{ formatCurrency(item.price) }}\n              </td>\n              <td class=\"border border-gray-300 p-2\">\n                {{ formatCurrency(item.total) }}\n              </td>\n            </tr>\n            <tr>\n              <td\n                colspan=\"6\"\n                class=\"border border-gray-300 p-2 font-bold text-right\"\n              >\n                Grand Total\n              </td>\n              <td class=\"border border-gray-300 p-2 font-bold\">\n                {{ formatCurrency(grandTotal) }}\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed } from \"vue\";\nimport axios from \"axios\";\n\n// Import sidebar yang sudah ada tanpa mengubahnya\nimport OwnerSidebar from \"../components/OwnerSidebar.vue\";\n\nconst fromDate = ref(\"\");\nconst toDate = ref(\"\");\nconst reportData = ref([]);\n\nconst grandTotal = computed(() => {\n  return reportData.value.reduce((sum, item) => sum + (item.total || 0), 0);\n});\n\nconst formatDate = (dateStr) => {\n  if (!dateStr) return \"-\"; // Tangani jika dateStr kosong atau null\n  const date = new Date(dateStr);\n  return isNaN(date) ? \"-\" : date.toLocaleDateString(\"id-ID\");\n};\n\nconst formatCurrency = (value) => {\n  return new Intl.NumberFormat(\"id-ID\", {\n    style: \"currency\",\n    currency: \"IDR\",\n  }).format(value || 0);\n};\n\nconst fetchReport = async () => {\n  try {\n    // Siapkan parameter untuk filter tanggal\n    const params = {};\n    if (fromDate.value) params.from = fromDate.value;\n    if (toDate.value) params.to = toDate.value;\n\n    // Panggil API dengan parameter\n    const response = await axios.get(\n      \"http://localhost:8081/api/v1/history/purchases\",\n      {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\n        },\n        params,\n      }\n    );\n\n    // Debug: cetak data mentah dari backend\n    console.log(\"Data mentah dari backend:\", JSON.stringify(response.data, null, 2));\n\n    // Mapping data ke format tabel frontend\n    reportData.value = response.data\n      .map((purchase) =>\n        purchase.items?.map((it) => ({\n          date: purchase.date || purchase.tanggal || \"\",\n          customer_name: purchase.supplier?.nama || purchase.supplier?.name || \"-\",\n          product_name: it.product?.nama_barang || it.product?.name || it.product_name || \"-\",\n          quantity: it.qty || it.quantity || 0,\n          price: it.harga || it.price || 0,\n          total: it.subtotal || it.total || 0,\n        })) || []\n      )\n      .flat();\n\n    // Debug: cek data setelah mapping\n    console.log(\"Data setelah mapping:\", reportData.value);\n\n    // Kalau data masih kosong, beri peringatan\n    if (reportData.value.length === 0) {\n      console.warn(\"Data kosong setelah mapping. Cek struktur JSON dari backend dan sesuaikan mapping.\");\n    }\n  } catch (error) {\n    console.error(\"Gagal mengambil data laporan:\", error);\n    alert(\"Gagal mengambil data laporan\");\n  }\n};\n\nconst printReport = () => {\n  const printContents = document.createElement(\"div\");\n  printContents.innerHTML = document.querySelector(\"table\").outerHTML;\n  const newWindow = window.open(\"\", \"\", \"width=900,height=600\");\n  newWindow.document.write(`\n    <html>\n      <head>\n        <title>Purchase Report</title>\n        <style>\n          table { width: 100%; border-collapse: collapse; }\n          th, td { border: 1px solid #333; padding: 8px; text-align: left; }\n          th { background-color: #eee; }\n        </style>\n      </head>\n      <body>\n        <h1>Purchase Summary Report</h1>\n        ${printContents.innerHTML}\n      </body>\n    </html>\n  `);\n  newWindow.document.close();\n  newWindow.print();\n};\n</script>\n\n<style scoped>\n/* Styling opsional */\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}