{"ast":null,"code":"import { createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, vModelText as _vModelText, withDirectives as _withDirectives, renderList as _renderList, Fragment as _Fragment, normalizeClass as _normalizeClass, withCtx as _withCtx, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"p-4\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4\",\n  role: \"alert\"\n};\nconst _hoisted_3 = {\n  class: \"block sm:inline\"\n};\nconst _hoisted_4 = {\n  class: \"flex flex-wrap gap-4 mb-6 items-end\"\n};\nconst _hoisted_5 = {\n  class: \"flex flex-col\"\n};\nconst _hoisted_6 = {\n  class: \"flex flex-col\"\n};\nconst _hoisted_7 = [\"disabled\"];\nconst _hoisted_8 = [\"disabled\"];\nconst _hoisted_9 = {\n  key: 1,\n  class: \"text-center py-8\"\n};\nconst _hoisted_10 = {\n  key: 2,\n  class: \"w-full border-collapse border border-gray-300 shadow-md\"\n};\nconst _hoisted_11 = {\n  class: \"border border-gray-300 px-4 py-2 text-sm\"\n};\nconst _hoisted_12 = {\n  class: \"border border-gray-300 px-4 py-2 text-sm\"\n};\nconst _hoisted_13 = {\n  class: \"border border-gray-300 px-4 py-2 text-right text-sm\"\n};\nconst _hoisted_14 = {\n  class: \"border border-gray-300 px-4 py-2 text-right text-sm\"\n};\nconst _hoisted_15 = {\n  key: 0\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createBlock($setup[\"OwnerLayout\"], null, {\n    default: _withCtx(() => [_createElementVNode(\"div\", _hoisted_1, [_cache[7] || (_cache[7] = _createElementVNode(\"h1\", {\n      class: \"text-2xl font-bold mb-4\"\n    }, \"Laporan Stok Opname\", -1 /* CACHED */)), $setup.errorMessage ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [_createElementVNode(\"span\", _hoisted_3, _toDisplayString($setup.errorMessage), 1 /* TEXT */)])) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"label\", _hoisted_5, [_cache[2] || (_cache[2] = _createElementVNode(\"span\", {\n      class: \"text-sm font-medium mb-1\"\n    }, \"Dari Tanggal\", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"input\", {\n      type: \"date\",\n      \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.filters.startDate = $event),\n      class: \"border p-2 rounded w-40\"\n    }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.filters.startDate]])]), _createElementVNode(\"label\", _hoisted_6, [_cache[3] || (_cache[3] = _createElementVNode(\"span\", {\n      class: \"text-sm font-medium mb-1\"\n    }, \"Sampai Tanggal\", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"input\", {\n      type: \"date\",\n      \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $setup.filters.endDate = $event),\n      class: \"border p-2 rounded w-40\"\n    }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.filters.endDate]])]), _createElementVNode(\"button\", {\n      onClick: $setup.applyFilter,\n      class: \"h-10 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 font-semibold\",\n      disabled: $setup.loading\n    }, \" Terapkan Filter \", 8 /* PROPS */, _hoisted_7), _createElementVNode(\"button\", {\n      onClick: $setup.resetFilter,\n      class: \"h-10 px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 font-semibold\",\n      disabled: $setup.loading\n    }, \" Reset \", 8 /* PROPS */, _hoisted_8)]), $setup.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_9, [...(_cache[4] || (_cache[4] = [_createElementVNode(\"svg\", {\n      class: \"animate-spin h-6 w-6 text-blue-600 mx-auto\",\n      xmlns: \"http://www.w3.org/2000/svg\",\n      fill: \"none\",\n      viewBox: \"0 0 24 24\"\n    }, [_createElementVNode(\"circle\", {\n      class: \"opacity-25\",\n      cx: \"12\",\n      cy: \"12\",\n      r: \"10\",\n      stroke: \"currentColor\",\n      \"stroke-width\": \"4\"\n    }), _createElementVNode(\"path\", {\n      class: \"opacity-75\",\n      fill: \"currentColor\",\n      d: \"M4 12a8 8 0 018-8v8H4z\"\n    })], -1 /* CACHED */), _createElementVNode(\"p\", {\n      class: \"mt-2 text-gray-600\"\n    }, \"Memuat data...\", -1 /* CACHED */)]))])) : (_openBlock(), _createElementBlock(\"table\", _hoisted_10, [_cache[6] || (_cache[6] = _createElementVNode(\"thead\", null, [_createElementVNode(\"tr\", {\n      class: \"bg-gray-100\"\n    }, [_createElementVNode(\"th\", {\n      class: \"border border-gray-300 px-4 py-3 text-left w-[150px]\"\n    }, \" Tanggal Opname \"), _createElementVNode(\"th\", {\n      class: \"border border-gray-300 px-4 py-3 text-left\"\n    }, \" Nama Barang \"), _createElementVNode(\"th\", {\n      class: \"border border-gray-300 px-4 py-3 text-right w-[150px]\"\n    }, \" Stok Sistem \"), _createElementVNode(\"th\", {\n      class: \"border border-gray-300 px-4 py-3 text-right w-[150px]\"\n    }, \" Stok Fisik \"), _createElementVNode(\"th\", {\n      class: \"border border-gray-300 px-4 py-3 text-right w-[150px]\"\n    }, \" Selisih \")])], -1 /* CACHED */)), _createElementVNode(\"tbody\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.filteredData, (item, index) => {\n      return _openBlock(), _createElementBlock(\"tr\", {\n        key: index\n      }, [_createElementVNode(\"td\", _hoisted_11, _toDisplayString(item.date), 1 /* TEXT */), _createElementVNode(\"td\", _hoisted_12, _toDisplayString(item.book_name) + \" (\" + _toDisplayString(item.product_code) + \") \", 1 /* TEXT */), _createElementVNode(\"td\", _hoisted_13, _toDisplayString(item.system_stock), 1 /* TEXT */), _createElementVNode(\"td\", _hoisted_14, _toDisplayString(item.physical_stock), 1 /* TEXT */), _createElementVNode(\"td\", {\n        class: _normalizeClass([\"border border-gray-300 px-4 py-2 text-right text-sm font-semibold\", {\n          'text-red-600': item.difference < 0,\n          'text-green-600': item.difference > 0\n        }])\n      }, _toDisplayString(item.difference), 3 /* TEXT, CLASS */)]);\n    }), 128 /* KEYED_FRAGMENT */)), $setup.filteredData.length === 0 ? (_openBlock(), _createElementBlock(\"tr\", _hoisted_15, [...(_cache[5] || (_cache[5] = [_createElementVNode(\"td\", {\n      colspan: \"5\",\n      class: \"text-center py-6 text-gray-500 text-base\"\n    }, \" Tidak ada data Stok Opname dalam periode ini. \", -1 /* CACHED */)]))])) : _createCommentVNode(\"v-if\", true)])]))])]),\n    _: 1 /* STABLE */\n  });\n}","map":{"version":3,"names":["class","role","_createBlock","$setup","_createElementVNode","_hoisted_1","errorMessage","_createElementBlock","_hoisted_2","_hoisted_3","_toDisplayString","_hoisted_4","_hoisted_5","type","filters","startDate","$event","_hoisted_6","endDate","onClick","applyFilter","disabled","loading","_hoisted_7","resetFilter","_hoisted_8","_hoisted_9","_cache","xmlns","fill","viewBox","cx","cy","r","stroke","d","_hoisted_10","_Fragment","_renderList","filteredData","item","index","key","_hoisted_11","date","_hoisted_12","book_name","product_code","_hoisted_13","system_stock","_hoisted_14","physical_stock","_normalizeClass","difference","length","_hoisted_15","colspan"],"sources":["C:\\Users\\Personal\\Documents\\PKL\\aplikasi\\aplikasi\\src\\views\\ReportStockOpnameOwners.vue"],"sourcesContent":["<template>\n  <OwnerLayout>\n    <div class=\"p-4\">\n      <h1 class=\"text-2xl font-bold mb-4\">Laporan Stok Opname</h1>\n\n      <div\n        v-if=\"errorMessage\"\n        class=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4\"\n        role=\"alert\"\n      >\n        <span class=\"block sm:inline\">{{ errorMessage }}</span>\n      </div>\n\n      <div class=\"flex flex-wrap gap-4 mb-6 items-end\">\n        <label class=\"flex flex-col\">\n          <span class=\"text-sm font-medium mb-1\">Dari Tanggal</span>\n          <input\n            type=\"date\"\n            v-model=\"filters.startDate\"\n            class=\"border p-2 rounded w-40\"\n          />\n        </label>\n        <label class=\"flex flex-col\">\n          <span class=\"text-sm font-medium mb-1\">Sampai Tanggal</span>\n          <input\n            type=\"date\"\n            v-model=\"filters.endDate\"\n            class=\"border p-2 rounded w-40\"\n          />\n        </label>\n        <button\n          @click=\"applyFilter\"\n          class=\"h-10 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 font-semibold\"\n          :disabled=\"loading\"\n        >\n          Terapkan Filter\n        </button>\n        <button\n          @click=\"resetFilter\"\n          class=\"h-10 px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 font-semibold\"\n          :disabled=\"loading\"\n        >\n          Reset\n        </button>\n      </div>\n\n      <div v-if=\"loading\" class=\"text-center py-8\">\n        <svg\n          class=\"animate-spin h-6 w-6 text-blue-600 mx-auto\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n          fill=\"none\"\n          viewBox=\"0 0 24 24\"\n        >\n          <circle\n            class=\"opacity-25\"\n            cx=\"12\"\n            cy=\"12\"\n            r=\"10\"\n            stroke=\"currentColor\"\n            stroke-width=\"4\"\n          ></circle>\n          <path\n            class=\"opacity-75\"\n            fill=\"currentColor\"\n            d=\"M4 12a8 8 0 018-8v8H4z\"\n          ></path>\n        </svg>\n        <p class=\"mt-2 text-gray-600\">Memuat data...</p>\n      </div>\n\n      <table\n        v-else\n        class=\"w-full border-collapse border border-gray-300 shadow-md\"\n      >\n        <thead>\n          <tr class=\"bg-gray-100\">\n            <th class=\"border border-gray-300 px-4 py-3 text-left w-[150px]\">\n              Tanggal Opname\n            </th>\n            <th class=\"border border-gray-300 px-4 py-3 text-left\">\n              Nama Barang\n            </th>\n            <th class=\"border border-gray-300 px-4 py-3 text-right w-[150px]\">\n              Stok Sistem\n            </th>\n            <th class=\"border border-gray-300 px-4 py-3 text-right w-[150px]\">\n              Stok Fisik\n            </th>\n            <th class=\"border border-gray-300 px-4 py-3 text-right w-[150px]\">\n              Selisih\n            </th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr v-for=\"(item, index) in filteredData\" :key=\"index\">\n            <td class=\"border border-gray-300 px-4 py-2 text-sm\">\n              {{ item.date }}\n            </td>\n            <td class=\"border border-gray-300 px-4 py-2 text-sm\">\n              {{ item.book_name }} ({{ item.product_code }})\n            </td>\n            <td class=\"border border-gray-300 px-4 py-2 text-right text-sm\">\n              {{ item.system_stock }}\n            </td>\n            <td class=\"border border-gray-300 px-4 py-2 text-right text-sm\">\n              {{ item.physical_stock }}\n            </td>\n            <td\n              class=\"border border-gray-300 px-4 py-2 text-right text-sm font-semibold\"\n              :class=\"{\n                'text-red-600': item.difference < 0,\n                'text-green-600': item.difference > 0,\n              }\"\n            >\n              {{ item.difference }}\n            </td>\n          </tr>\n          <tr v-if=\"filteredData.length === 0\">\n            <td colspan=\"5\" class=\"text-center py-6 text-gray-500 text-base\">\n              Tidak ada data Stok Opname dalam periode ini.\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </OwnerLayout>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted } from \"vue\";\nimport axios from \"axios\";\nimport OwnerLayout from \"../components/OwnerLayouts.vue\";\n\n// ... (kode filters dan ref tetap sama) ...\nconst filters = ref({\n  startDate: \"\",\n  endDate: \"\",\n});\nconst rawData = ref([]);\nconst flattenedData = ref([]);\nconst loading = ref(false);\nconst errorMessage = ref(\"\");\nconst token = localStorage.getItem(\"token\");\n\n/**\n * PENTING: Endpoint ini HANYA mengembalikan ringkasan (period & count).\n * Data detail per barang (system_stock, physical_stock) TIDAK akan terisi \n * karena endpoint backend hanya mengembalikan ringkasan (GenerateReport).\n *\n * Di sini kita coba memformat data ringkasan tersebut agar terlihat di tabel.\n */\nconst flattenReportData = (apiResponse) => {\n    // API ini mengembalikan array map[string]any dengan kunci 'period' dan 'opname' (Count)\n    // Lihat reportH.StockOpnameSummary di backend\n    return apiResponse.map((item) => {\n        const period = item.period || \"N/A\";\n        const opnameCount = item.opname || 0; \n        \n        // Kita tidak mendapatkan detail produk dan stok dari endpoint ini. \n        // Kita hanya bisa menampilkan ringkasan per tanggal opname.\n        return {\n            date: period,\n            book_name: `Total Opname: ${opnameCount}`, // Pesan untuk menunjukkan ini ringkasan\n            product_code: \"-\",\n            system_stock: \"-\", // Data tidak tersedia\n            physical_stock: \"-\", // Data tidak tersedia\n            difference: \"-\", // Data tidak tersedia\n        };\n    });\n};\n\n// Ambil data dari backend\nconst fetchData = async () => {\n  loading.value = true;\n  errorMessage.value = \"\";\n  try {\n    if (!token) {\n      errorMessage.value = \"Token autentikasi tidak ditemukan. Silakan login kembali.\";\n      return;\n    }\n\n    // ✅ FIX ENDPOINT: Mengikuti rute owner.GET(\"/reports\", reportH.GenerateReport)\n    let url = \"http://localhost:8081/api/v1/owner/reports?type=stock-opnames\"; \n\n    // Tambahkan filter tanggal jika ada\n    if (filters.value.startDate && filters.value.endDate) {\n        url += `&from=${filters.value.startDate}&to=${filters.value.endDate}`;\n    }\n\n    const res = await axios.get(url, {\n      headers: { Authorization: `Bearer ${token}` },\n    });\n\n    rawData.value = res.data.data || [];\n    flattenedData.value = flattenReportData(rawData.value);\n    \n    // Reset error jika berhasil\n    errorMessage.value = \"\"; \n    \n  } catch (err) {\n    console.error(\"Gagal ambil data laporan:\", err.response || err);\n    if (err.response && err.response.status === 404) {\n        errorMessage.value = \"Endpoint Laporan tidak ditemukan (404). Periksa router backend Go Anda.\";\n    } else if (err.response && err.response.status === 401) {\n        errorMessage.value = \"Sesi Anda telah berakhir. Silakan login kembali.\";\n    } else {\n        errorMessage.value = \"Gagal terhubung atau mendapatkan data laporan.\";\n    }\n  } finally {\n    loading.value = false;\n  }\n};\n\nonMounted(fetchData);\n\n// Logika filter tetap sama, tapi sekarang memicu fetchData\nfunction applyFilter() {\n  if (!filters.value.startDate || !filters.value.endDate) {\n      errorMessage.value = \"Harap masukkan kedua tanggal (Dari dan Sampai) untuk memfilter.\";\n      return;\n  }\n  fetchData();\n}\n\nfunction resetFilter() {\n    filters.value.startDate = \"\";\n    filters.value.endDate = \"\";\n    errorMessage.value = \"\";\n    fetchData(); // Muat ulang data tanpa filter\n}\n\nconst filteredData = computed(() => flattenedData.value); \n// Karena filter tanggal sudah dikerjakan di backend, kita hanya tampilkan flattenedData\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}