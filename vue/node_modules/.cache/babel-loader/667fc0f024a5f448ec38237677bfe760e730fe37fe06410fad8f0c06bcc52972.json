{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nimport \"core-js/modules/es.iterator.some.js\";\nimport { ref, onMounted, computed, nextTick } from 'vue';\nimport { useRouter } from 'vue-router';\nimport axios from 'axios';\nimport CashierLayouts from '@/components/CashierLayouts.vue'; // Pastikan ini sync atau handle async\n\nexport default {\n  __name: 'PurchaseReturn',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const router = useRouter();\n\n    /* API Config (sama) */\n    // ... (salin dari sebelumnya, termasuk ENDPOINTS, api, interceptor)\n\n    const purchases = ref([]); // Pastikan array kosong\n    const loadingPurchases = ref(false);\n    const fromDate = ref('');\n    const toDate = ref('');\n    const currentPagePurchases = ref(1);\n    const totalPurchases = ref(0);\n    const purchaseReturns = ref([]);\n    const loadingReturns = ref(false);\n    const returnFromDate = ref('');\n    const returnToDate = ref('');\n    const returnStatusFilter = ref('');\n    const currentPageReturns = ref(1);\n    const totalReturns = ref(0);\n    const totalPagesReturns = computed(() => Math.ceil(totalReturns.value / 10));\n\n    /* Modal */\n    const showModal = ref(false);\n    const selectedPurchase = ref(null);\n    const returnForm = ref({\n      items: []\n    });\n    const returnNotes = ref('');\n    const submitting = ref(false);\n\n    /* Toast (sama) */\n    const toast = ref({\n      message: '',\n      type: 'success'\n    });\n    const showToast = (message, type = 'success') => {\n      toast.value = {\n        message,\n        type\n      };\n      setTimeout(() => {\n        toast.value.message = '';\n      }, 3000);\n    };\n\n    /* Computed */\n    const safePurchasesLength = computed(() => Array.isArray(purchases.value) ? purchases.value.length : 0);\n    const isFormValid = computed(() => {\n      return Array.isArray(returnForm.value.items) && returnForm.value.items.some(item => (item.qty || 0) > 0 && (item.reason || '').trim().length >= 10);\n    });\n    const totalReturnAmount = computed(() => {\n      return Array.isArray(returnForm.value.items) ? returnForm.value.items.reduce((sum, item) => sum + (item.subtotal || 0), 0) : 0;\n    });\n\n    /* Utilities (sama, tambah null check di formatDate) */\n    const formatDate = dateStr => {\n      if (!dateStr) return 'N/A';\n      const date = new Date(dateStr);\n      return isNaN(date.getTime()) ? 'Invalid Date' : date.toLocaleDateString('id-ID', {\n        day: '2-digit',\n        month: 'short',\n        year: 'numeric'\n      });\n    };\n    // ... (salin getStatusClass, dll.)\n\n    /* API Calls dengan try-catch ekstra */\n    const fetchPurchases = async (page = 1) => {\n      loadingPurchases.value = true;\n      try {\n        const params = {\n          page,\n          size: 10,\n          status: 'APPROVED'\n        };\n        if (fromDate.value) params.from = fromDate.value;\n        if (toDate.value) params.to = toDate.value;\n        const res = await api.get(ENDPOINTS.PURCHASES, {\n          params\n        });\n        console.log('Fetch PO response:', res.data); // Debug log\n        const data = res.data?.data || res.data || [];\n        purchases.value = Array.isArray(data) ? data : [];\n        totalPurchases.value = res.data?.total || data.length;\n        showToast('Daftar PO dimuat berhasil!');\n      } catch (err) {\n        console.error('Error fetching purchases:', err);\n        showToast(`Gagal memuat PO: ${err.response?.data?.error || err.message}`, 'error');\n        purchases.value = []; // Reset ke empty\n      } finally {\n        loadingPurchases.value = false;\n      }\n    };\n\n    // ... (salin fetchPurchaseReturns, openReturnModal dengan console.log di try)\n\n    const openReturnModal = async purchaseId => {\n      if (!purchaseId) {\n        showToast('ID PO tidak valid!', 'error');\n        return;\n      }\n      try {\n        const res = await api.get(`${ENDPOINTS.PURCHASE_DETAIL}/${purchaseId}`);\n        console.log('PO detail:', res.data); // Debug\n        selectedPurchase.value = res.data?.data || res.data || null;\n        if (!selectedPurchase.value) {\n          throw new Error('Data PO kosong');\n        }\n        const items = selectedPurchase.value.Items || [];\n        returnForm.value.items = Array.isArray(items) ? items.map(item => ({\n          product_id: item.ProductID || item.product_id || item.Product?.id,\n          product_name: item.Product?.name || 'N/A',\n          original_qty: item.Qty || 0,\n          qty: 0,\n          price: item.Price || 0,\n          reason: '',\n          subtotal: 0\n        })) : [];\n        returnNotes.value = '';\n        showModal.value = true;\n        await nextTick();\n      } catch (err) {\n        console.error('Error loading PO detail:', err);\n        showToast(`Gagal memuat detail PO: ${err.response?.data?.error || err.message}`, 'error');\n      }\n    };\n\n    // ... (salin submitReturn, closeModal, dll. dengan null checks)\n\n    onMounted(async () => {\n      try {\n        await fetchPurchases();\n        await fetchPurchaseReturns();\n      } catch (err) {\n        console.error('Mount error:', err);\n        showToast('Gagal inisialisasi halaman', 'error');\n      }\n    });\n    const __returned__ = {\n      router,\n      purchases,\n      loadingPurchases,\n      fromDate,\n      toDate,\n      currentPagePurchases,\n      totalPurchases,\n      purchaseReturns,\n      loadingReturns,\n      returnFromDate,\n      returnToDate,\n      returnStatusFilter,\n      currentPageReturns,\n      totalReturns,\n      totalPagesReturns,\n      showModal,\n      selectedPurchase,\n      returnForm,\n      returnNotes,\n      submitting,\n      toast,\n      showToast,\n      safePurchasesLength,\n      isFormValid,\n      totalReturnAmount,\n      formatDate,\n      fetchPurchases,\n      openReturnModal,\n      ref,\n      onMounted,\n      computed,\n      nextTick,\n      get useRouter() {\n        return useRouter;\n      },\n      get axios() {\n        return axios;\n      },\n      CashierLayouts\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","computed","nextTick","useRouter","axios","CashierLayouts","router","purchases","loadingPurchases","fromDate","toDate","currentPagePurchases","totalPurchases","purchaseReturns","loadingReturns","returnFromDate","returnToDate","returnStatusFilter","currentPageReturns","totalReturns","totalPagesReturns","Math","ceil","value","showModal","selectedPurchase","returnForm","items","returnNotes","submitting","toast","message","type","showToast","setTimeout","safePurchasesLength","Array","isArray","length","isFormValid","some","item","qty","reason","trim","totalReturnAmount","reduce","sum","subtotal","formatDate","dateStr","date","Date","isNaN","getTime","toLocaleDateString","day","month","year","fetchPurchases","page","params","size","status","from","to","res","api","get","ENDPOINTS","PURCHASES","console","log","data","total","err","error","response","openReturnModal","purchaseId","PURCHASE_DETAIL","Error","Items","map","product_id","ProductID","Product","id","product_name","name","original_qty","Qty","price","Price","fetchPurchaseReturns"],"sources":["C:/Users/Personal/Documents/PKL/aplikasi/aplikasi/src/views/PurchaseReturn.vue"],"sourcesContent":["<template>\n  <CashierLayouts>\n    <Suspense>\n      <template #default>\n        <div class=\"space-y-6\">\n          <!-- Header (sama seperti sebelumnya, tapi wrap di v-if data ready) -->\n          <div v-if=\"!loadingPurchases && !loadingReturns\" class=\"flex flex-wrap justify-between items-center gap-3 p-4 bg-white rounded-lg shadow-sm\">\n            <div>\n              <h1 class=\"text-[#111418] tracking-tight text-3xl font-bold leading-tight\">\n                Retur Pembelian\n              </h1>\n              <p class=\"text-gray-600 mt-1\">Kelola retur untuk pembelian yang sudah disetujui. Pilih PO, tentukan item retur, dan tambahkan alasan.</p>\n            </div>\n            <div class=\"flex gap-2\">\n              <button\n                @click=\"fetchPurchases\"\n                :disabled=\"loadingPurchases\"\n                class=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors flex items-center gap-2\"\n              >\n                <span v-if=\"loadingPurchases\" class=\"animate-spin\">⏳</span>\n                {{ fromDate || toDate ? 'Filter PO' : 'Load 10 Terakhir' }}\n              </button>\n              <button\n                @click=\"resetPurchaseFilter\"\n                class=\"px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors\"\n              >\n                Reset Filter\n              </button>\n            </div>\n          </div>\n\n          <!-- Filter PO -->\n          <div v-if=\"!loadingPurchases\" class=\"p-4 bg-blue-50 rounded-lg border border-blue-200\">\n            <div class=\"flex flex-wrap gap-4 items-end max-w-md\">\n              <div class=\"flex-1 min-w-[200px]\">\n                <label class=\"block text-sm font-medium text-gray-700 mb-1\">Dari Tanggal</label>\n                <input\n                  type=\"date\"\n                  v-model=\"fromDate\"\n                  class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                />\n              </div>\n              <div class=\"flex-1 min-w-[200px]\">\n                <label class=\"block text-sm font-medium text-gray-700 mb-1\">Sampai Tanggal</label>\n                <input\n                  type=\"date\"\n                  v-model=\"toDate\"\n                  class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                />\n              </div>\n            </div>\n            <p v-if=\"fromDate || toDate\" class=\"text-sm text-blue-600 mt-2\">\n              Filter: {{ formatDateFull(fromDate) }} - {{ formatDateFull(toDate) }}\n            </p>\n          </div>\n\n          <!-- Table PO (dengan skeleton loading) -->\n          <div class=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden\">\n            <div class=\"p-4 border-b border-gray-200\">\n              <h2 class=\"text-xl font-semibold text-gray-900\">\n                Daftar Pembelian Tersedia untuk Retur\n                <span class=\"text-sm text-gray-500 ml-2\">({{ safePurchasesLength }} item{{ safePurchasesLength !== 1 ? 's' : '' }})</span>\n              </h2>\n            </div>\n            <div class=\"overflow-x-auto\">\n              <table class=\"min-w-full divide-y divide-gray-200\">\n                <thead class=\"bg-gray-50\">\n                  <tr>\n                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Tanggal</th>\n                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Nomor PO</th>\n                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Supplier</th>\n                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Total</th>\n                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Aksi</th>\n                  </tr>\n                </thead>\n                <tbody class=\"bg-white divide-y divide-gray-200\">\n                  <!-- Skeleton Loading -->\n                  <tr v-if=\"loadingPurchases\" class=\"text-center\" :key=\"'skeleton-' + Math.random()\">\n                    <td colspan=\"6\" class=\"py-12\">\n                      <div class=\"flex items-center justify-center gap-2 text-gray-500\">\n                        <div class=\"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600\"></div>\n                        Memuat daftar PO...\n                      </div>\n                    </td>\n                  </tr>\n                  <!-- Empty State -->\n                  <tr v-else-if=\"!loadingPurchases && safePurchasesLength === 0\" :key=\"'empty'\">\n                    <td colspan=\"6\" class=\"py-12 text-center text-gray-500\">\n                      <p>Tidak ada pembelian yang tersedia untuk retur.</p>\n                      <p class=\"text-sm mt-1\">Coba filter tanggal atau load ulang.</p>\n                    </td>\n                  </tr>\n                  <!-- Data Rows dengan null guards -->\n                  <tr\n                    v-else\n                    v-for=\"(po, index) in purchases\"\n                    :key=\"'po-' + (po.id || po.ID || index)\"  <!-- Unique key untuk hydration -->\n                    class=\"hover:bg-gray-50\"\n                  >\n                    <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                      {{ formatDate(po?.created_at || po?.Date) || 'N/A' }}\n                    </td>\n                    <td class=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\n                      {{ formatPONumber(po?.id || po?.ID) }}\n                    </td>\n                    <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                      {{ po?.Supplier?.name || po?.supplier_name || 'Tidak diketahui' }}\n                    </td>\n                    <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                      {{ formatCurrency(po?.total || po?.Total) }}\n                    </td>\n                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                      <span :class=\"getPOStatusClass(po?.status)\" class=\"px-3 py-1 rounded-full text-xs font-medium\">\n                        {{ getPOStatusText(po?.status) }}\n                      </span>\n                    </td>\n                    <td class=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\n                      <button\n                        @click=\"openReturnModal(po?.id || po?.ID)\"\n                        :disabled=\"po?.status !== 'APPROVED'\"\n                        class=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors text-sm font-medium\"\n                      >\n                        {{ po?.status === 'APPROVED' ? 'Add Retur' : 'Tidak Bisa' }}\n                      </button>\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n          </div>\n\n          <!-- Section Retur Saya (sama, dengan null guards) -->\n          <div class=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden\">\n            <div class=\"p-4 border-b border-gray-200 flex justify-between items-center\">\n              <h2 class=\"text-xl font-semibold text-gray-900\">Daftar Retur Pembelian Saya</h2>\n              <div class=\"flex gap-2\">\n                <button\n                  @click=\"fetchPurchaseReturns\"\n                  :disabled=\"loadingReturns\"\n                  class=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors flex items-center gap-2 text-sm\"\n                >\n                  <span v-if=\"loadingReturns\" class=\"animate-spin\">⏳</span>\n                  Filter\n                </button>\n                <button\n                  @click=\"resetReturnFilter\"\n                  class=\"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-sm\"\n                >\n                  Reset\n                </button>\n              </div>\n            </div>\n\n            <!-- Filter Retur -->\n            <div class=\"p-4 bg-gray-50\">\n              <div class=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n                <div>\n                  <label class=\"block text-sm font-medium text-gray-700 mb-1\">Dari Tanggal</label>\n                  <input\n                    type=\"date\"\n                    v-model=\"returnFromDate\"\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  />\n                </div>\n                <div>\n                  <label class=\"block text-sm font-medium text-gray-700 mb-1\">Sampai Tanggal</label>\n                  <input\n                    type=\"date\"\n                    v-model=\"returnToDate\"\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  />\n                </div>\n                <div>\n                  <label class=\"block text-sm font-medium text-gray-700 mb-1\">Status</label>\n                  <select\n                    v-model=\"returnStatusFilter\"\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  >\n                    <option value=\"\">Semua Status</option>\n                    <option value=\"PENDING\">Pending</option>\n                    <option value=\"APPROVED\">Disetujui</option>\n                    <option value=\"REJECTED\">Ditolak</option>\n                  </select>\n                </div>\n                <div class=\"flex items-end\">\n                  <p v-if=\"returnFromDate || returnToDate || returnStatusFilter\" class=\"text-sm text-gray-600 col-span-full mt-2\">\n                    Filter: {{ formatDateFull(returnFromDate) }} - {{ formatDateFull(returnToDate) }} | Status: {{ returnStatusFilter || 'Semua' }}\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            <!-- Table Retur -->\n            <div class=\"overflow-x-auto\">\n              <table class=\"min-w-full divide-y divide-gray-200\">\n                <thead class=\"bg-gray-50\">\n                  <tr>\n                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">No. Retur</th>\n                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">PO Terkait</th>\n                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Tanggal Retur</th>\n                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Total Retur</th>\n                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Aksi</th>\n                  </tr>\n                </thead>\n                <tbody class=\"bg-white divide-y divide-gray-200\">\n                  <tr v-if=\"loadingReturns\" :key=\"'loading-returns'\">\n                    <td colspan=\"6\" class=\"text-center py-12\">\n                      <div class=\"flex items-center justify-center gap-2 text-gray-500\">\n                        <div class=\"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600\"></div>\n                        Memuat retur...\n                      </div>\n                    </td>\n                  </tr>\n                  <tr v-else-if=\"!loadingReturns && purchaseReturns.length === 0\" :key=\"'empty-returns'\">\n                    <td colspan=\"6\" class=\"py-12 text-center text-gray-500\">\n                      Belum ada retur pembelian yang dibuat.\n                    </td>\n                  </tr>\n                  <tr\n                    v-else\n                    v-for=\"(ret, index) in purchaseReturns\"\n                    :key=\"'ret-' + (ret.id || index)\"\n                    class=\"hover:bg-gray-50\"\n                  >\n                    <td class=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\n                      {{ formatReturnNumber(ret?.id) }}\n                    </td>\n                    <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                      {{ formatPONumber(ret?.purchase_id) }}\n                    </td>\n                    <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                      {{ formatDate(ret?.created_at || ret?.date) }}\n                    </td>\n                    <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                      {{ formatCurrency(ret?.total || ret?.Total) }}\n                    </td>\n                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                      <span :class=\"getStatusClass(ret?.status)\" class=\"px-3 py-1 rounded-full text-xs font-medium\">\n                        {{ getStatusText(ret?.status) }}\n                      </span>\n                    </td>\n                    <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                      <button\n                        @click=\"viewReturnDetail(ret?.id)\"\n                        class=\"text-blue-600 hover:text-blue-900 text-sm font-medium\"\n                      >\n                        Lihat Detail\n                      </button>\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n\n            <!-- Pagination Retur -->\n            <div v-if=\"!loadingReturns && purchaseReturns.length > 0\" class=\"p-4 bg-gray-50 border-t border-gray-200 flex justify-between items-center\">\n              <p class=\"text-sm text-gray-600\">Menampilkan {{ purchaseReturns.length }} dari {{ totalReturns }} retur</p>\n              <div class=\"flex gap-2\">\n                <button\n                  @click=\"changePageReturns(-1)\"\n                  :disabled=\"currentPageReturns <= 1\"\n                  class=\"px-3 py-1 bg-gray-300 text-gray-700 rounded disabled:opacity-50\"\n                >\n                  Sebelumnya\n                </button>\n                <span class=\"px-3 py-1 bg-white border rounded\">Hal. {{ currentPageReturns }}</span>\n                <button\n                  @click=\"changePageReturns(1)\"\n                  :disabled=\"currentPageReturns >= totalPagesReturns\"\n                  class=\"px-3 py-1 bg-gray-300 text-gray-700 rounded disabled:opacity-50\"\n                >\n                  Selanjutnya\n                </button>\n              </div>\n            </div>\n          </div>\n\n          <!-- Modal Retur (dengan v-if ketat) -->\n          <div v-if=\"showModal && selectedPurchase\" class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto\">\n            <!-- Isi modal sama seperti sebelumnya, tapi tambah null checks di items -->\n            <div class=\"bg-white rounded-lg p-6 max-w-6xl w-full max-h-[95vh]\">\n              <div class=\"flex justify-between items-center mb-6\">\n                <h2 class=\"text-2xl font-bold text-gray-900\">Buat Retur Pembelian</h2>\n                <button @click=\"closeModal\" class=\"text-gray-400 hover:text-gray-600 text-2xl\">&times;</button>\n              </div>\n\n              <!-- Info PO -->\n              <div class=\"mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200\">\n                <h3 class=\"font-semibold text-gray-900 mb-2\">Detail Pembelian Terpilih</h3>\n                <div class=\"grid grid-cols-1 md:grid-cols-4 gap-4 text-sm\">\n                  <div><strong>Nomor PO:</strong> {{ formatPONumber(selectedPurchase?.id || selectedPurchase?.ID) }}</div>\n                  <div><strong>Tanggal:</strong> {{ formatDate(selectedPurchase?.created_at || selectedPurchase?.Date) }}</div>\n                  <div><strong>Supplier:</strong> {{ selectedPurchase?.Supplier?.name || 'N/A' }}</div>\n                  <div><strong>Total Asli:</strong> {{ formatCurrency(selectedPurchase?.total || selectedPurchase?.Total) }}</div>\n                </div>\n              </div>\n\n              <!-- Form Items -->\n              <div class=\"mb-6\">\n                <h3 class=\"text-lg font-semibold mb-4 text-gray-900\">Pilih Item untuk Diretur</h3>\n                <div v-if=\"returnForm.items.length === 0\" class=\"text-center py-8 text-gray-500\">\n                  Tidak ada item yang tersedia untuk retur.\n                </div>\n                <div v-else class=\"space-y-4\">\n                  <div\n                    v-for=\"(item, index) in returnForm.items\"\n                    :key=\"'item-' + index\"\n                    class=\"border border-gray-200 rounded-lg p-4 bg-gray-50\"\n                  >\n                    <div class=\"flex flex-wrap gap-4 items-start justify-between\">\n                      <div class=\"flex-1\">\n                        <p class=\"font-medium text-gray-900\">{{ item.product_name || 'N/A' }}</p>\n                        <p class=\"text-sm text-gray-600\">\n                          Qty Asli: {{ item.original_qty || 0 }} | Harga: {{ formatCurrency(item.price) }}\n                        </p>\n                      </div>\n                      <div class=\"w-24\">\n                        <label class=\"block text-sm font-medium text-gray-700 mb-1\">Qty Retur</label>\n                        <input\n                          type=\"number\"\n                          v-model.number=\"item.qty\"\n                          :min=\"0\"\n                          :max=\"item.original_qty || 0\"\n                          class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500\"\n                          @input=\"updateSubtotal(index)\"\n                        />\n                      </div>\n                      <div class=\"flex-1\">\n                        <label class=\"block text-sm font-medium text-gray-700 mb-1\">Alasan Retur *</label>\n                        <textarea\n                          v-model=\"item.reason\"\n                          placeholder=\"Jelaskan alasan retur item ini (wajib)\"\n                          rows=\"2\"\n                          class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 resize-none\"\n                        ></textarea>\n                        <p v-if=\"item.reason && item.reason.length < 10\" class=\"text-xs text-red-500 mt-1\">\n                          Alasan minimal 10 karakter.\n                        </p>\n                      </div>\n                      <div class=\"w-24 text-right\">\n                        <p class=\"text-sm font-medium text-gray-900\">Subtotal: {{ formatCurrency(item.subtotal) }}</p>\n                      </div>\n                    </div>\n                    <button\n                      v-if=\"item.qty > 0\"\n                      @click=\"removeItem(index)\"\n                      class=\"mt-2 text-red-600 hover:text-red-800 text-sm font-medium\"\n                    >\n                      Hapus Item Ini\n                    </button>\n                  </div>\n                </div>\n                <p v-if=\"totalReturnAmount > 0\" class=\"mt-4 text-right font-semibold text-lg text-gray-900\">\n                  Total Retur: {{ formatCurrency(totalReturnAmount) }}\n                </p>\n              </div>\n\n              <!-- Catatan -->\n              <div class=\"mb-6\">\n                <label class=\"block text-sm font-medium text-gray-700 mb-2\">Catatan Tambahan (Opsional)</label>\n                <textarea\n                  v-model=\"returnNotes\"\n                  placeholder=\"Tambahkan catatan untuk retur ini (misal: nomor invoice supplier)\"\n                  rows=\"3\"\n                  class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none\"\n                ></textarea>\n              </div>\n\n              <!-- Footer -->\n              <div class=\"flex justify-end gap-3 pt-4 border-t border-gray-200\">\n                <button\n                  @click=\"closeModal\"\n                  class=\"px-6 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors\"\n                >\n                  Batal\n                </button>\n                <button\n                  @click=\"submitReturn\"\n                  :disabled=\"submitting || !isFormValid\"\n                  class=\"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2\"\n                >\n                  <span v-if=\"submitting\" class=\"animate-spin\">⏳</span>\n                  {{ submitting ? 'Menyimpan...' : 'Submit Retur' }}\n                </button>\n              </div>\n            </div>\n          </div>\n\n          <!-- Toast -->\n          <div v-if=\"toast.message\" :class=\"['fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 transition-all', toast.type === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white']\">\n            {{ toast.message }}\n          </div>\n        </div>\n      </template>\n      <template #fallback>\n        <div class=\"flex items-center justify-center h-64\">\n          <div class=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n          <span class=\"ml-2 text-gray-500\">Loading app...</span>\n        </div>\n      </template>\n    </Suspense>\n  </CashierLayouts>\n</template>\n\n<script setup>\nimport { ref, onMounted, computed, nextTick } from 'vue';\nimport { useRouter } from 'vue-router';\nimport axios from 'axios';\nimport CashierLayouts from '@/components/CashierLayouts.vue';  // Pastikan ini sync atau handle async\n\nconst router = useRouter();\n\n/* API Config (sama) */\n// ... (salin dari sebelumnya, termasuk ENDPOINTS, api, interceptor)\n\nconst purchases = ref([]);  // Pastikan array kosong\nconst loadingPurchases = ref(false);\nconst fromDate = ref('');\nconst toDate = ref('');\nconst currentPagePurchases = ref(1);\nconst totalPurchases = ref(0);\n\nconst purchaseReturns = ref([]);\nconst loadingReturns = ref(false);\nconst returnFromDate = ref('');\nconst returnToDate = ref('');\nconst returnStatusFilter = ref('');\nconst currentPageReturns = ref(1);\nconst totalReturns = ref(0);\nconst totalPagesReturns = computed(() => Math.ceil(totalReturns.value / 10));\n\n/* Modal */\nconst showModal = ref(false);\nconst selectedPurchase = ref(null);\nconst returnForm = ref({ items: [] });\nconst returnNotes = ref('');\nconst submitting = ref(false);\n\n/* Toast (sama) */\nconst toast = ref({ message: '', type: 'success' });\nconst showToast = (message, type = 'success') => {\n  toast.value = { message, type };\n  setTimeout(() => { toast.value.message = ''; }, 3000);\n};\n\n/* Computed */\nconst safePurchasesLength = computed(() => Array.isArray(purchases.value) ? purchases.value.length : 0);\n\nconst isFormValid = computed(() => {\n  return Array.isArray(returnForm.value.items) && returnForm.value.items.some(item => \n    (item.qty || 0) > 0 && (item.reason || '').trim().length >= 10\n  );\n});\n\nconst totalReturnAmount = computed(() => {\n  return Array.isArray(returnForm.value.items) ? \n    returnForm.value.items.reduce((sum, item) => sum + (item.subtotal || 0), 0) : 0;\n});\n\n/* Utilities (sama, tambah null check di formatDate) */\nconst formatDate = (dateStr) => {\n  if (!dateStr) return 'N/A';\n  const date = new Date(dateStr);\n  return isNaN(date.getTime()) ? 'Invalid Date' : date.toLocaleDateString('id-ID', { day: '2-digit', month: 'short', year: 'numeric' });\n};\n// ... (salin getStatusClass, dll.)\n\n/* API Calls dengan try-catch ekstra */\nconst fetchPurchases = async (page = 1) => {\n  loadingPurchases.value = true;\n  try {\n    const params = { page, size: 10, status: 'APPROVED' };\n    if (fromDate.value) params.from = fromDate.value;\n    if (toDate.value) params.to = toDate.value;\n\n    const res = await api.get(ENDPOINTS.PURCHASES, { params });\n    console.log('Fetch PO response:', res.data);  // Debug log\n    const data = res.data?.data || res.data || [];\n    purchases.value = Array.isArray(data) ? data : [];\n    totalPurchases.value = res.data?.total || data.length;\n    showToast('Daftar PO dimuat berhasil!');\n  } catch (err) {\n    console.error('Error fetching purchases:', err);\n    showToast(`Gagal memuat PO: ${err.response?.data?.error || err.message}`, 'error');\n    purchases.value = [];  // Reset ke empty\n  } finally {\n    loadingPurchases.value = false;\n  }\n};\n\n// ... (salin fetchPurchaseReturns, openReturnModal dengan console.log di try)\n\nconst openReturnModal = async (purchaseId) => {\n  if (!purchaseId) {\n    showToast('ID PO tidak valid!', 'error');\n    return;\n  }\n  try {\n    const res = await api.get(`${ENDPOINTS.PURCHASE_DETAIL}/${purchaseId}`);\n    console.log('PO detail:', res.data);  // Debug\n    selectedPurchase.value = res.data?.data || res.data || null;\n    if (!selectedPurchase.value) {\n      throw new Error('Data PO kosong');\n    }\n\n    const items = selectedPurchase.value.Items || [];\n    returnForm.value.items = Array.isArray(items) ? items.map(item => ({\n      product_id: item.ProductID || item.product_id || item.Product?.id,\n      product_name: item.Product?.name || 'N/A',\n      original_qty: item.Qty || 0,\n      qty: 0,\n      price: item.Price || 0,\n      reason: '',\n      subtotal: 0\n    })) : [];\n    returnNotes.value = '';\n    showModal.value = true;\n    await nextTick();\n  } catch (err) {\n    console.error('Error loading PO detail:', err);\n    showToast(`Gagal memuat detail PO: ${err.response?.data?.error || err.message}`, 'error');\n  }\n};\n\n// ... (salin submitReturn, closeModal, dll. dengan null checks)\n\nonMounted(async () => {\n  try {\n    await fetchPurchases();\n    await fetchPurchaseReturns();\n  } catch (err) {\n    console.error('Mount error:', err);\n    showToast('Gagal inisialisasi halaman', 'error');\n  }\n});\n</script>\n\n<style scoped>\n/* Sama seperti sebelumnya */\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}