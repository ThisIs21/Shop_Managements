{"ast":null,"code":"import { createElementVNode as _createElementVNode, withCtx as _withCtx, openBlock as _openBlock, createBlock as _createBlock } from \"vue\";\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createBlock($setup[\"KepalaGudangLayouts\"], null, {\n    default: _withCtx(() => [...(_cache[0] || (_cache[0] = [_createElementVNode(\"div\", {\n      class: \"flex flex-wrap justify-between gap-3 p-4\"\n    }, [_createElementVNode(\"p\", {\n      class: \"text-[#111418] tracking-light text-[32px] font-bold leading-tight min-w-72\"\n    }, \" Warehouse Manager Dashboard \")], -1 /* CACHED */), _createElementVNode(\"div\", {\n      class: \"p-4\"\n    }, [_createElementVNode(\"div\", {\n      class: \"flex flex-col gap-2 rounded-lg p-6 bg-[#f0f2f5] min-h-[150px] justify-center items-center\"\n    }, [_createElementVNode(\"p\", {\n      class: \"text-[#111418] tracking-light text-3xl font-bold leading-tight\"\n    }, \" Selamat datang, Kepala Gudang! \")])], -1 /* CACHED */)]))]),\n    _: 1 /* STABLE */\n  });\n}","map":{"version":3,"names":["_createBlock","$setup","_cache","_createElementVNode","class"],"sources":["C:\\Users\\Personal\\Documents\\PKL\\PKL Shop Managements\\vue\\src\\views\\DashboardKepalagudang.vue"],"sourcesContent":["<template>\n  <KepalaGudangLayouts>\n    <div class=\"flex flex-wrap justify-between gap-3 p-4\">\n      <p\n        class=\"text-[#111418] tracking-light text-[32px] font-bold leading-tight min-w-72\"\n      >\n        Warehouse Manager Dashboard\n      </p>\n    </div>\n\n    <div class=\"p-4\">\n      <div\n        class=\"flex flex-col gap-2 rounded-lg p-6 bg-[#f0f2f5] min-h-[150px] justify-center items-center\"\n      >\n        <p\n          class=\"text-[#111418] tracking-light text-3xl font-bold leading-tight\"\n        >\n          Selamat datang, Kepala Gudang!\n        </p>\n      </div>\n    </div>\n  </KepalaGudangLayouts>\n</template>\n\n<script setup>\nimport { ref, onMounted } from \"vue\";\nimport KepalaGudangLayouts from \"@/components/KepalaGudangLayouts.vue\";\nimport api from \"../services/api.js\";\n\n// State untuk dashboard\nconst loading = ref(true);\nconst errorMessage = ref(\"\");\nconst dashboard = ref({\n  purchase_orders_pending: 0,\n  purchase_returns_pending: 0,\n  products_low_stock: 0,\n  products_in_stock: 0,\n});\n\n// Helper untuk mengambil total dari berbagai struktur respons\nfunction getTotalFromResponse(resp) {\n  if (!resp) return 0;\n  const d = resp.data ?? resp;\n  return (\n    d.total ?? d?.data?.total ?? d?.meta?.total ?? d?.data?.meta?.total ?? 0\n  );\n}\n\n// Ambil array produk dari respons\nfunction getProductsArray(resp) {\n  if (!resp) return [];\n  const d = resp.data ?? resp;\n  return d?.data ?? d?.items ?? d?.products ?? [];\n}\n\n// Fungsi untuk mengambil data dashboard\nconst fetchDashboard = async () => {\n  loading.value = true;\n  errorMessage.value = \"\";\n  try {\n    // 1) Purchase orders pending approval (SUBMITTED)\n    const poResp = await api.get(\"/pembelian/purchases\", {\n      params: { status: \"SUBMITTED\", size: 1 },\n    });\n    dashboard.value.purchase_orders_pending = getTotalFromResponse(poResp);\n\n    // 2) Purchase returns pending\n    const prResp = await api.get(\"/pembelian/purchase-returns\", {\n      params: { status: \"PENDING\", size: 1 },\n    });\n    dashboard.value.purchase_returns_pending = getTotalFromResponse(prResp);\n\n    // 3) Products list to compute low stock and in-stock counts\n    // try owner/products or /products depending on backend\n    let productsResp;\n    try {\n      productsResp = await api.get(\"/products\", { params: { size: 500 } });\n    } catch (e) {\n      // fallback to owner/products\n      productsResp = await api.get(\"/owner/products\", { params: { size: 500 } });\n    }\n\n    const products = getProductsArray(productsResp) || [];\n\n    // Threshold low stock (tweakable)\n    const LOW_STOCK_THRESHOLD = 5;\n\n    let lowCount = 0;\n    let inStockCount = 0;\n    products.forEach((p) => {\n      const prod = p.Product ?? p.product ?? p; // support wrapped objects\n      const stock = Number(prod.stock ?? prod.Stock ?? prod.qty ?? prod.quantity ?? 0);\n      if (!Number.isNaN(stock)) {\n        if (stock <= LOW_STOCK_THRESHOLD) lowCount += 1;\n        if (stock > 0) inStockCount += 1;\n      }\n    });\n\n    dashboard.value.products_low_stock = lowCount;\n    dashboard.value.products_in_stock = inStockCount;\n  } catch (error) {\n    console.error(\"Gagal fetch dashboard Kepala Gudang:\", error);\n    errorMessage.value = error?.response?.data?.message || error.message || String(error);\n  } finally {\n    loading.value = false;\n  }\n};\n\nonMounted(() => {\n  fetchDashboard();\n});\n</script>\n"],"mappings":";;uBACEA,YAAA,CAoBsBC,MAAA;sBAnBpB,MAMM,KAAAC,MAAA,QAAAA,MAAA,OANNC,mBAAA,CAMM;MANDC,KAAK,EAAC;IAA0C,IACnDD,mBAAA,CAII;MAHFC,KAAK,EAAC;IAA4E,GACnF,+BAED,E,oBAGFD,mBAAA,CAUM;MAVDC,KAAK,EAAC;IAAK,IACdD,mBAAA,CAQM;MAPJC,KAAK,EAAC;IAA2F,IAEjGD,mBAAA,CAII;MAHFC,KAAK,EAAC;IAAgE,GACvE,kCAED,E","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}