{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { ref, computed, onMounted } from \"vue\";\nimport axios from \"axios\";\nimport OwnerLayout from \"../components/OwnerLayouts.vue\";\nexport default {\n  __name: 'ReportStockOpnameOwners',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const filters = ref({\n      startDate: \"\",\n      endDate: \"\"\n    });\n    const rawData = ref([]);\n    const flattenedData = ref([]); // Ini yang akan di-loop di tabel\n    const loading = ref(false);\n    const errorMessage = ref(\"\");\n    const token = localStorage.getItem(\"token\");\n\n    /**\n     * ✅ Fungsi Mapping Detail: Memproses data FLAT yang datang dari JOIN SQL di Go.\n     * Mengembalikan array of object siap ditampilkan.\n     */\n    const mapDetailData = apiResponse => {\n      // Jika data yang diterima array kosong, kembalikan array kosong\n      if (!Array.isArray(apiResponse)) {\n        console.error(\"API response data is not an array:\", apiResponse);\n        return [];\n      }\n      return apiResponse.map(item => {\n        // Pastikan nama properti SAMA PERSIS dengan alias di SELECT SQL Go Anda.\n        const date = item.date ? item.date.substring(0, 10) : \"N/A\";\n        const system = Number(item.system_stock) || 0;\n        const physical = Number(item.physical_stock) || 0;\n        const difference = Number(item.difference) || 0;\n        return {\n          date: date,\n          book_name: item.book_name || \"N/A\",\n          product_code: item.product_code || \"-\",\n          system_stock: system,\n          physical_stock: physical,\n          difference: difference\n        };\n      });\n    };\n\n    // Ambil data dari backend\n    const fetchData = async () => {\n      loading.value = true;\n      errorMessage.value = \"\"; // Kosongkan data lama saat fetch baru\n      rawData.value = [];\n      flattenedData.value = [];\n      try {\n        if (!token) {\n          errorMessage.value = \"Token autentikasi tidak ditemukan. Silakan login kembali.\";\n          return;\n        } // ✅ ENDPOINT: Menggunakan &detail=true. Ini memicu StockOpnameDetail di backend.\n\n        let url = \"http://localhost:8081/api/v1/owner/reports?type=stock-opnames&detail=true\"; // Tambahkan filter tanggal.\n\n        if (filters.value.startDate && filters.value.endDate) {\n          url += `&from=${filters.value.startDate}&to=${filters.value.endDate}`;\n        }\n        const res = await axios.get(url, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        rawData.value = res.data.data || []; // Memproses data detail\n        flattenedData.value = mapDetailData(rawData.value);\n        errorMessage.value = \"\"; // Reset error jika berhasil\n      } catch (err) {\n        console.error(\"Gagal ambil data laporan:\", err.response || err);\n        let msg = \"Gagal terhubung ke server. Pastikan backend berjalan dan login Anda valid.\";\n        if (err.response) {\n          if (err.response.status === 404) {\n            // ✅ JELAS: Error 404 menandakan endpoint tidak ditemukan di router Go.\n            msg = \"Endpoint API tidak ditemukan (404). Pastikan alamat /api/v1/owner/reports sudah benar di backend, dan service Go telah di-restart!\";\n          } else if (err.response.status === 401) {\n            msg = \"Sesi Anda telah berakhir. Silakan login kembali.\";\n          } else {\n            msg = `Gagal mendapatkan data. Status: ${err.response.status}. Pesan: ${err.response.data?.error || \"Unknown\"}`;\n          }\n        }\n        errorMessage.value = msg; // Jika error, kosongkan data agar tabel tidak menampilkan ringkasan\n        flattenedData.value = [];\n      } finally {\n        loading.value = false;\n      }\n    };\n    onMounted(fetchData);\n    function applyFilter() {\n      if (!filters.value.startDate || !filters.value.endDate) {\n        errorMessage.value = \"Harap masukkan kedua tanggal (Dari dan Sampai) untuk memfilter.\";\n        return;\n      }\n      fetchData();\n    }\n    function resetFilter() {\n      filters.value.startDate = \"\";\n      filters.value.endDate = \"\";\n      errorMessage.value = \"\";\n      fetchData();\n    }\n    const filteredData = computed(() => flattenedData.value);\n    const __returned__ = {\n      filters,\n      rawData,\n      flattenedData,\n      loading,\n      errorMessage,\n      token,\n      mapDetailData,\n      fetchData,\n      applyFilter,\n      resetFilter,\n      filteredData,\n      ref,\n      computed,\n      onMounted,\n      get axios() {\n        return axios;\n      },\n      OwnerLayout\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","axios","OwnerLayout","filters","startDate","endDate","rawData","flattenedData","loading","errorMessage","token","localStorage","getItem","mapDetailData","apiResponse","Array","isArray","console","error","map","item","date","substring","system","Number","system_stock","physical","physical_stock","difference","book_name","product_code","fetchData","value","url","res","get","headers","Authorization","data","err","response","msg","status","applyFilter","resetFilter","filteredData"],"sources":["C:/Users/Personal/Documents/PKL/aplikasi/aplikasi/src/views/ReportStockOpnameOwners.vue"],"sourcesContent":["<script setup>\nimport { ref, computed, onMounted } from \"vue\";\nimport axios from \"axios\";\nimport OwnerLayout from \"../components/OwnerLayouts.vue\";\n\nconst filters = ref({\n  startDate: \"\",\n  endDate: \"\",\n});\nconst rawData = ref([]);\nconst flattenedData = ref([]); // Ini yang akan di-loop di tabel\nconst loading = ref(false);\nconst errorMessage = ref(\"\");\nconst token = localStorage.getItem(\"token\");\n\n/**\n * ✅ Fungsi Mapping Detail: Memproses data FLAT yang datang dari JOIN SQL di Go.\n * Mengembalikan array of object siap ditampilkan.\n */\nconst mapDetailData = (apiResponse) => {\n  // Jika data yang diterima array kosong, kembalikan array kosong\n  if (!Array.isArray(apiResponse)) {\n    console.error(\"API response data is not an array:\", apiResponse);\n    return [];\n  }\n\n  return apiResponse.map((item) => {\n    // Pastikan nama properti SAMA PERSIS dengan alias di SELECT SQL Go Anda.\n    const date = item.date ? item.date.substring(0, 10) : \"N/A\";\n    const system = Number(item.system_stock) || 0;\n    const physical = Number(item.physical_stock) || 0;\n    const difference = Number(item.difference) || 0;\n\n    return {\n      date: date,\n      book_name: item.book_name || \"N/A\",\n      product_code: item.product_code || \"-\",\n      system_stock: system,\n      physical_stock: physical,\n      difference: difference,\n    };\n  });\n};\n\n// Ambil data dari backend\nconst fetchData = async () => {\n  loading.value = true;\n  errorMessage.value = \"\"; // Kosongkan data lama saat fetch baru\n  rawData.value = [];\n  flattenedData.value = [];\n\n  try {\n    if (!token) {\n      errorMessage.value =\n        \"Token autentikasi tidak ditemukan. Silakan login kembali.\";\n      return;\n    } // ✅ ENDPOINT: Menggunakan &detail=true. Ini memicu StockOpnameDetail di backend.\n\n    let url =\n      \"http://localhost:8081/api/v1/owner/reports?type=stock-opnames&detail=true\"; // Tambahkan filter tanggal.\n\n    if (filters.value.startDate && filters.value.endDate) {\n      url += `&from=${filters.value.startDate}&to=${filters.value.endDate}`;\n    }\n\n    const res = await axios.get(url, {\n      headers: { Authorization: `Bearer ${token}` },\n    });\n\n    rawData.value = res.data.data || []; // Memproses data detail\n    flattenedData.value = mapDetailData(rawData.value);\n\n    errorMessage.value = \"\"; // Reset error jika berhasil\n  } catch (err) {\n    console.error(\"Gagal ambil data laporan:\", err.response || err);\n    let msg =\n      \"Gagal terhubung ke server. Pastikan backend berjalan dan login Anda valid.\";\n    if (err.response) {\n      if (err.response.status === 404) {\n        // ✅ JELAS: Error 404 menandakan endpoint tidak ditemukan di router Go.\n        msg =\n          \"Endpoint API tidak ditemukan (404). Pastikan alamat /api/v1/owner/reports sudah benar di backend, dan service Go telah di-restart!\";\n      } else if (err.response.status === 401) {\n        msg = \"Sesi Anda telah berakhir. Silakan login kembali.\";\n      } else {\n        msg = `Gagal mendapatkan data. Status: ${err.response.status}. Pesan: ${\n          err.response.data?.error || \"Unknown\"\n        }`;\n      }\n    }\n    errorMessage.value = msg; // Jika error, kosongkan data agar tabel tidak menampilkan ringkasan\n    flattenedData.value = [];\n  } finally {\n    loading.value = false;\n  }\n};\n\nonMounted(fetchData);\n\nfunction applyFilter() {\n  if (!filters.value.startDate || !filters.value.endDate) {\n    errorMessage.value =\n      \"Harap masukkan kedua tanggal (Dari dan Sampai) untuk memfilter.\";\n    return;\n  }\n  fetchData();\n}\n\nfunction resetFilter() {\n  filters.value.startDate = \"\";\n  filters.value.endDate = \"\";\n  errorMessage.value = \"\";\n  fetchData();\n}\n\nconst filteredData = computed(() => flattenedData.value);\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}